<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Minimal</title>

    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #18181b; }
        body { font-family: 'Inter', sans-serif; background-color: #fafafa; color: var(--primary); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 3px; }

        .btn-minimal { transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .btn-minimal:active { transform: scale(0.96); }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-secondary { background-color: white; border: 1px solid #e4e4e7; color: var(--primary); }
        .btn-danger { background-color: #fef2f2; color: #ef4444; border: 1px solid #fee2e2; }

        .bingo-cell { transition: all 0.2s ease; background-color: white; border: 1px solid #f4f4f5; color: #d4d4d8; border-radius: 6px; }
        .bingo-cell.called { background-color: var(--primary); color: white; border-color: var(--primary); font-weight: 600; transform: scale(1.05); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        @keyframes pop { 0% { transform: scale(0.9); opacity: 0.5; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        .pop-animation { animation: pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--primary); margin-top: -6px; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e4e4e7; border-radius: 2px; }
    </style>
</head>

<body class="h-screen w-screen overflow-hidden flex flex-col md:flex-row">

    <div class="w-full md:w-5/12 lg:w-4/12 flex-shrink-0 bg-white border-b md:border-b-0 md:border-r border-gray-100 flex flex-col z-20 shadow-sm md:shadow-none relative">
        
        <div class="md:hidden px-4 py-3 md:p-6 flex justify-between items-center">
            <h1 class="text-lg font-bold tracking-tight flex items-center gap-2">
                <i class="fa-solid fa-shapes text-gray-400"></i> Bingo
            </h1>
            <div class="flex items-center gap-2 ">
                <span class="text-[10px] font-medium text-gray-400 uppercase tracking-wider" id="status-text">Ready</span>
                <div id="status-dot" class="w-2 h-2 rounded-full bg-gray-300"></div>
            </div>
        </div>

        <div class="flex-grow flex flex-col justify-center items-center px-4 py-2 md:py-6">
            <div class="text-center">
                <p class="text-[10px] text-gray-400 font-medium uppercase tracking-widest mb-1 md:mb-4">Số hiện tại</p>
                <div id="current-number-display" class="text-7xl md:text-8xl lg:text-9xl leading-none font-light tracking-tighter text-gray-900 tabular-nums transition-all h-20 md:h-32 flex items-center justify-center">--</div>
            </div>
            
            <div class="mt-4 md:mt-8 w-full">
                <div class="flex justify-between items-end mb-2 px-1">
                    <span class="text-[10px] text-gray-400 font-medium">Lịch sử</span>
                    <span id="count-display" class="text-[10px] text-gray-900 font-bold">0/90</span>
                </div>
                <div id="called-numbers-history" class="flex gap-2 overflow-x-auto pb-2 min-h-[36px] items-center mask-image-gradient no-scrollbar">
                    <span class="text-[10px] text-gray-300 w-full text-center italic">Trống</span>
                </div>
            </div>
        </div>

        <div class="p-4 md:p-6 bg-gray-50/50 border-t border-gray-100 space-y-3 md:mt-auto">
            <div class="flex items-center gap-3 px-1">
                <i class="fa-solid fa-gauge-high text-gray-400 text-xs"></i>
                <input id="speed-slider" type="range" min="1" max="10" value="5" class="w-full h-1 bg-gray-200 rounded-lg cursor-pointer">
                <span id="speed-value" class="text-[10px] font-mono font-medium text-gray-500 w-8 text-right">6s</span>
            </div>

            <div class="grid grid-cols-4 gap-2 md:gap-3">
                <button id="reset-btn" class="btn-minimal btn-danger h-12 md:h-14 col-span-1">
                    <i class="fa-solid fa-rotate-right text-lg"></i>
                </button>
                <button id="start-pause-btn" class="btn-minimal btn-primary h-12 md:h-14 col-span-2 gap-2">
                    <i id="control-icon" class="fa-solid fa-play"></i>
                    <span id="control-text" class="text-sm font-medium">Bắt đầu</span>
                </button>
                <button id="next-btn" class="btn-minimal btn-secondary h-12 md:h-14 col-span-1">
                    <i class="fa-solid fa-forward-step text-lg"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="flex-grow w-full md:w-7/12 lg:w-8/12 h-full overflow-hidden bg-gray-50/50 relative flex flex-col">
        <div class="absolute inset-0 overflow-y-auto p-4 md:p-6 lg:p-8">
            <div class="max-w-5xl mx-auto w-full pb-10">
                <div class="flex justify-between items-center mb-4 sticky top-0 bg-gray-50/95 backdrop-blur-sm py-2 z-10">
                    <h2 id="bingo-board-title" class="text-sm md:text-lg font-semibold text-gray-800">Bảng số</h2>
                    <button id="open-settings-btn" class="btn-minimal btn-secondary w-8 h-8 rounded-full bg-white shadow-sm">
                        <i class="fa-solid fa-gear text-gray-500 text-xs"></i>
                    </button>
                </div>
                
                <div id="bingo-board" class="grid grid-cols-10 gap-1 md:gap-2 lg:gap-3">
                    </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop" onclick="document.getElementById('close-settings-btn').click()"></div>
        <div class="absolute right-0 top-0 h-full w-full max-w-sm bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out modal-content flex flex-col">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                <h3 class="text-lg font-bold">Cài đặt</h3>
                <button id="close-settings-btn" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100"><i class="fa-solid fa-xmark text-gray-500"></i></button>
            </div>
            <div class="p-4 space-y-6 overflow-y-auto flex-grow">
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest">Trò chơi</h4>
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-700">Tổng số bóng</label>
                        <input type="number" id="max-number-input" value="90" min="10" max="200" class="w-full p-2 border border-gray-200 rounded-lg outline-none focus:border-black">
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest">Giọng đọc</h4>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="speak-toggle" class="sr-only peer" checked>
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-black"></div>
                        </label>
                    </div>
                    <div id="voice-controls" class="space-y-4 pt-2">
                        <div>
                            <label class="text-xs font-medium text-gray-700 mb-1 block">Ngôn ngữ</label>
                            <select id="language-select" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-sm outline-none"></select>
                        </div>
                        <div>
                            <label class="text-xs font-medium text-gray-700 mb-1 block">Người đọc</label>
                            <div class="flex gap-2">
                                <select id="voice-select" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-sm outline-none text-ellipsis overflow-hidden"></select>
                                <button id="test-voice-btn" class="flex-shrink-0 w-9 h-9 flex items-center justify-center rounded-lg border border-gray-200 hover:bg-gray-100"><i class="fa-solid fa-volume-high text-xs"></i></button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-medium text-gray-500 mb-1 block">Tốc độ</label>
                                <input id="rate-slider" type="range" min="0.5" max="2" value="1" step="0.1" class="w-full h-1 bg-gray-200 rounded-lg">
                            </div>
                            <div>
                                <label class="text-[10px] font-medium text-gray-500 mb-1 block">Ngữ điệu</label>
                                <input id="pitch-slider" type="range" min="0" max="2" value="1" step="0.1" class="w-full h-1 bg-gray-200 rounded-lg">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <button id="apply-settings-btn" class="w-full py-3 bg-black text-white rounded-xl font-medium shadow-lg hover:bg-gray-800 transition-all active:scale-[0.98]">Lưu & Chơi Mới</button>
            </div>
        </div>
    </div>

    <div id="reset-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"></div>
        <div class="bg-white rounded-2xl shadow-xl max-w-xs w-full p-5 relative z-10 transform scale-95 opacity-0 transition-all modal-content text-center">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Chơi lại?</h3>
            <p class="text-xs text-gray-500 mb-5">Dữ liệu sẽ bị xóa.</p>
            <div class="grid grid-cols-2 gap-3">
                <button id="confirm-reset-no" class="py-2 rounded-lg border border-gray-200 text-sm font-medium hover:bg-gray-50">Huỷ</button>
                <button id="confirm-reset-yes" class="py-2 rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600">Đồng ý</button>
            </div>
        </div>
    </div>

    <script>
        const currentNumberDisplay = document.getElementById('current-number-display');
        const countDisplay = document.getElementById('count-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const controlIcon = document.getElementById('control-icon');
        const controlText = document.getElementById('control-text');
        const nextBtn = document.getElementById('next-btn');
        const resetBtn = document.getElementById('reset-btn');
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        const bingoBoard = document.getElementById('bingo-board');
        const bingoBoardTitle = document.getElementById('bingo-board-title');
        const calledNumbersHistory = document.getElementById('called-numbers-history');
        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const maxNumberInput = document.getElementById('max-number-input');
        const applySettingsBtn = document.getElementById('apply-settings-btn');
        const resetModal = document.getElementById('reset-modal');
        const confirmResetYes = document.getElementById('confirm-reset-yes');
        const confirmResetNo = document.getElementById('confirm-reset-no');
        const settingsModal = document.getElementById('settings-modal');
        const openSettingsBtn = document.getElementById('open-settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const speakToggle = document.getElementById('speak-toggle');
        const voiceControls = document.getElementById('voice-controls');
        const languageSelect = document.getElementById('language-select');
        const voiceSelect = document.getElementById('voice-select');
        const rateSlider = document.getElementById('rate-slider');
        const pitchSlider = document.getElementById('pitch-slider');
        const testVoiceBtn = document.getElementById('test-voice-btn');

        let allNumbers = [], availableNumbers = [], calledNumbers = [];
        let intervalId = null, isGameRunning = false, speed = 6000;
        const synth = window.speechSynthesis;
        let voices = [];

        function updateStatus(state) {
            if (state === 'playing') {
                statusText.textContent = 'Đang gọi...';
                statusText.className = 'text-[10px] font-medium text-green-600 uppercase tracking-wider';
                statusDot.className = 'w-2 h-2 rounded-full bg-green-500 animate-pulse';
                controlIcon.className = 'fa-solid fa-pause';
                controlText.textContent = 'Dừng';
                startPauseBtn.classList.remove('btn-primary');
                startPauseBtn.classList.add('bg-gray-900', 'text-white');
            } else if (state === 'paused') {
                statusText.textContent = 'Tạm dừng';
                statusText.className = 'text-[10px] font-medium text-yellow-600 uppercase tracking-wider';
                statusDot.className = 'w-2 h-2 rounded-full bg-yellow-500';
                controlIcon.className = 'fa-solid fa-play';
                controlText.textContent = 'Tiếp tục';
                startPauseBtn.classList.add('btn-primary');
            } else if (state === 'finished') {
                statusText.textContent = 'Hoàn tất';
                statusText.className = 'text-[10px] font-medium text-red-600 uppercase tracking-wider';
                statusDot.className = 'w-2 h-2 rounded-full bg-red-500';
                controlIcon.className = 'fa-solid fa-rotate-right';
                controlText.textContent = 'Hết số';
                startPauseBtn.disabled = true;
                startPauseBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                statusText.textContent = 'Sẵn sàng';
                statusText.className = 'text-[10px] font-medium text-gray-400 uppercase tracking-wider';
                statusDot.className = 'w-2 h-2 rounded-full bg-gray-300';
                controlIcon.className = 'fa-solid fa-play';
                controlText.textContent = 'Bắt đầu';
                startPauseBtn.disabled = false;
                startPauseBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-900');
                startPauseBtn.classList.add('btn-primary');
            }
        }

        function speak(text) {
            if (!speakToggle.checked || !synth || voices.length === 0 || !text) return;
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const selectedVoiceName = voiceSelect.value;
            const selectedVoice = voices.find(v => v.name === selectedVoiceName);
            if (selectedVoice) {
                utterance.voice = selectedVoice;
                utterance.rate = rateSlider.value;
                utterance.pitch = pitchSlider.value;
                synth.speak(utterance);
            }
        }

        function init() {
            if (intervalId) clearInterval(intervalId);
            isGameRunning = false;
            intervalId = null;
            const totalNumbers = parseInt(maxNumberInput.value, 10) || 90;
            maxNumberInput.value = totalNumbers;
            bingoBoardTitle.textContent = `Bảng số (1 - ${totalNumbers})`;
            allNumbers = Array.from({ length: totalNumbers }, (_, i) => i + 1);
            availableNumbers = [...allNumbers];
            calledNumbers = [];
            currentNumberDisplay.textContent = '--';
            currentNumberDisplay.classList.remove('text-black');
            currentNumberDisplay.classList.add('text-gray-300');
            countDisplay.textContent = `0/${totalNumbers}`;
            updateStatus('ready');
            bingoBoard.innerHTML = '';
            allNumbers.forEach(num => {
                const cell = document.createElement('div');
                cell.id = `cell-${num}`;
                cell.textContent = num;
                cell.className = 'bingo-cell w-full aspect-square flex items-center justify-center text-[10px] md:text-sm font-medium cursor-default select-none';
                bingoBoard.appendChild(cell);
            });
            calledNumbersHistory.innerHTML = '<span class="text-[10px] text-gray-300 w-full text-center italic">Trống</span>';
            speak("Sẵn sàng");
        }

        function updateUI(newNumber) {
            currentNumberDisplay.textContent = newNumber;
            currentNumberDisplay.classList.remove('text-gray-300');
            currentNumberDisplay.classList.add('text-black', 'pop-animation');
            setTimeout(() => currentNumberDisplay.classList.remove('pop-animation'), 400);
            const cell = document.getElementById(`cell-${newNumber}`);
            if (cell) cell.classList.add('called');
            if (calledNumbers.length === 1) calledNumbersHistory.innerHTML = '';
            const chip = document.createElement('div');
            chip.className = 'flex-shrink-0 w-8 h-8 md:w-10 md:h-10 rounded-full border border-gray-200 bg-white flex items-center justify-center text-xs md:text-sm font-bold text-gray-800 shadow-sm';
            chip.textContent = newNumber;
            calledNumbersHistory.prepend(chip);
            countDisplay.textContent = `${calledNumbers.length}/${allNumbers.length}`;
        }

        function drawNumber() {
            if (availableNumbers.length === 0) {
                clearInterval(intervalId);
                isGameRunning = false;
                updateStatus('finished');
                speak("Đã hết số.");
                return;
            }
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            const newNumber = availableNumbers[randomIndex];
            availableNumbers.splice(randomIndex, 1);
            calledNumbers.push(newNumber);
            updateUI(newNumber);
            speak(`${newNumber}`);
        }

        function toggleGame() {
            if (availableNumbers.length === 0) return;
            isGameRunning = !isGameRunning;
            if (isGameRunning) {
                updateStatus('playing');
                drawNumber();
                intervalId = setInterval(drawNumber, speed);
            } else {
                updateStatus('paused');
                clearInterval(intervalId);
            }
        }

        function showModal(el) {
            el.classList.remove('hidden');
            void el.offsetWidth;
            const backdrop = el.querySelector('.modal-backdrop');
            const content = el.querySelector('.modal-content');
            backdrop.classList.remove('opacity-0');
            if (content.classList.contains('translate-x-full')) content.classList.remove('translate-x-full');
            else { content.classList.remove('opacity-0', 'scale-95'); content.classList.add('scale-100', 'opacity-100'); }
        }

        function hideModal(el) {
            const backdrop = el.querySelector('.modal-backdrop');
            const content = el.querySelector('.modal-content');
            backdrop.classList.add('opacity-0');
            if (content.classList.contains('translate-x-full') || el.id === 'settings-modal') content.classList.add('translate-x-full');
            else { content.classList.remove('scale-100', 'opacity-100'); content.classList.add('opacity-0', 'scale-95'); }
            setTimeout(() => el.classList.add('hidden'), 300);
        }

        function populateVoiceList() {
            const selectedLanguage = languageSelect.value;
            const voicesForLanguage = voices.filter(voice => voice.lang === selectedLanguage);
            voiceSelect.innerHTML = '';
            voicesForLanguage.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = voice.name;
                option.value = voice.name;
                voiceSelect.appendChild(option);
            });
        }

        function populateLanguageList() {
            voices = synth.getVoices();
            if (voices.length === 0) return;
            const languages = [...new Set(voices.map(voice => voice.lang))].sort();
            languageSelect.innerHTML = '';
            languages.forEach(lang => {
                const option = document.createElement('option');
                option.textContent = lang;
                option.value = lang;
                languageSelect.appendChild(option);
            });
            const defaultLang = languages.find(l => l.includes('vi')) || languages[0];
            if (defaultLang) languageSelect.value = defaultLang;
            populateVoiceList();
        }

        startPauseBtn.addEventListener('click', toggleGame);
        nextBtn.addEventListener('click', () => { if (!isGameRunning && availableNumbers.length > 0) drawNumber(); });
        resetBtn.addEventListener('click', () => { if (calledNumbers.length > 0) showModal(resetModal); });
        openSettingsBtn.addEventListener('click', () => showModal(settingsModal));
        closeSettingsBtn.addEventListener('click', () => hideModal(settingsModal));
        confirmResetYes.addEventListener('click', () => { init(); hideModal(resetModal); });
        confirmResetNo.addEventListener('click', () => hideModal(resetModal));
        applySettingsBtn.addEventListener('click', () => { init(); hideModal(settingsModal); });
        speedSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            const seconds = 11 - val;
            speed = seconds * 1000;
            speedValue.textContent = `${seconds}s`;
            if (isGameRunning) { clearInterval(intervalId); intervalId = setInterval(drawNumber, speed); }
        });
        speakToggle.addEventListener('change', () => {
            voiceControls.style.opacity = speakToggle.checked ? '1' : '0.5';
            voiceControls.style.pointerEvents = speakToggle.checked ? 'auto' : 'none';
        });
        languageSelect.addEventListener('change', populateVoiceList);
        testVoiceBtn.addEventListener('click', () => speak('1 2 3 Alo'));

        window.onload = () => {
            if (synth) { speechSynthesis.onvoiceschanged = populateLanguageList; populateLanguageList(); }
            const initialSeconds = 11 - speedSlider.value;
            speedValue.textContent = `${initialSeconds}s`;
            speed = initialSeconds * 1000;
            init();
        };

        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js').catch(console.error);
    </script>
</body>
</html>