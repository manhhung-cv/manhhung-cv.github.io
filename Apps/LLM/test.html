<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cổng Tra Cứu Kết Quả Học Tập</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Hiệu ứng xuất hiện */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeInUp 0.5s ease-out forwards; }

        /* Tùy chỉnh thanh cuộn cho bảng trên mobile */
        .custom-scrollbar::-webkit-scrollbar { height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* Loader giả lập */
        .loader {
            border-top-color: #3B82F6;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8">

    <div class="text-center mb-8 max-w-2xl">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-600 text-white mb-4 shadow-lg shadow-blue-500/30">
            <i class="fas fa-graduation-cap text-3xl"></i>
        </div>
        <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-800 tracking-tight">Tra Cứu Điểm Thi</h1>
        <p class="text-slate-500 mt-2 text-lg">Hệ thống quản lý học tập trực tuyến</p>
    </div>

    <div class="w-full max-w-lg bg-white rounded-2xl shadow-xl p-6 mb-8 border border-slate-100">
        <label class="block text-sm font-medium text-slate-700 mb-2">Mã số sinh viên</label>
        <div class="flex flex-col sm:flex-row gap-3">
            <div class="relative flex-1">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-id-card text-slate-400"></i>
                </div>
                <input type="text" id="searchInput" 
                    class="block w-full pl-10 pr-3 py-3 border border-slate-300 rounded-xl leading-5 bg-slate-50 placeholder-slate-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out sm:text-sm" 
                    placeholder="VD: SV001">
            </div>
            <button onclick="handleSearch()" 
                class="w-full sm:w-auto flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-lg shadow-blue-600/30 transition-all active:scale-95">
                <span id="btnText">Tra cứu</span>
                <div id="btnLoader" class="loader ease-linear rounded-full border-2 border-t-2 border-gray-200 h-5 w-5 ml-2 hidden"></div>
            </button>
        </div>
    </div>

    <div id="resultArea" class="hidden w-full max-w-4xl animate-fade-in">
        
        <div class="flex flex-wrap gap-3 mb-6 justify-center md:justify-end">
            <button onclick="exportPDF()" class="flex-1 sm:flex-none bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-file-pdf"></i> <span class="text-sm">PDF</span>
            </button>
            <button onclick="exportImage()" class="flex-1 sm:flex-none bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-image"></i> <span class="text-sm">Ảnh</span>
            </button>
            <button onclick="exportExcel()" class="flex-1 sm:flex-none bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-file-excel"></i> <span class="text-sm">Excel</span>
            </button>
            <button onclick="exportJSON()" class="flex-1 sm:flex-none bg-amber-50 text-amber-600 hover:bg-amber-100 border border-amber-200 font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-code"></i> <span class="text-sm">JSON</span>
            </button>
        </div>

        <div id="transcript-card" class="bg-white p-8 sm:p-10 rounded-none sm:rounded-lg shadow-2xl relative overflow-hidden text-slate-800">
            <div class="border-b-2 border-slate-800 pb-6 mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-university text-3xl text-slate-800"></i>
                        <h2 class="text-xl font-bold uppercase tracking-wide">Đại Học Công Nghệ FTS</h2>
                    </div>
                    <p class="text-sm text-slate-500 font-medium">Phòng Đào Tạo & Khảo Thí</p>
                </div>
                <div class="text-left sm:text-right w-full sm:w-auto bg-slate-50 p-3 rounded-lg border border-slate-100">
                    <p class="font-bold text-lg text-slate-900" id="dispName">Nguyễn Văn A</p>
                    <p class="text-sm text-slate-600">MSSV: <span id="dispId" class="font-mono font-bold">SV001</span></p>
                    <p class="text-sm text-slate-600">Ngày sinh: <span id="dispDob">01/01/2000</span></p>
                </div>
            </div>

            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold uppercase text-slate-800">Bảng Kết Quả Học Tập</h3>
                <p class="text-sm text-slate-500 italic">Học kỳ I - Năm học 2024-2025</p>
            </div>

            <div class="overflow-x-auto custom-scrollbar mb-6">
                <table class="w-full text-left border-collapse min-w-[500px]">
                    <thead>
                        <tr class="bg-slate-100 text-slate-700 text-sm uppercase tracking-wider">
                            <th class="p-3 font-bold border-b border-slate-300 rounded-tl-lg">STT</th>
                            <th class="p-3 font-bold border-b border-slate-300">Môn học</th>
                            <th class="p-3 font-bold border-b border-slate-300 text-center">Tín chỉ</th>
                            <th class="p-3 font-bold border-b border-slate-300 text-right rounded-tr-lg">Điểm (hệ 10)</th>
                        </tr>
                    </thead>
                    <tbody id="scoreTableBody" class="text-sm text-slate-600">
                        </tbody>
                    <tfoot>
                        <tr class="bg-blue-50">
                            <td colspan="2" class="p-4 font-bold text-slate-800 border-t border-blue-200 rounded-bl-lg">ĐIỂM TRUNG BÌNH (GPA)</td>
                            <td class="p-4 text-center border-t border-blue-200"></td>
                            <td class="p-4 text-right font-bold text-blue-700 text-lg border-t border-blue-200 rounded-br-lg" id="dispGPA">8.5</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="flex justify-between items-start mt-12 text-sm text-slate-600">
                <div class="w-1/3 text-center hidden sm:block">
                    <div class="w-20 h-20 bg-slate-100 mx-auto mb-2 flex items-center justify-center border">
                        <i class="fas fa-qrcode text-2xl text-slate-300"></i>
                    </div>
                    <p class="text-xs">Xác thực điện tử</p>
                </div>
                <div class="w-full sm:w-1/3 text-center">
                    <p class="italic mb-8">Hà Nội, ngày <span id="currentDay"></span> tháng <span id="currentMonth"></span> năm <span id="currentYear"></span></p>
                    <p class="font-bold uppercase text-slate-800">Người Lập Bảng</p>
                    <p class="mt-16 font-bold text-slate-800">Phòng Đào Tạo</p>
                </div>
            </div>
            
            <div class="mt-8 pt-4 border-t border-slate-100 text-center text-xs text-slate-400">
                Hệ thống tra cứu điểm FTS - Truy xuất lúc <span id="currentTime"></span>
            </div>
        </div>

        <div class="h-20"></div> </div>

    <div id="toast" class="fixed bottom-5 right-5 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <i class="fas fa-info-circle mr-2 text-blue-400"></i>
        <span id="toastMsg">Thông báo</span>
    </div>

    <script>
        // --- 1. DỮ LIỆU MẪU (BẠN THAY JSON CỦA BẠN VÀO ĐÂY) ---
        const studentData = [
            {
                "id": "SV001", "name": "Nguyễn Văn A", "dob": "20/10/2000",
                "scores": [
                    { "subject": "Toán Cao Cấp 1", "credits": 3, "grade": 8.5 },
                    { "subject": "Lập Trình Web Fontend", "credits": 4, "grade": 9.2 },
                    { "subject": "Cấu Trúc Dữ Liệu & GT", "credits": 3, "grade": 7.8 },
                    { "subject": "Tiếng Anh Chuyên Ngành", "credits": 2, "grade": 8.0 },
                    { "subject": "Triết Học Mác - Lênin", "credits": 3, "grade": 6.5 }
                ]
            },
            {
                "id": "SV002", "name": "Trần Thị B", "dob": "15/05/2001",
                "scores": [
                    { "subject": "Toán Cao Cấp 1", "credits": 3, "grade": 5.5 },
                    { "subject": "Lập Trình Web Fontend", "credits": 4, "grade": 6.0 },
                    { "subject": "Cấu Trúc Dữ Liệu & GT", "credits": 3, "grade": 8.5 }
                ]
            }
        ];

        let currentStudent = null;

        // --- 2. XỬ LÝ GIAO DIỆN ---
        function handleSearch() {
            const btnText = document.getElementById('btnText');
            const btnLoader = document.getElementById('btnLoader');
            
            // Hiệu ứng Loading
            btnText.innerText = 'Đang tìm...';
            btnLoader.classList.remove('hidden');
            
            setTimeout(() => {
                searchStudent();
                btnText.innerText = 'Tra cứu';
                btnLoader.classList.add('hidden');
            }, 600); // Giả lập độ trễ mạng để UI mượt hơn
        }

        function searchStudent() {
            const input = document.getElementById('searchInput').value.trim().toUpperCase();
            const resultArea = document.getElementById('resultArea');
            
            currentStudent = studentData.find(s => s.id === input);

            if (currentStudent) {
                resultArea.classList.remove('hidden');
                
                // Re-trigger animation
                resultArea.classList.remove('animate-fade-in');
                void resultArea.offsetWidth; 
                resultArea.classList.add('animate-fade-in');

                // Fill Info
                document.getElementById('dispName').innerText = currentStudent.name;
                document.getElementById('dispId').innerText = currentStudent.id;
                document.getElementById('dispDob').innerText = currentStudent.dob;
                
                // Date Footer
                const now = new Date();
                document.getElementById('currentDay').innerText = now.getDate();
                document.getElementById('currentMonth').innerText = now.getMonth() + 1;
                document.getElementById('currentYear').innerText = now.getFullYear();
                document.getElementById('currentTime').innerText = now.toLocaleString('vi-VN');

                // Fill Table
                const tbody = document.getElementById('scoreTableBody');
                tbody.innerHTML = '';
                
                let totalScore = 0;
                let totalCredits = 0;

                currentStudent.scores.forEach((s, index) => {
                    totalScore += s.grade * s.credits;
                    totalCredits += s.credits;

                    // Row Styling
                    const rowClass = index % 2 === 0 ? "bg-white" : "bg-slate-50";
                    const gradeClass = s.grade >= 8 ? "text-green-600 font-bold" : (s.grade < 5 ? "text-red-500 font-bold" : "text-slate-800");

                    const row = `
                        <tr class="${rowClass} hover:bg-blue-50 transition-colors border-b border-slate-100">
                            <td class="p-3 text-center text-slate-400">${index + 1}</td>
                            <td class="p-3 font-medium">${s.subject}</td>
                            <td class="p-3 text-center">${s.credits}</td>
                            <td class="p-3 text-right ${gradeClass}">${s.grade}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

                const gpa = totalCredits > 0 ? (totalScore / totalCredits).toFixed(2) : 0;
                document.getElementById('dispGPA').innerText = gpa;
                
                showToast(`Đã tìm thấy sinh viên: ${currentStudent.name}`, 'success');

            } else {
                resultArea.classList.add('hidden');
                showToast(`Không tìm thấy mã số: ${input}`, 'error');
            }
        }

        function showToast(msg, type = 'info') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            
            // Color based on type
            if(type === 'error') toast.className = "fixed bottom-5 right-5 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-y-0 opacity-100";
            else toast.className = "fixed bottom-5 right-5 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-y-0 opacity-100";

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // --- 3. EXPORT FUNCTIONS ---

        async function exportPDF() {
            if (!currentStudent) return;
            showToast("Đang tạo PDF...", "info");
            
            const element = document.getElementById('transcript-card');
            
            // Tăng scale để ảnh nét hơn khi in
            const canvas = await html2canvas(element, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL('image/png');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgProps = pdf.getImageProperties(imgData);
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save(`BangDiem_${currentStudent.id}.pdf`);
        }

        function exportImage() {
            if (!currentStudent) return;
            const element = document.getElementById('transcript-card');
            
            html2canvas(element, { scale: 3 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `BangDiem_${currentStudent.id}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function exportExcel() {
            if (!currentStudent) return;
            
            const dataToExport = currentStudent.scores.map(s => ({
                "Mã SV": currentStudent.id,
                "Tên SV": currentStudent.name,
                "Ngày sinh": currentStudent.dob,
                "Môn học": s.subject,
                "Số tín chỉ": s.credits,
                "Điểm": s.grade
            }));

            const ws = XLSX.utils.json_to_sheet(dataToExport);
            
            // Auto width columns
            const wscols = [
                {wch:10}, {wch:20}, {wch:12}, {wch:30}, {wch:10}, {wch:10}
            ];
            ws['!cols'] = wscols;

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "BangDiem");
            XLSX.writeFile(wb, `BangDiem_${currentStudent.id}.xlsx`);
        }

        function exportJSON() {
            if (!currentStudent) return;
            const dataStr = JSON.stringify(currentStudent, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `DuLieu_${currentStudent.id}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Enter key support
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') handleSearch();
        });
    </script>
</body>
</html>