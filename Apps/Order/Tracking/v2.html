<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="/Asset/logo/iconApps.png">
    <link rel="apple-touch-icon" href="/Asset/logo/iconApps.png" sizes="150x150">

    <meta property="og:image" content="/Asset/img/Banner.png">
    <meta property="og:title" content="QL ƒê∆°n H√†ng ‚ú®">
    <meta property="og:description" content="Thi·∫øt k·∫ø v√† l·∫≠p tr√¨nh ƒêinh M·∫°nh H√πng">
    <title>Hunq Express</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Default Theme (Dark) */
            --bg-body: #0f172a;
            --bg-glass: rgba(30, 41, 59, 0.9);
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-card-hover: rgba(255, 255, 255, 0.06);
            --glass-border: rgba(255, 255, 255, 0.1);

            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --text-inv: #000;

            --input-bg: rgba(0, 0, 0, 0.3);
            --input-focus: rgba(0, 0, 0, 0.5);

            /* Primary Color */
            --primary: #38bdf8;
            --p-rgb: 56, 189, 248;

            --success: #34d399;
            --warning: #facc15;
            --danger: #ef4444;
            --radius-md: 12px;
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-glass: rgba(255, 255, 255, 0.9);
            --bg-card: rgba(0, 0, 0, 0.03);
            --bg-card-hover: rgba(0, 0, 0, 0.06);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-main: #0f172a;
            --text-muted: #64748b;
            --text-inv: #fff;
            --input-bg: rgba(255, 255, 255, 0.5);
            --input-focus: #fff;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            background-image:
                radial-gradient(circle at 0% 0%, rgba(var(--p-rgb), 0.1) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(var(--p-rgb), 0.05) 0%, transparent 40%);
            background-attachment: fixed;
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s, color 0.3s;
        }

        /* --- Layout --- */
        .app-wrapper {
            width: 100%;
            height: 100%;
            background: var(--bg-glass);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @media (min-width: 769px) {
            .app-wrapper {
                width: 1200px;
                height: 92vh;
                max-width: 95vw;
                border: 1px solid var(--glass-border);
                border-radius: 20px;
                flex-direction: row;
                backdrop-filter: blur(20px);
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
            }
        }

        /* Sidebar */
        .sidebar {
            width: 100%;
            height: auto;
            background: rgba(var(--p-rgb), 0.03);
            border-bottom: 1px solid var(--glass-border);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            overflow-x: auto;
            flex-shrink: 0;
            scrollbar-width: none;
        }

        @media (min-width: 769px) {
            .sidebar {
                width: 280px;
                height: 100%;
                flex-direction: column;
                border-bottom: none;
                border-right: 1px solid var(--glass-border);
                padding: 20px;
                align-items: stretch;
                overflow-y: auto;
                overflow-x: hidden;
            }
        }

        .brand {
            font-size: 18px;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 20px;
            display: none;
            padding-left: 5px;
            align-items: center;
            gap: 10px;
        }

        .brand i {
            color: var(--primary);
        }

        @media (min-width: 769px) {
            .brand {
                display: flex;
            }
        }

        .pkg-item {
            min-width: 130px;
            padding: 8px 12px;
            background: var(--bg-card);
            border-radius: 10px;
            cursor: pointer;
            border: 1px solid transparent;
            position: relative;
            transition: 0.2s;
            color: var(--text-muted);
        }

        @media (min-width: 769px) {
            .pkg-item {
                width: 100%;
                margin-bottom: 8px;
                padding: 12px;
            }
        }

        .pkg-item:hover {
            background: var(--bg-card-hover);
            color: var(--text-main);
        }

        .pkg-item.active {
            background: rgba(var(--p-rgb), 0.15);
            border-color: var(--primary);
            color: var(--text-main);
        }

        .pkg-name {
            font-size: 13px;
            font-weight: 600;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pkg-meta {
            font-size: 11px;
            margin-top: 4px;
            display: none;
            justify-content: space-between;
            opacity: 0.8;
        }

        @media (min-width: 769px) {
            .pkg-meta {
                display: flex;
            }
        }

        .btn-del-pkg {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            display: none;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 769px) {
            .pkg-item:hover .btn-del-pkg {
                display: flex;
            }
        }

        /* Main View */
        .main-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        .top-bar {
            padding: 12px 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .pkg-info-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .current-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            gap: 8px;
            align-items: center;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-action-sm {
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--glass-border);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-action-sm:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
        }

        .btn-danger-sm {
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .btn-danger-sm:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
        }

        .btn-select-mode {
            color: var(--text-main);
            border-color: var(--glass-border);
        }
        .btn-select-mode.active {
            background: var(--text-main);
            color: var(--bg-body);
        }

        .top-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stats {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        @media (max-width: 600px) {
            .stats { display: none; }
        }

        .stats b {
            color: var(--text-main);
            margin-right: 4px;
        }

        .btn-settings {
            font-size: 16px;
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: grid;
            place-items: center;
        }

        /* Input Area */
        .input-area {
            padding: 15px 20px;
            flex-shrink: 0;
        }

        .input-wrapper {
            position: relative;
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            background: var(--input-bg);
            transition: 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            background: var(--input-focus);
            box-shadow: 0 0 0 2px rgba(var(--p-rgb), 0.2);
        }

        .main-textarea {
            width: 100%;
            height: 50px;
            background: transparent;
            border: none;
            color: var(--text-main);
            padding: 12px;
            padding-right: 90px;
            font-family: monospace;
            font-size: 14px;
            resize: none;
            transition: 0.3s;
        }

        .main-textarea:focus {
            height: 100px;
        }

        .btn-add {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: var(--primary);
            color: var(--text-inv);
            border: none;
            padding: 6px 16px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
        }

        /* Toolbar */
        .toolbar {
            padding: 0 20px 10px 20px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            align-items: center;
            flex-shrink: 0;
            scrollbar-width: none;
        }

        .filter-chip {
            white-space: nowrap;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            background: transparent;
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
        }

        .filter-chip.active {
            background: var(--text-main);
            color: var(--bg-body);
            font-weight: 700;
            border-color: var(--text-main);
        }

        .view-toggle {
            display: flex;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 3px;
            margin-left: auto;
            border: 1px solid var(--glass-border);
        }

        .view-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }

        .view-btn:hover {
            color: var(--text-main);
        }

        .view-btn.active {
            background: var(--primary);
            color: var(--text-inv);
        }

        /* Order List Base */
        .order-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 20px 80px 20px;
            display: grid;
            gap: 12px;
            align-content: start;
        }

        /* LAYOUT: GRID & LIST & DETAIL (Standard Cards) */
        .layout-grid {
            grid-template-columns: 1fr;
        }

        @media (min-width: 769px) {
            .layout-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }

        .layout-list,
        .layout-detail {
            display: flex;
            flex-direction: column;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: 16px;
            position: relative;
            transition: background 0.2s;
        }

        .card:hover {
            background: var(--bg-card-hover);
            border-color: rgba(var(--p-rgb), 0.3);
        }
        
        .card.selected {
            border-color: var(--primary);
            background: rgba(var(--p-rgb), 0.1);
        }

        /* Standard Card Elements */
        .card-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 6px;
            z-index: 2;
        }

        .act-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: var(--bg-body);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            display: grid;
            place-items: center;
            cursor: pointer;
            font-size: 12px;
        }

        .act-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .act-del:hover {
            border-color: var(--danger);
            color: var(--danger);
        }

        .card-header {
            margin-bottom: 8px;
            padding-right: 70px;
        }

        .card-code {
            font-family: monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-main);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        /* Status Colors */
        .st-ok {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
        }

        .st-vn {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .st-mv {
            background: rgba(var(--p-rgb), 0.2);
            color: var(--primary);
        }

        .st-cn {
            background: rgba(129, 140, 248, 0.2);
            color: var(--primary);
        }

        .st-no {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-muted);
        }

        .st-err {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .api-note-tag {
            display: inline-block;
            font-size: 10px;
            color: var(--bg-body);
            background: var(--text-muted);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .user-note-inp {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px dashed var(--glass-border);
            color: var(--text-muted);
            font-size: 13px;
            padding: 5px 0;
            margin-top: 5px;
        }

        .user-note-inp:focus {
            border-bottom-color: var(--primary);
            color: var(--text-main);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 10px;
            border-top: 1px solid var(--glass-border);
            padding-top: 8px;
        }

        .weight-box {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-main);
        }
        
        /* SELECT MODE INDICATORS */
        .select-check {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--text-muted);
            z-index: 5;
            background: var(--bg-body);
            display: grid;
            place-items: center;
            font-size: 0;
            transition: 0.2s;
        }
        
        .card.selected .select-check {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--text-inv);
            font-size: 12px;
        }
        
        /* Ch·ªânh l·∫°i padding header khi c√≥ n√∫t select */
        .select-mode-on .card-header {
            padding-left: 25px;
        }
        
        /* Bulk Actions Bar */
        .bulk-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .bulk-bar.show {
            transform: translateY(0);
        }
        
        .bulk-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bulk-right {
            display: flex;
            gap: 10px;
        }
        
        .btn-bulk {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: var(--bg-card);
            color: var(--text-main);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-bulk-danger {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.2);
        }

        /* LAYOUT: SUPER MINIMALIST (V7 New Feature) */
        .layout-super {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .super-card {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            gap: 12px;
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            height: 50px;
            cursor: pointer;
        }
        
        .super-card.selected {
             border-color: var(--primary);
             background: rgba(var(--p-rgb), 0.15);
        }

        .super-card:hover {
            background: var(--bg-card-hover);
        }

        .super-status {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: grid;
            place-items: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .super-select-box {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: grid;
            place-items: center;
            flex-shrink: 0;
            border: 2px solid var(--glass-border);
            color: transparent;
        }
        
        .super-card.selected .super-select-box {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--text-inv);
        }

        .super-code {
            font-family: monospace;
            font-weight: 700;
            font-size: 15px;
            color: var(--text-main);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            flex: 1;
        }

        .super-note {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: var(--primary);
            color: var(--bg-body);
            font-weight: 700;
            white-space: nowrap;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .super-weight {
            font-weight: 700;
            font-size: 14px;
            color: var(--text-main);
            width: 70px;
            text-align: right;
        }

        .super-actions {
            display: flex;
            gap: 5px;
            margin-left: 5px;
        }

        .s-act-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid var(--glass-border);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: grid;
            place-items: center;
            font-size: 11px;
        }

        .s-act-btn:hover {
            background: var(--primary);
            color: var(--text-inv);
        }

        /* Detail Table */
        .detail-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 12px;
            font-size: 12px;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        .detail-table tr:nth-child(even) {
            background: var(--bg-card-hover);
        }

        .detail-table td {
            padding: 8px;
            border-bottom: 1px solid var(--glass-border);
        }

        .dt-label {
            color: var(--text-muted);
            width: 130px;
        }

        .dt-val {
            color: var(--text-main);
            font-weight: 500;
            font-family: monospace;
        }

        /* Modals & Toast */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-box {
            background: var(--bg-body);
            width: 90%;
            max-width: 360px;
            padding: 24px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .modal-inp {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            border-radius: 10px;
        }

        .modal-btns {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-m {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-m-c {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--glass-border);
        }

        .btn-m-s {
            background: var(--primary);
            color: var(--text-inv);
        }

        /* Settings Modal */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .color-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-dot.active {
            border-color: var(--text-main);
            transform: scale(1.1);
        }

        .theme-toggle {
            display: flex;
            background: var(--bg-card);
            padding: 5px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
        }

        .tt-btn {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text-muted);
            padding: 8px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }

        .tt-btn.active {
            background: var(--bg-body);
            color: var(--text-main);
        }

        #toast {
            visibility: hidden;
            background-color: var(--primary);
            color: var(--text-inv);
            border-radius: 50px;
            padding: 10px 20px;
            position: fixed;
            z-index: 200;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 700;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div class="app-wrapper">
        <div class="sidebar">
            <div class="brand"><i class="fa-solid fa-cube"></i> HUNQ V7</div>
            <button class="pkg-item" onclick="openModalPkg()"
                style="background:rgba(255,255,255,0.1); justify-content:center; display:flex; min-width:40px"><i
                    class="fa-solid fa-plus"></i></button>
            <div id="pkgListContainer" style="display:contents"></div>
        </div>

        <div class="main-view">
            <div class="top-bar">
                <div class="pkg-info-group">
                    <div class="current-title" onclick="openModalPkg(true)">
                        <span id="txtPkgName">Loading...</span> <i class="fa-solid fa-pen"
                            style="font-size:12px; opacity:0.5; margin-left:5px"></i>
                    </div>
                    <button class="btn-action-sm" onclick="copyPkgInfo()"><i class="fa-regular fa-copy"></i> Sao
                        ch√©p</button>
                    <button class="btn-action-sm btn-danger-sm" onclick="delPkg(data.curId)"><i
                            class="fa-solid fa-trash"></i> Xo√°</button>
                            <button class="btn-action-sm btn-select-mode" id="btnSelectMode" onclick="toggleSelectMode()">
                        <i class="fa-regular fa-square-check"></i> Ch·ªçn
                    </button>
                    
                </div>
                <div class="top-right">
                    <div class="stats"><span><b><span id="stCount">0</span></b>ƒë∆°n</span><span><b><span
                                    id="stWeight">0</span></b>kg</span></div>
                                    
                    
                    <button class="btn-settings" onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <textarea id="inpCodes" class="main-textarea"
                        placeholder="Nh·∫≠p m√£ v·∫≠n ƒë∆°n (Enter xu·ªëng d√≤ng)..."></textarea>
                    <button class="btn-add" onclick="addOrders()">Tra C·ª©u</button>
                </div>
            </div>

            <div class="toolbar">
                <button class="filter-chip active" onclick="setFilter('all')">T·∫•t c·∫£</button>
                <button class="filter-chip" onclick="setFilter('cn')">Kho TQ</button>
                <button class="filter-chip" onclick="setFilter('wait')">Ch∆∞a nh·∫≠p kho</button>
                <button class="filter-chip" onclick="setFilter('delivered')">ƒêang giao</button>
                <button class="filter-chip" onclick="setFilter('vn')">Kho VN</button>
                <button class="filter-chip" onclick="setFilter('transit')">ƒêang v·ªÅ</button>


                <div class="view-toggle">
                    <button class="view-btn" id="btnSuper" onclick="setView('super')" title="Si√™u t·ªëi gi·∫£n"><i
                            class="fa-solid fa-bars"></i></button>
                    <button class="view-btn" id="btnList" onclick="setView('list')" title="Danh s√°ch"><i
                            class="fa-solid fa-list-ul"></i></button>
                    <button class="view-btn active" id="btnGrid" onclick="setView('grid')" title="Th·∫ª"><i
                            class="fa-solid fa-border-all"></i></button>
                    <button class="view-btn" id="btnDetail" onclick="setView('detail')" title="Chi ti·∫øt"><i
                            class="fa-solid fa-circle-info"></i></button>
                    
                </div>
            </div>

            <div class="order-list layout-grid" id="orderList"></div>
            
            <div class="bulk-bar" id="bulkBar">
                <div class="bulk-left">
                    <button class="btn-bulk" onclick="toggleSelectAll()">
                        <i class="fa-solid fa-check-double"></i> Ch·ªçn t·∫•t c·∫£
                    </button>
                    <span style="font-size:13px; font-weight:700; color:var(--text-main)" id="selectCount">0 ƒë√£ ch·ªçn</span>
                </div>
                <div class="bulk-right">
                    <button class="btn-bulk" onclick="bulkCopy()">
                        <i class="fa-regular fa-copy"></i>
                    </button>
                    <button class="btn-bulk btn-bulk-danger" onclick="bulkDelete()">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalPkg">
        <div class="modal-box">
            <h3 style="margin:0 0 20px 0;color:var(--text-main)">T√™n ki·ªán h√†ng</h3>
            <input type="text" id="modalInp" class="modal-inp" placeholder="VD: H√†ng 05/12...">
            <div class="modal-btns">
                <button class="btn-m btn-m-c"
                    onclick="document.getElementById('modalPkg').style.display='none'">ƒê√≥ng</button>
                <button class="btn-m btn-m-s" onclick="savePkg()">L∆∞u</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalSettings">
        <div class="modal-box">
            <h3 style="margin:0 0 20px 0;color:var(--text-main)">C√†i ƒë·∫∑t</h3>
            <div style="font-size:12px;margin-bottom:5px;color:var(--text-muted)">GIAO DI·ªÜN</div>
            <div class="theme-toggle">
                <button class="tt-btn" id="btnThemeDark" onclick="setTheme('dark')"><i class="fa-solid fa-moon"></i>
                    T·ªëi</button>
                <button class="tt-btn" id="btnThemeLight" onclick="setTheme('light')"><i class="fa-solid fa-sun"></i>
                    S√°ng</button>
            </div>
            <div style="font-size:12px;margin-bottom:10px;color:var(--text-muted)">M√ÄU S·∫ÆC</div>
            <div class="color-grid" id="colorGrid"></div>
            <div class="modal-btns"><button class="btn-m btn-m-c"
                    onclick="document.getElementById('modalSettings').style.display='none'">ƒê√≥ng</button></div>
        </div>
    </div>

    <div id="toast">Th√¥ng b√°o</div>

    <script>
        // --- Data & Config ---
        let data = { packages: [{ id: 'p1', name: 'Ki·ªán h√†ng 1', orders: [] }], curId: 'p1' };
        let viewMode = 'grid';
        let filterMode = 'all';
        let settings = { theme: 'dark', color: '#38bdf8' };
        
        // Multi-select variables
        let isSelectMode = false;
        let selectedCodes = new Set();
        let currentRenderedList = []; // To keep track of what's currently visible for "Select All"

        const colors = [
            { hex: '#38bdf8', rgb: '56, 189, 248' }, { hex: '#818cf8', rgb: '129, 140, 248' },
            { hex: '#34d399', rgb: '52, 211, 153' }, { hex: '#facc15', rgb: '250, 204, 21' },
            { hex: '#fb7185', rgb: '251, 113, 133' }, { hex: '#a78bfa', rgb: '167, 139, 250' },
            { hex: '#fbbf24', rgb: '251, 191, 36' }, { hex: '#2dd4bf', rgb: '45, 212, 191' },
            { hex: '#60a5fa', rgb: '96, 165, 250' }, { hex: '#c084fc', rgb: '192, 132, 252' }
        ];

        const detailLabels = {
            "TransactionCode": "M√£ v·∫≠n ƒë∆°n", "Weight": "C√¢n n·∫∑ng (KG)", "Status": "Tr·∫°ng th√°i",
            "StoreCNImportDate": "Nh·∫≠p Kho TQ", "StoreCNExportDate": "Xu·∫•t Kho TQ",
            "StoreVNImportDate": "Nh·∫≠p Kho VN", "StoreVNExportDate": "Xu·∫•t Kho VN",
            "StoreCNNote": "Note TQ", "StoreVNNote": "Note VN",
            "FeeShip": "Ph√≠ Ship", "BigPackageID": "M√£ bao", "ProductNumber": "S·ªë l∆∞·ª£ng", "CreatedDate": "Ng√†y t·∫°o"
        };

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('hunqV7_Data')) data = JSON.parse(localStorage.getItem('hunqV7_Data'));
            if (localStorage.getItem('hunqV7_View')) setView(localStorage.getItem('hunqV7_View')); else setView('grid');
            if (localStorage.getItem('hunqV7_Settings')) settings = JSON.parse(localStorage.getItem('hunqV7_Settings'));
            applySettings(); renderColorGrid(); renderPkgs(); renderOrders();
        });

        function save() { localStorage.setItem('hunqV7_Data', JSON.stringify(data)); renderStats(); }
        function saveSettings() { localStorage.setItem('hunqV7_Settings', JSON.stringify(settings)); }
        function showToast(msg) { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => t.className = "", 3000); }

        // --- Settings ---
        function openSettings() { document.getElementById('modalSettings').style.display = 'flex'; }
        function applySettings() {
            document.body.setAttribute('data-theme', settings.theme);
            document.getElementById('btnThemeDark').className = `tt-btn ${settings.theme === 'dark' ? 'active' : ''}`;
            document.getElementById('btnThemeLight').className = `tt-btn ${settings.theme === 'light' ? 'active' : ''}`;
            const c = colors.find(x => x.hex === settings.color) || colors[0];
            document.documentElement.style.setProperty('--primary', c.hex);
            document.documentElement.style.setProperty('--p-rgb', c.rgb);
        }
        function setTheme(t) { settings.theme = t; applySettings(); saveSettings(); }
        function setColor(h) { settings.color = h; applySettings(); saveSettings(); renderColorGrid(); }
        function renderColorGrid() {
            const g = document.getElementById('colorGrid'); g.innerHTML = '';
            colors.forEach(c => {
                const d = document.createElement('div'); d.className = `color-dot ${settings.color === c.hex ? 'active' : ''}`;
                d.style.backgroundColor = c.hex; d.onclick = () => setColor(c.hex); g.appendChild(d);
            });
        }

        // --- View Controller ---
        function setView(m) {
            viewMode = m; localStorage.setItem('hunqV7_View', m);
            const el = document.getElementById('orderList');
            // Reset classes
            el.className = 'order-list';
            el.classList.add(m === 'super' ? 'layout-super' : `layout-${m}`);

            ['btnList', 'btnGrid', 'btnDetail', 'btnSuper'].forEach(id => document.getElementById(id).classList.remove('active'));
            if (m === 'list') document.getElementById('btnList').classList.add('active');
            if (m === 'grid') document.getElementById('btnGrid').classList.add('active');
            if (m === 'detail') document.getElementById('btnDetail').classList.add('active');
            if (m === 'super') document.getElementById('btnSuper').classList.add('active');
            renderOrders();
        }

        function setFilter(f) {
            filterMode = f;
            document.querySelectorAll('.filter-chip').forEach(b => b.classList.toggle('active', b.innerText.includes(event.target.innerText)));
            // Reset selection when filtering to avoid confusion
            if(isSelectMode) {
                 selectedCodes.clear();
                 updateBulkUI();
            }
            renderOrders();
        }

        // --- Core Logic ---
        function renderPkgs() {
            const c = document.getElementById('pkgListContainer'); c.innerHTML = '';
            data.packages.forEach(p => {
                const d = document.createElement('div'); d.className = `pkg-item ${p.id === data.curId ? 'active' : ''}`;
                d.onclick = (e) => { if (!e.target.closest('.btn-del-pkg')) switchPkg(p.id) };
                const w = p.orders.reduce((a, b) => a + (b.data?.Weight || 0), 0).toFixed(2);
                d.innerHTML = `<span class="pkg-name">${p.name}</span><div class="pkg-meta"><span>${p.orders.length} ƒë∆°n</span><span>${w} KG</span></div><button class="btn-del-pkg" onclick="delPkg('${p.id}')"><i class="fa-solid fa-trash"></i></button>`;
                c.appendChild(d);
            });
            document.getElementById('txtPkgName').innerText = data.packages.find(p => p.id === data.curId)?.name || '';
            renderStats();
        }
        function switchPkg(id) { 
            data.curId = id; 
            isSelectMode = false; // Turn off select mode when switching package
            selectedCodes.clear();
            updateBulkUI();
            renderPkgs(); 
            renderOrders(); 
        }

        // Package CRUD
        let isEdit = false;
        function openModalPkg(e = false) { isEdit = e; const p = data.packages.find(x => x.id === data.curId); document.getElementById('modalInp').value = e ? p.name : ''; document.getElementById('modalPkg').style.display = 'flex'; document.getElementById('modalInp').focus(); }
        function savePkg() {
            const v = document.getElementById('modalInp').value.trim(); if (!v) return;
            if (isEdit) data.packages.find(p => p.id === data.curId).name = v;
            else { const id = 'p' + Date.now(); data.packages.push({ id, name: v, orders: [] }); data.curId = id; }
            document.getElementById('modalPkg').style.display = 'none'; save(); renderPkgs();
        }
        function delPkg(id) { if (confirm('Xo√° ki·ªán?')) { data.packages = data.packages.filter(p => p.id !== id); if (!data.packages.length) data.packages.push({ id: 'p1', name: 'M·∫∑c ƒë·ªãnh', orders: [] }); data.curId = data.packages[0].id; save(); renderPkgs(); renderOrders(); } }

        function copyPkgInfo() {
            const p = data.packages.find(x => x.id === data.curId);
            const tw = p.orders.reduce((a, b) => a + (b.data?.Weight || 0), 0).toFixed(2);
            let t = `üì¶ ${p.name}\nüìä ${p.orders.length} ƒë∆°n | ${tw} KG\n----------------\n`;
            p.orders.forEach((o, i) => { t += `${i + 1}. ${o.code} | ${o.data?.Weight || 0}kg | ${getStatus(o).t}\n` });
            navigator.clipboard.writeText(t); showToast("ƒê√£ copy!");
        }

        // Orders
        async function addOrders() {
            const t = document.getElementById('inpCodes').value; const l = t.split('\n').map(x => x.trim()).filter(x => x); if (!l.length) return;
            const p = data.packages.find(x => x.id === data.curId);
            l.forEach(c => { if (!p.orders.find(o => o.code === c)) p.orders.unshift({ code: c, note: '', loading: true, data: null }); });
            document.getElementById('inpCodes').value = ''; save(); renderOrders();
            for (let o of p.orders) if (o.loading) { await fetchOne(o); save(); renderOrders(); }
        }
        async function fetchOne(o) {
            try {
                const r = await fetch(`https://corsproxy.io/?` + encodeURIComponent(`https://clapi.thanhconglogistics.com/client/api/order_transactions/check/?term=${o.code}`));
                const j = await r.json();
                if (j.data) { o.data = j.data; o.loading = false; o.error = false; } else o.loading = false;
            } catch (e) { o.loading = false; o.error = true; }
        }

        function getStatus(o) {
            if (o.error) return { t: 'L·ªói', c: 'st-err', i: 'fa-wifi' };
            if (o.loading) return { t: 'ƒêang t·∫£i', c: 'st-no', i: 'fa-spinner fa-spin' };
            if (!o.data) return { t: 'Ch∆∞a nh·∫≠p kho', c: 'st-no', i: 'fa-question' };
            const d = o.data;
            if (d.StoreVNExportDate) return { t: 'ƒêang giao', c: 'st-ok', i: 'fa-truck-fast' };
            if (d.StoreVNImportDate) return { t: 'Kho VN', c: 'st-vn', i: 'fa-warehouse' };
            if (d.StoreCNExportDate) return { t: 'ƒêang v·ªÅ', c: 'st-mv', i: 'fa-plane' };
            if (d.StoreCNImportDate) return { t: 'Kho TQ', c: 'st-cn', i: 'fa-box' };
            return { t: 'Ch∆∞a v·ªÅ', c: 'st-no', i: 'fa-clock' };
        }

        function renderDetailTable(d) {
            if (!d) return ''; let h = '<table class="detail-table">';
            for (const [k, l] of Object.entries(detailLabels)) {
                if (d[k] !== null && d[k] !== undefined && d[k] !== "") {
                    let v = d[k]; if (typeof v === 'string' && v.includes('T')) v = v.replace('T', ' ').replace('Z', '').substring(0, 16);
                    h += `<tr><td class="dt-label">${l}</td><td class="dt-val" style="${k === 'Weight' ? 'color:var(--primary)' : ''}">${v}</td></tr>`;
                }
            } return h + '</table>';
        }
        
        // --- MULTI SELECT LOGIC ---
        function toggleSelectMode() {
            isSelectMode = !isSelectMode;
            const btn = document.getElementById('btnSelectMode');
            const bar = document.getElementById('bulkBar');
            
            if (isSelectMode) {
                btn.classList.add('active');
                btn.innerHTML = `<i class="fa-solid fa-check"></i> Xong`;
                bar.classList.add('show');
            } else {
                btn.classList.remove('active');
                btn.innerHTML = `<i class="fa-regular fa-square-check"></i> Ch·ªçn`;
                bar.classList.remove('show');
                selectedCodes.clear(); // Clear selection when exiting mode
                updateBulkUI();
            }
            renderOrders();
        }

        function handleSelect(code) {
            if (!isSelectMode) return;
            
            if (selectedCodes.has(code)) {
                selectedCodes.delete(code);
            } else {
                selectedCodes.add(code);
            }
            updateBulkUI();
            renderOrders(); // Re-render to update visuals
        }
        
        function updateBulkUI() {
            document.getElementById('selectCount').innerText = `${selectedCodes.size} ƒë√£ ch·ªçn`;
        }
        
        function toggleSelectAll() {
            if (selectedCodes.size === currentRenderedList.length && currentRenderedList.length > 0) {
                // If all are selected, deselect all
                selectedCodes.clear();
            } else {
                // Select all currently visible
                currentRenderedList.forEach(o => selectedCodes.add(o.code));
            }
            updateBulkUI();
            renderOrders();
        }
        
        function bulkCopy() {
            if (selectedCodes.size === 0) return showToast("Ch∆∞a ch·ªçn ƒë∆°n n√†o!");
            const txt = Array.from(selectedCodes).join('\n');
            navigator.clipboard.writeText(txt);
            showToast(`ƒê√£ copy ${selectedCodes.size} m√£!`);
        }
        
        function bulkDelete() {
            if (selectedCodes.size === 0) return showToast("Ch∆∞a ch·ªçn ƒë∆°n n√†o!");
            if (confirm(`Xo√° vƒ©nh vi·ªÖn ${selectedCodes.size} ƒë∆°n h√†ng ƒë√£ ch·ªçn?`)) {
                const p = data.packages.find(x => x.id === data.curId);
                p.orders = p.orders.filter(o => !selectedCodes.has(o.code));
                
                selectedCodes.clear();
                toggleSelectMode(); // Exit select mode
                save();
                renderOrders();
                showToast("ƒê√£ xo√°!");
            }
        }

        function renderOrders() {
            const con = document.getElementById('orderList');
            con.innerHTML = '';

            const p = data.packages.find(x => x.id === data.curId);
            if (!p) return;

            let list = p.orders;
            if (filterMode !== 'all') {
                list = list.filter(o => {
                    const s = getStatus(o);
                    if (filterMode === 'delivered') return s.c === 'st-ok';
                    if (filterMode === 'vn') return s.c === 'st-vn';
                    if (filterMode === 'transit') return s.c === 'st-mv';
                    if (filterMode === 'cn') return s.c === 'st-cn';
                    if (filterMode === 'wait') return s.c === 'st-no';
                    return false;
                });
            }
            
            currentRenderedList = list; // Update for Select All logic

            list.forEach(o => {
                const st = getStatus(o);
                const w = o.data?.Weight || 0;
                
                // Select Mode visual logic
                const isSel = selectedCodes.has(o.code);
                const selectClass = isSel ? 'selected' : '';
                const clickAction = isSelectMode ? `onclick="handleSelect('${o.code}')"` : '';

                // Super Note Logic
                let superNote = '';
                if (o.data) {
                    if (o.data.StoreVNNote) superNote = `${o.data.StoreVNNote}`;
                    else if (o.data.StoreCNNote) superNote = `${o.data.StoreCNNote}`;
                }

                if (viewMode === 'super') {
                    // SUPER MINIMALIST RENDER
                    const div = document.createElement('div');
                    div.className = `super-card ${selectClass}`;
                    div.setAttribute('onclick', isSelectMode ? `handleSelect('${o.code}')` : '');
                    
                    let leftIcon = `<div class="super-status ${st.c}" title="${st.t}"><i class="fa-solid ${st.i}"></i></div>`;
                    
                    if(isSelectMode) {
                        leftIcon = `<div class="super-select-box"><i class="fa-solid fa-check"></i></div>`;
                    }

                    div.innerHTML = `
            ${leftIcon}
            <div class="super-code">${o.code}</div>
            ${superNote ? `<div class="super-note">${superNote}</div>` : ''}
            <div class="super-weight">${w} kg</div>
            ${!isSelectMode ? `
            <div class="super-actions">
                <button class="s-act-btn" onclick="event.stopPropagation(); copyTxt('${o.code}')"><i class="fa-regular fa-copy"></i></button>
                <button class="s-act-btn" onclick="event.stopPropagation(); delOrd('${o.code}')" style="color:var(--danger)"><i class="fa-solid fa-trash"></i></button>
            </div>` : ''}
        `;
                    con.appendChild(div);
                } else {
                    // STANDARD CARD RENDER (Grid/List/Detail)
                    let noteTags = '';
                    if (o.data?.StoreCNNote) noteTags += `<span class="api-note-tag">${o.data.StoreCNNote}</span>`;
                    if (o.data?.StoreVNNote) noteTags += `<span class="api-note-tag" style="background:var(--warning);color:var(--bg-body)">${o.data.StoreVNNote}</span>`;
                    
                    // Add padding to header if in select mode
                    const headerClass = isSelectMode ? 'select-mode-on' : '';
                    
                    const div = document.createElement('div');
                    div.className = `card ${selectClass} ${headerClass}`;
                    if(isSelectMode) div.setAttribute('onclick', `handleSelect('${o.code}')`);

                    div.innerHTML = `
            ${isSelectMode ? `<div class="select-check"><i class="fa-solid fa-check"></i></div>` : ''}
            
            ${!isSelectMode ? `
            <div class="card-actions">
                <div class="act-btn" onclick="copyTxt('${o.code}')"><i class="fa-regular fa-copy"></i></div>
                <div class="act-btn act-del" onclick="delOrd('${o.code}')"><i class="fa-solid fa-trash"></i></div>
                ${o.error ? `<div class="act-btn" onclick="retry('${o.code}')"><i class="fa-solid fa-rotate-right"></i></div>` : ''}
            </div>` : ''}
            
            <div class="card-header">
                <div class="status-badge ${st.c}"><i class="fa-solid ${st.i}"></i> ${st.t}</div>
                <div class="card-code">${o.code}</div>
            </div>
            <div style="margin-bottom:5px">${noteTags}</div>
            ${!isSelectMode ? `<input class="user-note-inp" placeholder="+ Ghi ch√∫..." value="${o.note}" onchange="updNote('${o.code}', this.value)">` : ''}
            <div class="card-footer"><div class="weight-box">${w} <span>KG</span></div></div>
            ${(viewMode === 'detail' && o.data) ? renderDetailTable(o.data) : ''}
        `;
                    con.appendChild(div);
                }
            });

            renderStats();
        }

        function renderStats() {
            const p = data.packages.find(x => x.id === data.curId);
            const w = p.orders.reduce((a, b) => a + (b.data?.Weight || 0), 0);
            document.getElementById('stCount').innerText = p.orders.length; document.getElementById('stWeight').innerText = w.toFixed(2);
        }

        function copyTxt(t) { navigator.clipboard.writeText(t); showToast("Copied!"); }
        function updNote(c, v) { data.packages.find(x => x.id === data.curId).orders.find(o => o.code === c).note = v; save(); }
        function delOrd(c) { if (confirm('Xo√°?')) { const p = data.packages.find(x => x.id === data.curId); p.orders = p.orders.filter(o => o.code !== c); save(); renderOrders(); } }
        async function retry(c) { const o = data.packages.find(x => x.id === data.curId).orders.find(x => x.code === c); if (o) { o.loading = true; o.error = false; renderOrders(); await fetchOne(o); save(); renderOrders(); } }
    </script>
</body>

</html>