<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="/Asset/logo/logo.png" />
    <link rel="apple-touch-icon" href="/Asset/logo/iconApps.png" sizes="150x150" />

    <meta property="og:image" content="/Asset/Banner/Banner.png" />
    <meta property="og:title" content="ZenShare" />
    <meta property="og:description" content="Thi·∫øt k·∫ø v√† l·∫≠p tr√¨nh ƒêinh M·∫°nh H√πng" />
    <title>ZenShare - Kho T√†i Kho·∫£n C·ªông ƒê·ªìng</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        zinc: {
                            50: '#fafafa',
                            100: '#f4f4f5',
                            200: '#e4e4e7',
                            300: '#d4d4d8',
                            400: '#a1a1aa',
                            500: '#71717a',
                            600: '#52525b',
                            700: '#3f3f46',
                            800: '#27272a',
                            900: '#18181b',
                            950: '#09090b',
                        },
                        saas: {
                            dark: '#141415', // Premium dark gray instead of pure black for cards
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slideUp 0.3s ease-out forwards'
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: 0, transform: 'translateY(10px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        }
                    },
                    boxShadow: {
                        'saas': '0 2px 8px -2px rgba(0, 0, 0, 0.05), 0 4px 12px -4px rgba(0, 0, 0, 0.05)',
                        'saas-hover': '0 8px 24px -4px rgba(0, 0, 0, 0.08), 0 6px 12px -6px rgba(0, 0, 0, 0.04)',
                        'saas-dark': '0 2px 8px -2px rgba(0, 0, 0, 0.4)',
                        'saas-dark-hover': '0 8px 24px -4px rgba(0, 0, 0, 0.6)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --bg-body: #fafafa;
            --bg-surface: #ffffff;
            --border-color: #e4e4e7;
            --text-main: #09090b;
        }

        .dark {
            --bg-body: #09090b;
            --bg-surface: #141415;
            --border-color: #27272a;
            --text-main: #fafafa;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        /* Tinh ch·ªânh thanh cu·ªôn mang phong c√°ch macOS/SaaS */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #d4d4d8;
            border-radius: 10px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #3f3f46;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }

        .fade-in {
            animation: slideUp 0.4s ease-out forwards;
            opacity: 0;
        }

        /* Loader hi·ªán ƒë·∫°i */
        .loader {
            width: 20px;
            height: 20px;
            border: 2px solid currentColor;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            animation: rotation 0.8s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        mark.highlight {
            background-color: #fef08a;
            /* V√†ng nh·∫°t */
            color: #1f2937;
            padding: 0 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        .dark mark.highlight {
            background-color: #ca8a04;
            color: #ffffff;
        }

        /* N√∫t chuy·ªÉn ·∫£nh trong card */
        .slide-btn {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slide-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.05);
        }

        /* ·∫®n scrollbar cho khu v·ª±c Filter */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="antialiased transition-colors duration-300 min-h-screen flex flex-col">

    <nav
        class="fixed top-0 w-full z-40 bg-white dark:bg-saas-dark border-b border-zinc-200 dark:border-zinc-800 transition-colors duration-300">
        <div class="max-w-[1400px] mx-auto px-4 lg:px-8 h-16 flex items-center justify-between">

            <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.reload()">
                <div
                    class="w-8 h-8 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg flex items-center justify-center font-bold text-[1rem] shadow-sm transition-transform group-hover:scale-105">
                    <i class="fa-brands fa-apple"></i>
                </div>
                <span class="font-extrabold text-lg tracking-tight hidden sm:block">ZenShare</span>
            </div>

            <div class="hidden md:flex flex-1 max-w-lg mx-8 relative group">
                <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-zinc-400">
                    <i class="fa-solid fa-magnifying-glass text-sm"></i>
                </div>
                <input type="text" id="desktopSearch" placeholder="T√¨m ki·∫øm d·ªãch v·ª•, t√†i kho·∫£n..."
                    class="w-full pl-9 pr-12 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-900 border border-transparent focus:border-zinc-300 dark:focus:border-zinc-700 focus:bg-white dark:focus:bg-saas-dark outline-none transition-all text-sm font-medium shadow-inner dark:shadow-none placeholder-zinc-400 dark:placeholder-zinc-600 text-zinc-900 dark:text-white">
                <div class="absolute inset-y-0 right-2 flex items-center pointer-events-none">
                    <span
                        class="text-[10px] font-bold px-1.5 py-0.5 rounded border border-zinc-200 dark:border-zinc-700 text-zinc-400 bg-white dark:bg-zinc-800 shadow-sm hidden lg:block">‚åòK</span>
                </div>
            </div>

            <div class="flex items-center gap-1.5 md:gap-2">
                <button onclick="toggleViewMode()" id="viewModeBtn"
                    class="w-9 h-9 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-colors text-zinc-600 dark:text-zinc-400"
                    title="ƒê·ªïi ch·∫ø ƒë·ªô xem">
                    <i class="fa-solid fa-border-all text-sm"></i>
                </button>

                <button onclick="requestUnlockAll()"
                    class="w-9 h-9 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center justify-center transition-colors text-red-500 hover:text-red-600"
                    title="M·ªü kh√≥a to√†n b·ªô Apple ID">
                    <i class="fa-solid fa-unlock-keyhole text-sm"></i>
                </button>

                <button onclick="openModal('infoModal')"
                    class="w-9 h-9 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-colors text-zinc-600 dark:text-zinc-400"
                    title="H∆∞·ªõng d·∫´n & Ph√°p l√Ω">
                    <i class="fa-regular fa-circle-question text-sm"></i>
                </button>

                <button onclick="toggleTheme()"
                    class="w-9 h-9 rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-colors text-zinc-600 dark:text-zinc-400">
                    <i class="fa-solid fa-moon text-sm dark:hidden"></i>
                    <i class="fa-solid fa-sun text-sm hidden dark:block"></i>
                </button>

                <div id="adminControls"
                    class="hidden flex items-center gap-2 pl-3 border-l border-zinc-200 dark:border-zinc-800 ml-1">
                    <button onclick="openModal('accountModal')"
                        class="bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 px-3 py-1.5 rounded-md text-xs font-semibold hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors flex items-center gap-1.5 shadow-sm">
                        <i class="fa-solid fa-plus text-[10px]"></i> <span class="hidden md:inline">Th√™m</span>
                    </button>
                    <button onclick="openScanModal()"
                        class="bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-zinc-200 dark:border-zinc-700 px-3 py-1.5 rounded-md text-xs font-semibold hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors flex items-center gap-1.5 shadow-sm"
                        title="Qu√©t tr√πng l·∫∑p">
                        <i class="fa-solid fa-broom text-[10px]"></i> <span class="hidden md:inline">Qu√©t</span>
                    </button>
                    <button onclick="handleLogout()"
                        class="text-zinc-400 hover:text-red-500 p-1.5 rounded-md transition-colors"><i
                            class="fa-solid fa-arrow-right-from-bracket text-sm"></i></button>
                </div>
                <button id="loginTrigger" onclick="openModal('loginModal')"
                    class="text-xs font-semibold text-zinc-500 hover:text-zinc-900 dark:hover:text-white ml-2 transition-colors">Admin</button>
            </div>
        </div>

        <div class="md:hidden px-4 pb-3 bg-white dark:bg-saas-dark">
            <div class="relative w-full">
                <span class="absolute inset-y-0 left-3 flex items-center text-zinc-400"><i
                        class="fa-solid fa-magnifying-glass text-xs"></i></span>
                <input type="text" id="mobileSearch" placeholder="T√¨m ki·∫øm nhanh..."
                    class="w-full pl-9 pr-4 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-900 border border-transparent focus:border-zinc-300 dark:focus:border-zinc-700 outline-none text-sm transition-all text-zinc-900 dark:text-white">
            </div>
        </div>
    </nav>

    <main class="flex-grow pt-32 md:pt-28 pb-16 px-4 lg:px-8 max-w-[1400px] mx-auto w-full">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-5 fade-in">
            <div>
                <h1 class="text-3xl font-extrabold tracking-tight text-zinc-900 dark:text-white mb-1">Kho T√†i Kho·∫£n</h1>
                <p class="text-sm text-zinc-500 font-medium">Kh√°m ph√° v√† s·ª≠ d·ª•ng c√°c t√†i nguy√™n ƒë∆∞·ª£c chia s·∫ª.</p>
            </div>

            <div class="flex overflow-x-auto gap-2 p-1 w-full md:w-auto scrollbar-hide bg-zinc-100 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800"
                id="filterContainer"></div>
        </div>

        <div id="loading" class="flex justify-center py-24"><span class="loader text-zinc-400"></span></div>
        <div id="grid" class="grid gap-6 hidden"></div>

        <div id="empty"
            class="hidden flex-col items-center justify-center py-32 text-center fade-in bg-white dark:bg-saas-dark rounded-2xl border border-dashed border-zinc-300 dark:border-zinc-800">
            <div
                class="w-16 h-16 bg-zinc-100 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-4 text-zinc-400 shadow-inner">
                <i class="fa-solid fa-magnifying-glass text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-zinc-900 dark:text-white mb-1">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h3>
            <p class="text-sm text-zinc-500 font-medium">Th·ª≠ ƒëi·ªÅu ch·ªânh b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm c·ªßa b·∫°n.</p>
        </div>
    </main>

    <footer class="border-t border-zinc-200 dark:border-zinc-800 py-8 text-center bg-white dark:bg-saas-dark mt-auto">
        <div
            class="max-w-[1400px] mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4 text-xs font-medium text-zinc-500">
            <p>&copy; 2024 ZenShare. ƒê∆∞·ª£c x√¢y d·ª±ng v√¨ c·ªông ƒë·ªìng.</p>
            <div class="flex gap-4">
                <p class="cursor-pointer hover:text-zinc-900 dark:hover:text-white transition-colors"
                    onclick="openModal('infoModal')">ƒêi·ªÅu kho·∫£n & Mi·ªÖn tr·ª´ tr√°ch nhi·ªám</p>
                <p class="cursor-pointer hover:text-zinc-900 dark:hover:text-white transition-colors"
                    onclick="openModal('loginModal')">ƒêƒÉng nh·∫≠p Admin</p>
            </div>
        </div>
    </footer>

    <div id="scanModal"
        class="fixed inset-0 z-[70] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/60 dark:bg-black/80" onclick="closeModal('scanModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl flex flex-col border border-zinc-200 dark:border-zinc-800 transform scale-95 transition-all duration-300 overflow-hidden">
            <div
                class="flex justify-between items-center p-5 lg:p-6 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-sm flex items-center justify-center text-zinc-900 dark:text-white">
                        <i class="fa-solid fa-broom text-sm"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-zinc-900 dark:text-white leading-tight">Qu√©t & X·ª≠ l√Ω Tr√πng l·∫∑p
                        </h3>
                        <p class="text-xs text-zinc-500 font-medium mt-0.5" id="scanStatus">ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...</p>
                    </div>
                </div>
                <button onclick="closeModal('scanModal')"
                    class="w-8 h-8 rounded-md flex items-center justify-center text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-5 lg:p-6 bg-white dark:bg-saas-dark" id="scanResults"></div>
            <div
                class="p-4 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 text-center text-xs text-zinc-500 font-medium">
                <i class="fa-solid fa-circle-info mr-1"></i> G·ªôp t√†i kho·∫£n s·∫Ω t·ª± ƒë·ªông t·∫°o Slideshow ·∫£nh, n·ªëi m√¥ t·∫£ v√†
                th√¥ng tin ngu·ªìn.
            </div>
        </div>
    </div>

    <div id="mediaModal"
        class="fixed inset-0 z-[70] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/60 dark:bg-black/80" onclick="closeModal('mediaModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-3xl h-[70vh] rounded-xl shadow-2xl flex flex-col border border-zinc-200 dark:border-zinc-800 transform scale-95 transition-all duration-300 overflow-hidden">
            <div
                class="flex justify-between items-center p-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900">
                <h3 class="text-lg font-bold text-zinc-900 dark:text-white">Qu·∫£n l√Ω Media</h3>
                <button onclick="closeModal('mediaModal')"
                    class="w-8 h-8 rounded-md flex items-center justify-center text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="flex border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 px-5 pt-2 gap-4">
                <button onclick="switchMediaTab('upload')" id="tabUpload"
                    class="pb-3 text-sm font-bold border-b-2 border-zinc-900 dark:border-white text-zinc-900 dark:text-white transition-colors">T·∫£i
                    l√™n</button>
                <button onclick="switchMediaTab('library')" id="tabLibrary"
                    class="pb-3 text-sm font-bold border-b-2 border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300 transition-colors">Th∆∞
                    vi·ªán Cloud</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-white dark:bg-saas-dark">
                <div id="viewUpload" class="h-full flex flex-col items-center justify-center text-center">
                    <div class="w-full max-w-md border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-xl p-10 hover:border-zinc-400 dark:hover:border-zinc-500 hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-all cursor-pointer group"
                        onclick="document.getElementById('fileInput').click()">
                        <div
                            class="w-12 h-12 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-500 group-hover:text-zinc-800 dark:group-hover:text-zinc-300 transition-colors">
                            <i class="fa-solid fa-arrow-up-from-bracket text-lg"></i>
                        </div>
                        <p class="text-sm font-bold text-zinc-900 dark:text-white mb-1">Click ƒë·ªÉ ch·ªçn ·∫£nh</p>
                        <p class="text-xs text-zinc-500 font-medium">H·ªó tr·ª£ JPG, PNG, WEBP (T·ªëi ƒëa 5MB)</p>
                        <input type="file" id="fileInput" accept="image/*" class="hidden"
                            onchange="previewUpload(this)">
                    </div>
                    <div id="uploadPreviewContainer" class="hidden mt-6 w-full max-w-sm">
                        <div
                            class="relative rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 shadow-sm bg-zinc-100 dark:bg-zinc-900 mb-4 aspect-video">
                            <img id="uploadPreviewImg" class="w-full h-full object-contain">
                        </div>
                        <button onclick="doUpload()" id="btnDoUpload"
                            class="w-full py-2.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg font-bold text-sm shadow-sm hover:opacity-90 transition-opacity">X√°c
                            nh·∫≠n t·∫£i l√™n & S·ª≠ d·ª•ng</button>
                    </div>
                </div>
                <div id="viewLibrary" class="hidden">
                    <div id="libLoader" class="text-center py-16 hidden"><span class="loader text-zinc-400"></span>
                    </div>
                    <div id="libGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="appleWarningModal"
        class="fixed inset-0 z-[80] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/80 dark:bg-black/90" onclick="closeModal('appleWarningModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-md rounded-xl shadow-2xl p-6 md:p-8 border border-red-200 dark:border-red-900/50 transform scale-95 transition-all duration-300">
            <div class="flex flex-col items-center text-center mb-6">
                <div
                    class="w-14 h-14 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-500 rounded-full flex items-center justify-center mb-4 text-2xl border border-red-200 dark:border-red-800">
                    <i class="fa-solid fa-shield-halved"></i>
                </div>
                <h3 class="text-xl font-extrabold text-zinc-900 dark:text-white">C·∫¢NH B√ÅO QUAN TR·ªåNG</h3>
            </div>

            <div
                class="space-y-3 text-sm font-medium text-zinc-700 dark:text-zinc-300 bg-red-50 dark:bg-red-950/30 p-5 rounded-lg border border-red-100 dark:border-red-900/50 mb-6">
                <div class="flex gap-3 items-start">
                    <i class="fa-solid fa-circle-xmark text-red-500 mt-0.5 text-base"></i>
                    <p><strong>TUY·ªÜT ƒê·ªêI KH√îNG</strong> ƒëƒÉng nh·∫≠p t√†i kho·∫£n n√†y v√†o ph·∫ßn C√†i ƒê·∫∑t (iCloud) c·ªßa m√°y.</p>
                </div>
                <div class="flex gap-3 items-start">
                    <i class="fa-solid fa-circle-check text-green-600 dark:text-green-500 mt-0.5 text-base"></i>
                    <p><strong>CH·ªà ƒê∆Ø·ª¢C PH√âP</strong> ƒëƒÉng nh·∫≠p v√†o App Store ƒë·ªÉ t·∫£i ·ª©ng d·ª•ng.</p>
                </div>
                <div class="pt-2 mt-2 border-t border-red-200 dark:border-red-900/50 flex gap-3 items-start">
                    <i class="fa-solid fa-triangle-exclamation text-orange-500 mt-0.5 text-base"></i>
                    <p class="text-xs">N·∫øu m√°y t√≠nh/ƒëi·ªán tho·∫°i c·ªßa b·∫°n b·ªã kho√° iCloud do l√†m sai, <strong>ch√∫ng t√¥i mi·ªÖn
                            tr·ª´ to√†n b·ªô tr√°ch nhi·ªám.</strong></p>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-3">
                <button onclick="closeModal('appleWarningModal')"
                    class="order-2 sm:order-1 flex-1 py-2.5 rounded-lg font-bold text-sm text-zinc-600 dark:text-zinc-400 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors border border-transparent">H·ªßy
                    b·ªè</button>
                <button onclick="confirmUnlockApple()"
                    class="order-1 sm:order-2 flex-[2] py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold text-sm shadow-sm transition-all border border-red-700"
                    id="btnConfirmUnlock">T√¥i ƒë√£ hi·ªÉu & M·ªü kh√≥a</button>
            </div>
        </div>
    </div>

    <div id="infoModal"
        class="fixed inset-0 z-[70] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/60 dark:bg-black/80" onclick="closeModal('infoModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-2xl h-[70vh] rounded-xl shadow-2xl flex flex-col border border-zinc-200 dark:border-zinc-800 transform scale-95 transition-all duration-300 overflow-hidden">
            <div
                class="flex justify-between items-center p-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900">
                <h3 class="text-lg font-bold text-zinc-900 dark:text-white">Th√¥ng tin D·ªãch v·ª•</h3>
                <button onclick="closeModal('infoModal')"
                    class="w-8 h-8 rounded-md flex items-center justify-center text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-lg"></i></button>
            </div>

            <div class="flex border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 px-5 pt-2 gap-4">
                <button onclick="switchInfoTab('guide')" id="tabGuide"
                    class="pb-3 text-sm font-bold border-b-2 border-zinc-900 dark:border-white text-zinc-900 dark:text-white transition-colors">H∆∞·ªõng
                    d·∫´n chung</button>
                <button onclick="switchInfoTab('legal')" id="tabLegal"
                    class="pb-3 text-sm font-bold border-b-2 border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300 transition-colors">ƒêi·ªÅu
                    kho·∫£n & Mi·ªÖn tr·ª´</button>
            </div>

            <div
                class="flex-1 overflow-y-auto p-6 bg-white dark:bg-saas-dark text-sm leading-relaxed text-zinc-700 dark:text-zinc-300">
                <div id="viewGuide" class="space-y-6">
                    <div class="bg-zinc-50 dark:bg-zinc-900 p-5 rounded-lg border border-zinc-200 dark:border-zinc-800">
                        <h4 class="font-bold text-zinc-900 dark:text-white text-base mb-3 flex items-center gap-2"><i
                                class="fa-solid fa-book text-zinc-400"></i> Quy t·∫Øc s·ª≠ d·ª•ng</h4>
                        <ul class="space-y-2 font-medium">
                            <li class="flex items-start gap-2"><i
                                    class="fa-solid fa-minus text-[8px] mt-1.5 text-zinc-400"></i> <span>Tuy·ªát ƒë·ªëi kh√¥ng
                                    thay ƒë·ªïi m·∫≠t kh·∫©u t√†i kho·∫£n ƒë·ªÉ ng∆∞·ªùi kh√°c c√πng s·ª≠ d·ª•ng.</span></li>
                            <li class="flex items-start gap-2"><i
                                    class="fa-solid fa-minus text-[8px] mt-1.5 text-zinc-400"></i> <span>Kh√¥ng th√™m s·ªë
                                    ƒëi·ªán tho·∫°i ho·∫∑c ph∆∞∆°ng th·ª©c x√°c minh 2 b∆∞·ªõc c√° nh√¢n.</span></li>
                            <li class="flex items-start gap-2"><i
                                    class="fa-solid fa-minus text-[8px] mt-1.5 text-zinc-400"></i> <span>ƒêƒÉng xu·∫•t t√†i
                                    kho·∫£n kh·ªèi thi·∫øt b·ªã/tr√¨nh duy·ªát khi kh√¥ng c√≤n nhu c·∫ßu s·ª≠ d·ª•ng.</span></li>
                            <li class="flex items-start gap-2"><i
                                    class="fa-solid fa-minus text-[8px] mt-1.5 text-zinc-400"></i> <span>Ch·ªß ƒë·ªông b√°o
                                    l·ªói (Vote ƒê√£ kho√°) n·∫øu t√†i kho·∫£n kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p.</span></li>
                        </ul>
                    </div>
                </div>
                <div id="viewLegal" class="hidden space-y-6">
                    <div class="prose prose-sm dark:prose-invert max-w-none font-medium">
                        <p>D·ª± √°n ZenShare ho·∫°t ƒë·ªông phi l·ª£i nhu·∫≠n v·ªõi m·ª•c ƒë√≠ch chia s·∫ª t√†i nguy√™n gi√°o d·ª•c, gi·∫£i tr√≠ ƒë·∫øn
                            c·ªông ƒë·ªìng.</p>
                        <p><strong>B·∫£n quy·ªÅn:</strong> Ch√∫ng t√¥i kh√¥ng s·ªü h·ªØu c√°c d·ªãch v·ª• ƒë∆∞·ª£c cung c·∫•p qua c√°c t√†i
                            kho·∫£n n√†y. M·ªçi quy·ªÅn s·ªü h·ªØu tr√≠ tu·ªá thu·ªôc v·ªÅ nh√† cung c·∫•p d·ªãch v·ª• g·ªëc.</p>
                        <p><strong>Mi·ªÖn tr·ª´ tr√°ch nhi·ªám:</strong> Qu·∫£n tr·ªã vi√™n kh√¥ng ch·ªãu tr√°ch nhi·ªám cho b·∫•t k·ª≥ r·ªßi ro
                            n√†o li√™n quan ƒë·∫øn d·ªØ li·ªáu c√° nh√¢n, thi·∫øt b·ªã b·ªã kho√° (ƒë·∫∑c bi·ªát ƒë·ªëi v·ªõi Apple ID) do vi·ªác s·ª≠
                            d·ª•ng sai h∆∞·ªõng d·∫´n. Ng∆∞·ªùi d√πng t·ª± ch·ªãu tr√°ch nhi·ªám khi s·ª≠ d·ª•ng th√¥ng tin t·ª´ website n√†y.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="accountModal"
        class="fixed inset-0 z-[60] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/60 dark:bg-black/80" onclick="closeModal('accountModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-xl max-h-[90vh] flex flex-col rounded-xl shadow-2xl border border-zinc-200 dark:border-zinc-800 transform scale-95 transition-all duration-300">
            <div
                class="flex justify-between items-center p-5 md:p-6 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 shrink-0">
                <h3 class="text-xl font-bold text-zinc-900 dark:text-white" id="accModalTitle">Th√™m T√†i Kho·∫£n M·ªõi</h3>
                <button onclick="closeModal('accountModal')"
                    class="w-8 h-8 rounded-md flex items-center justify-center text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-lg"></i></button>
            </div>

            <div class="flex-1 overflow-y-auto p-5 md:p-6">
                <form id="accForm" class="space-y-5">
                    <input type="hidden" id="accId">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider">T√™n
                                d·ªãch v·ª• <span class="text-red-500">*</span></label>
                            <input type="text" id="accService" placeholder="V√≠ d·ª•: Netflix, ChatGPT..."
                                class="w-full p-2.5 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 dark:focus:border-zinc-400 focus:ring-1 focus:ring-zinc-500 transition-all shadow-sm text-sm"
                                required>
                        </div>
                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider">Danh
                                m·ª•c</label>
                            <div id="catSelectWrapper" class="relative">
                                <select id="accCategorySelect" onchange="checkNewCat(this)"
                                    class="w-full p-2.5 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 dark:focus:border-zinc-400 transition-all shadow-sm text-sm appearance-none pr-8 cursor-pointer"></select>
                                <i
                                    class="fa-solid fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-xs text-zinc-400 pointer-events-none"></i>
                            </div>
                            <div id="catInputWrapper" class="hidden flex gap-2">
                                <input type="text" id="accCategoryInput" placeholder="Nh·∫≠p t√™n danh m·ª•c..."
                                    class="w-full p-2.5 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all shadow-sm text-sm">
                                <button type="button" onclick="cancelNewCat()"
                                    class="px-3 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"><i
                                        class="fa-solid fa-xmark"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-1.5">
                        <label
                            class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider flex justify-between">
                            <span>H√¨nh ·∫£nh minh ho·∫°</span>
                            <span class="text-[10px] font-medium text-zinc-400 normal-case">M·ªói d√≤ng 1 link URL</span>
                        </label>
                        <div class="relative">
                            <textarea id="accImage" rows="2" placeholder="https://..."
                                class="w-full p-2.5 pr-12 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all shadow-sm text-xs font-mono"></textarea>
                            <button type="button" onclick="openMediaModal()"
                                class="absolute right-2 top-2 w-8 h-8 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors shadow-sm"
                                title="Qu·∫£n l√Ω th∆∞ vi·ªán ·∫£nh"><i class="fa-regular fa-images text-sm"></i></button>
                        </div>
                    </div>

                    <div
                        class="p-4 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 space-y-4">
                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider">T√†i
                                kho·∫£n / Email <span class="text-red-500">*</span></label>
                            <div class="relative flex">
                                <div
                                    class="w-10 flex items-center justify-center border border-r-0 border-zinc-200 dark:border-zinc-700 rounded-l-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-500">
                                    <i class="fa-regular fa-user text-xs"></i></div>
                                <input type="text" id="accUser" oninput="checkDuplicate(this)"
                                    class="w-full p-2.5 pr-10 bg-white dark:bg-saas-dark rounded-r-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all font-mono text-sm"
                                    required>
                                <button type="button" onclick="pasteFromClipboard('accUser')"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-800 dark:hover:text-white p-1 rounded transition-colors"
                                    title="D√°n t·ª´ Clipboard"><i class="fa-regular fa-clipboard text-sm"></i></button>
                            </div>

                            <div id="duplicateWarning"
                                class="hidden mt-2 p-3 bg-amber-50 dark:bg-amber-950/30 text-amber-800 dark:text-amber-400 rounded-lg text-sm flex items-center justify-between border border-amber-200 dark:border-amber-900/50 shadow-sm animate-slide-up">
                                <span class="font-bold flex items-center gap-2"><i
                                        class="fa-solid fa-triangle-exclamation"></i> Ph√°t hi·ªán tr√πng l·∫∑p d·ªØ li·ªáu</span>
                                <button type="button" id="btnMerge"
                                    class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1.5 rounded font-bold transition-colors text-xs shadow-sm">Chuy·ªÉn
                                    qua S·ª≠a</button>
                            </div>
                        </div>

                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider">M·∫≠t
                                kh·∫©u <span class="text-red-500">*</span></label>
                            <div class="relative flex">
                                <div
                                    class="w-10 flex items-center justify-center border border-r-0 border-zinc-200 dark:border-zinc-700 rounded-l-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-500">
                                    <i class="fa-solid fa-key text-xs"></i></div>
                                <input type="text" id="accPass"
                                    class="w-full p-2.5 pr-10 bg-white dark:bg-saas-dark rounded-r-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all font-mono text-sm"
                                    required>
                                <button type="button" onclick="pasteFromClipboard('accPass')"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-800 dark:hover:text-white p-1 rounded transition-colors"
                                    title="D√°n t·ª´ Clipboard"><i class="fa-regular fa-clipboard text-sm"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider flex justify-between">
                                <span>Tr·∫°ng th√°i</span>
                                <span class="text-[10px] font-medium text-zinc-400 normal-case">(Admin)</span>
                            </label>
                            <div class="relative">
                                <select id="accAdminStatus"
                                    class="w-full p-2.5 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all shadow-sm text-sm font-semibold appearance-none pr-8 cursor-pointer">
                                    <option value="working">‚úÖ ƒêang ho·∫°t ƒë·ªông (Working)</option>
                                    <option value="full">üë• ƒê√£ h·∫øt ch·ªó (Full Slot)</option>
                                    <option value="temp_locked">‚è≥ T·∫°m kho√° (Temp Locked)</option>
                                    <option value="locked">üîí ƒê√£ b·ªã kho√° (Locked)</option>
                                    <option value="error">‚ùå L·ªói (Error)</option>
                                </select>
                                <i
                                    class="fa-solid fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-xs text-zinc-400 pointer-events-none"></i>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label
                                class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider flex justify-between">
                                <span>Ngu·ªìn cung c·∫•p</span>
                                <span class="text-[10px] font-medium text-zinc-400 normal-case">(·∫®n v·ªõi user)</span>
                            </label>
                            <div class="relative">
                                <input type="text" id="accSource" placeholder="Link Facebook, Web..."
                                    class="w-full p-2.5 pr-8 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all shadow-sm text-sm">
                                <button type="button" onclick="pasteFromClipboard('accSource')"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-800 dark:hover:text-white p-1 rounded transition-colors"
                                    title="D√°n t·ª´ Clipboard"><i class="fa-regular fa-clipboard text-sm"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-1.5">
                        <label
                            class="block text-xs font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wider">M√¥
                            t·∫£ chi ti·∫øt / Ghi ch√∫</label>
                        <textarea id="accDesc" rows="3" placeholder="Th√¥ng tin profile, m√£ pin, quy ƒë·ªãnh ri√™ng..."
                            class="w-full p-2.5 bg-white dark:bg-saas-dark rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all shadow-sm text-sm leading-relaxed"></textarea>
                    </div>
                </form>
            </div>

            <div class="p-5 md:p-6 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 shrink-0">
                <button type="submit" form="accForm" id="saveBtn"
                    class="w-full py-3 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg font-bold text-sm shadow-sm hover:bg-zinc-800 dark:hover:bg-zinc-200 transition-colors flex items-center justify-center gap-2">
                    <i class="fa-solid fa-floppy-disk text-xs"></i> L∆∞u B·∫£n Ghi
                </button>
            </div>
        </div>
    </div>

    <div id="loginModal"
        class="fixed inset-0 z-[80] flex items-center justify-center px-4 opacity-0 pointer-events-none transition-opacity duration-200">
        <div class="absolute inset-0 bg-zinc-900/60 dark:bg-black/80" onclick="closeModal('loginModal')"></div>
        <div
            class="relative bg-white dark:bg-saas-dark w-full max-w-sm rounded-xl shadow-2xl p-8 border border-zinc-200 dark:border-zinc-800 transform scale-95 transition-all duration-300">
            <div class="flex justify-center mb-6">
                <div
                    class="w-12 h-12 bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-white rounded-lg flex items-center justify-center text-xl shadow-inner border border-zinc-200 dark:border-zinc-800">
                    <i class="fa-solid fa-user-shield"></i>
                </div>
            </div>
            <h3 class="text-xl font-extrabold mb-1 text-center text-zinc-900 dark:text-white">Admin Workspace</h3>
            <p class="text-xs font-medium text-zinc-500 text-center mb-6">ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω h·ªá th·ªëng</p>

            <div class="space-y-4 mb-6">
                <div>
                    <label
                        class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-1.5 ml-1">Email</label>
                    <input type="email" id="loginEmail" placeholder="admin@domain.com"
                        class="w-full p-3 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all text-sm font-medium">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-1.5 ml-1">M·∫≠t
                        kh·∫©u</label>
                    <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full p-3 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-700 outline-none focus:border-zinc-500 transition-all text-sm font-medium">
                </div>
            </div>

            <button onclick="doLogin()"
                class="w-full py-3 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg font-bold shadow-sm hover:opacity-90 transition-opacity">X√°c
                th·ª±c</button>
        </div>
    </div>

    <div id="toast"
        class="fixed bottom-6 right-6 z-[90] pointer-events-none transition-all duration-300 translate-y-20 opacity-0">
        <div
            class="bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 px-5 py-3.5 rounded-lg shadow-saas-hover dark:shadow-none flex items-center gap-3 border border-zinc-800 dark:border-zinc-200 min-w-[250px]">
            <i class="fa-solid fa-circle-check text-green-400 dark:text-green-600 text-lg"></i>
            <div class="flex flex-col">
                <span class="text-xs font-bold uppercase tracking-wider text-zinc-400 dark:text-zinc-500">Th√¥ng
                    b√°o</span>
                <span id="toastMsg" class="text-sm font-semibold leading-tight mt-0.5">Thao t√°c th√†nh c√¥ng</span>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const SUPABASE_URL = 'https://buvttxdzotubugauhccm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ1dnR0eGR6b3R1YnVnYXVoY2NtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMDQ3NTQsImV4cCI6MjA4NjU4MDc1NH0.WD37Q2qAB9DIne4_ZGiB0lX_Gxzz12jZjLF575MJ2as';
        const BUCKET_NAME = 'images';

        let sb;
        let accounts = [];
        let currentFilter = 'all';
        let currentUser = null;
        let unlockedCards = new Set();
        let pendingUnlockId = null;
        let viewMode = localStorage.getItem('viewMode') || 'grid';
        let slideStates = {};

        try {
            sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            initApp();
        } catch (e) { console.error("Supabase Error", e); }

        async function initApp() {
            const { data: { session } } = await sb.auth.getSession();
            updateAuthUI(session?.user);
            await fetchAccounts();
            sb.auth.onAuthStateChange((_event, session) => updateAuthUI(session?.user));
            updateViewModeIcon();
        }

        function updateAuthUI(user) {
            currentUser = user;
            const adminControls = document.getElementById('adminControls');
            const loginTrigger = document.getElementById('loginTrigger');
            if (user) { adminControls.classList.remove('hidden'); loginTrigger.classList.add('hidden'); }
            else { adminControls.classList.add('hidden'); loginTrigger.classList.remove('hidden'); }
            renderGrid();
        }

        function timeAgo(dateString) {
            if (!dateString) return 'M·ªõi';
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " nƒÉm tr∆∞·ªõc";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " th√°ng tr∆∞·ªõc";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " ng√†y tr∆∞·ªõc";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " gi·ªù tr∆∞·ªõc";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " ph√∫t tr∆∞·ªõc";
            return "V·ª´a xong";
        }

        async function pasteFromClipboard(targetId) {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    const el = document.getElementById(targetId);
                    if (targetId === 'accImage') {
                        el.value = el.value ? el.value + '\n' + text : text;
                    } else {
                        el.value = text;
                    }
                    el.focus();
                    if (targetId === 'accUser' && typeof checkDuplicate === 'function') checkDuplicate(el);
                    showToast('ƒê√£ d√°n t·ª´ clipboard');
                } else {
                    showToast('Clipboard tr·ªëng');
                }
            } catch (err) {
                showToast('Kh√¥ng th·ªÉ truy c·∫≠p clipboard');
            }
        }

        function checkDuplicate(input) {
            const val = input.value.trim();
            const warning = document.getElementById('duplicateWarning');
            const btnMerge = document.getElementById('btnMerge');
            const currentId = document.getElementById('accId').value;

            if (!val) { warning.classList.add('hidden'); warning.classList.remove('flex'); return; }

            const duplicate = accounts.find(a => a.user_name.toLowerCase() === val.toLowerCase() && a.id.toString() !== currentId);

            if (duplicate) {
                warning.classList.remove('hidden');
                warning.classList.add('flex');
                btnMerge.onclick = () => {
                    editAcc(duplicate.id);
                    warning.classList.add('hidden');
                    warning.classList.remove('flex');
                    showToast('ƒê√£ chuy·ªÉn sang ch·ªânh s·ª≠a b·∫£n ghi c≈©');
                };
            } else {
                warning.classList.add('hidden');
                warning.classList.remove('flex');
            }
        }

        function toggleViewMode() {
            viewMode = viewMode === 'grid' ? 'compact' : 'grid';
            localStorage.setItem('viewMode', viewMode);
            updateViewModeIcon();
            renderGrid();
        }

        function updateViewModeIcon() {
            const btn = document.getElementById('viewModeBtn');
            btn.innerHTML = viewMode === 'grid' ? '<i class="fa-solid fa-list-ul text-sm"></i>' : '<i class="fa-solid fa-border-all text-sm"></i>';
            btn.title = viewMode === 'grid' ? "Chuy·ªÉn sang d·∫°ng Danh S√°ch" : "Chuy·ªÉn sang d·∫°ng L∆∞·ªõi";
        }

        function parseImages(imgString) {
            if (!imgString) return [];
            try {
                if (imgString.trim().startsWith('[')) return JSON.parse(imgString);
                if (imgString.includes('\n')) return imgString.split('\n').map(s => s.trim()).filter(s => s);
                return [imgString.trim()];
            } catch (e) {
                return [imgString.trim()];
            }
        }

        function nextSlide(id, total, e) {
            e.stopPropagation();
            if (!slideStates[id]) slideStates[id] = 0;
            slideStates[id] = (slideStates[id] + 1) % total;
            updateSlideUI(id);
        }

        function prevSlide(id, total, e) {
            e.stopPropagation();
            if (!slideStates[id]) slideStates[id] = 0;
            slideStates[id] = (slideStates[id] - 1 + total) % total;
            updateSlideUI(id);
        }

        function updateSlideUI(id) {
            const acc = accounts.find(a => a.id === id);
            if (!acc) return;
            const imgs = parseImages(acc.image);
            const idx = slideStates[id] || 0;
            const imgEl = document.getElementById(`img-main-${id}`);
            if (imgEl) imgEl.src = imgs[idx];

            // C·∫≠p nh·∫≠t dots indicator
            const dotsContainer = document.getElementById(`dots-${id}`);
            if (dotsContainer) {
                Array.from(dotsContainer.children).forEach((dot, i) => {
                    dot.className = `w-1.5 h-1.5 rounded-full transition-colors ${i === idx ? 'bg-white' : 'bg-white/40'}`;
                });
            }
        }

        function openScanModal() { openModal('scanModal'); runScan(); }

        function runScan() {
            const statusEl = document.getElementById('scanStatus');
            const resultsEl = document.getElementById('scanResults');
            statusEl.innerText = "ƒêang ƒë·ªëi chi·∫øu c∆° s·ªü d·ªØ li·ªáu...";
            resultsEl.innerHTML = '<div class="flex justify-center py-12"><span class="loader text-zinc-400"></span></div>';

            const groups = {};
            accounts.forEach(acc => {
                const key = acc.user_name.trim().toLowerCase();
                if (!groups[key]) groups[key] = [];
                groups[key].push(acc);
            });

            const duplicates = Object.entries(groups).filter(([key, list]) => list.length > 1);
            statusEl.innerText = `T√¨m th·∫•y ${duplicates.length} nh√≥m t√†i kho·∫£n tr√πng l·∫∑p.`;

            if (duplicates.length === 0) {
                resultsEl.innerHTML = `
                    <div class="h-full flex flex-col items-center justify-center text-center text-zinc-500 py-10">
                        <div class="w-16 h-16 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center mb-4 text-green-500 border border-green-100 dark:border-green-900/30">
                            <i class="fa-solid fa-check text-2xl"></i>
                        </div>
                        <p class="font-bold text-zinc-900 dark:text-white text-base">H·ªá th·ªëng s·∫°ch s·∫Ω</p>
                        <p class="text-sm mt-1">Kh√¥ng ph√°t hi·ªán d·ªØ li·ªáu n√†o b·ªã tr√πng l·∫∑p.</p>
                    </div>`;
                return;
            }

            resultsEl.innerHTML = duplicates.map(([key, list]) => {
                list.sort((a, b) => new Date(b.updated_at || b.created_at) - new Date(a.updated_at || a.created_at));

                const itemsHtml = list.map((acc, idx) => {
                    const time = timeAgo(acc.updated_at || acc.created_at);
                    const isNewest = idx === 0;
                    const imgs = parseImages(acc.image);
                    return `
                        <div class="flex items-center gap-3 p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg mb-2 last:mb-0 shadow-sm">
                            <div class="w-10 h-10 rounded-md bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 overflow-hidden shrink-0">
                                <img src="${imgs[0] || ''}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-0.5">
                                    <span class="text-sm font-bold truncate text-zinc-900 dark:text-white">${acc.service}</span>
                                    ${isNewest ? '<span class="text-[10px] bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800 text-indigo-600 dark:text-indigo-400 px-1.5 py-0.5 rounded font-bold uppercase tracking-wider">M·ªõi nh·∫•t</span>' : ''}
                                </div>
                                <div class="text-xs text-zinc-500 font-medium">ID: ${acc.id} <span class="mx-1">‚Ä¢</span> C·∫≠p nh·∫≠t ${time} <span class="mx-1">‚Ä¢</span> ${imgs.length} ·∫¢nh</div>
                            </div>
                            <div class="flex gap-2 shrink-0">
                                <button onclick="keepAndMerge(${acc.id}, '${key}')" class="text-xs bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 px-3 py-1.5 rounded-md font-bold hover:bg-zinc-800 dark:hover:bg-zinc-200 shadow-sm transition-colors">G·ªôp v√†o ƒë√¢y</button>
                                <button onclick="deleteFromScan(${acc.id})" class="w-8 h-8 rounded-md bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 text-red-500 flex items-center justify-center hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors" title="X√≥a b·∫£n ghi n√†y"><i class="fa-solid fa-trash text-xs"></i></button>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="mb-6 bg-zinc-50 dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800">
                        <div class="flex items-center gap-2 mb-3 px-1">
                            <div class="w-6 flex items-center justify-center text-zinc-400"><i class="fa-regular fa-user text-sm"></i></div>
                            <span class="font-mono font-bold text-sm text-zinc-900 dark:text-white">${key}</span>
                            <span class="text-[10px] bg-zinc-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 px-2 py-0.5 rounded-full font-bold ml-2">${list.length} b·∫£n ghi</span>
                        </div>
                        <div>${itemsHtml}</div>
                    </div>
                `;
            }).join('');
        }

        async function deleteFromScan(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn b·∫£n ghi n√†y?')) return;
            const { error } = await sb.from('accounts').delete().eq('id', id);
            if (!error) {
                showToast('ƒê√£ x√≥a b·∫£n ghi');
                accounts = accounts.filter(a => a.id !== id);
                runScan();
                renderGrid();
            } else { showToast('L·ªói x√≥a: ' + error.message); }
        }

        async function keepAndMerge(keepId, userKey) {
            if (!confirm('H·ªá th·ªëng s·∫Ω h·ª£p nh·∫•t H√¨nh ·∫£nh, M√¥ t·∫£ v√† Ngu·ªìn c·ªßa t·∫•t c·∫£ c√°c b·∫£n ghi kh√°c v√†o ID n√†y, sau ƒë√≥ x√≥a c√°c b·∫£n ghi c√≤n l·∫°i. B·∫°n ƒë·ªìng √Ω ch·ª©?')) return;

            const group = accounts.filter(a => a.user_name.trim().toLowerCase() === userKey);
            const target = group.find(a => a.id === keepId);
            const others = group.filter(a => a.id !== keepId);

            if (!target) return;

            let mergedImages = new Set(parseImages(target.image));
            others.forEach(o => parseImages(o.image).forEach(img => mergedImages.add(img)));
            const finalImages = JSON.stringify([...mergedImages]);

            let mergedDesc = target.description || "";
            others.forEach(o => {
                if (o.description && !mergedDesc.includes(o.description)) {
                    mergedDesc += `\n\n--- [Merge t·ª´ ID ${o.id}] ---\n${o.description}`;
                }
            });

            let mergedSource = target.source || "";
            others.forEach(o => {
                if (o.source && !mergedSource.includes(o.source)) {
                    mergedSource += mergedSource ? ` | ${o.source}` : o.source;
                }
            });

            const { error: updateError } = await sb.from('accounts').update({
                image: finalImages,
                description: mergedDesc.trim(),
                source: mergedSource,
                updated_at: new Date().toISOString()
            }).eq('id', keepId);

            if (updateError) { showToast('L·ªói c·∫≠p nh·∫≠t: ' + updateError.message); return; }

            const idsToDelete = others.map(o => o.id);
            if (idsToDelete.length > 0) {
                await sb.from('accounts').delete().in('id', idsToDelete);
            }

            showToast(`G·ªôp th√†nh c√¥ng! (ID ${keepId} c√≥ ${mergedImages.size} ·∫£nh)`);
            await fetchAccounts();
            runScan();
        }

        async function fetchAccounts() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('grid').classList.add('hidden');
            const { data, error } = await sb.from('accounts').select('*')
                .order('updated_at', { ascending: false, nullsFirst: false })
                .order('created_at', { ascending: false });
            if (!error && data) { accounts = data; renderFilters(); renderGrid(); }
            document.getElementById('loading').style.display = 'none';
        }

        function highlightText(text, query) {
            if (!query || !text) return text;
            const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedQuery})`, 'gi');
            return text.toString().replace(regex, '<mark class="highlight">$1</mark>');
        }

        function getStatusBadge(status) {
            const styles = {
                'working': 'bg-green-50 text-green-700 dark:bg-green-950/30 dark:text-green-400 border-green-200 dark:border-green-800/50',
                'full': 'bg-orange-50 text-orange-700 dark:bg-orange-950/30 dark:text-orange-400 border-orange-200 dark:border-orange-800/50',
                'temp_locked': 'bg-amber-50 text-amber-700 dark:bg-amber-950/30 dark:text-amber-400 border-amber-200 dark:border-amber-800/50',
                'locked': 'bg-red-50 text-red-700 dark:bg-red-950/30 dark:text-red-400 border-red-200 dark:border-red-800/50',
                'error': 'bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700'
            };
            const labels = {
                'working': '<i class="fa-solid fa-circle-check mr-1.5 text-[10px]"></i>Ho·∫°t ƒë·ªông',
                'full': '<i class="fa-solid fa-users-slash mr-1.5 text-[10px]"></i>H·∫øt ch·ªó',
                'temp_locked': '<i class="fa-solid fa-hourglass-half mr-1.5 text-[10px]"></i>T·∫°m kho√°',
                'locked': '<i class="fa-solid fa-lock mr-1.5 text-[10px]"></i>ƒê√£ kho√°',
                'error': '<i class="fa-solid fa-triangle-exclamation mr-1.5 text-[10px]"></i>B√°o l·ªói'
            };
            const s = status || 'working';
            return `<div class="px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider border flex items-center w-fit mt-2 ${styles[s]}">${labels[s]}</div>`;
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            const empty = document.getElementById('empty');
            const searchVal = (document.getElementById('desktopSearch').value || document.getElementById('mobileSearch').value).toLowerCase().trim();

            const filtered = accounts.filter(acc => {
                const matchCat = currentFilter === 'all' || acc.category === currentFilter;
                const matchSearch = (acc.service + ' ' + (acc.description || '') + ' ' + acc.category + ' ' + acc.user_name).toLowerCase().includes(searchVal);
                return matchCat && matchSearch;
            });

            if (filtered.length === 0) {
                grid.classList.add('hidden'); empty.classList.remove('hidden'); empty.classList.add('flex'); return;
            }

            grid.classList.remove('hidden'); empty.classList.add('hidden'); empty.classList.remove('flex');

            if (viewMode === 'compact') {
                grid.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4";
            } else {
                grid.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6";
            }

            grid.innerHTML = filtered.map((acc, index) => {
                const images = parseImages(acc.image);
                const hasSlideshow = images.length > 1;
                const currentImgIdx = slideStates[acc.id] || 0;
                const fallbackImg = `https://placehold.co/600x400/18181b/FFF?text=${acc.service.charAt(0).toUpperCase()}`;
                const displayImg = images[currentImgIdx] || fallbackImg;

                const isApple = acc.category === 'ID Apple';
                const isLocked = isApple && !unlockedCards.has(acc.id);
                const displayTime = acc.updated_at ? acc.updated_at : acc.created_at;
                const updatedTime = timeAgo(displayTime);

                const hlService = highlightText(acc.service, searchVal);
                const hlDesc = highlightText(acc.description || 'Kh√¥ng c√≥ m√¥ t·∫£ chi ti·∫øt k√®m theo.', searchVal);
                const hlUser = highlightText(acc.user_name, searchVal);

                let sourceBadge = '';
                if (currentUser && acc.source) {
                    const isUrl = /^(http|https):\/\/[^ "]+$/.test(acc.source);
                    const sourceContent = isUrl
                        ? `<a href="${acc.source}" target="_blank" class="hover:underline hover:text-indigo-600 dark:hover:text-indigo-400 font-bold break-all">${acc.source}</a>`
                        : `<span class="font-bold text-zinc-700 dark:text-zinc-300">${acc.source}</span>`;

                    sourceBadge = `<div class="mt-3 text-[10px] bg-zinc-100 dark:bg-zinc-800 p-2 rounded-md border border-zinc-200 dark:border-zinc-700 flex items-start gap-2 text-zinc-600 dark:text-zinc-400">
                        <i class="fa-solid fa-link mt-0.5"></i> <div class="flex-1">${sourceContent}</div>
                    </div>`;
                }

                const workingCount = acc.status_working || 0;
                const lockedCount = acc.status_locked || 0;
                const hasVoted = localStorage.getItem(`reported_${acc.id}`);
                const btnDisabledClass = hasVoted ? "opacity-50 pointer-events-none" : "hover:bg-opacity-80 active:scale-[0.98]";

                // ====== GIAO DI·ªÜN COMPACT ======
                if (viewMode === 'compact') {
                    if (isLocked) {
                        return `
                        <div class="relative bg-white dark:bg-saas-dark rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 shadow-sm fade-in flex flex-col items-center justify-center p-5 text-center h-[200px]">
                            <div class="w-10 h-10 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mb-3 border border-red-100 dark:border-red-900/30">
                                <i class="fa-solid fa-lock text-sm"></i>
                            </div>
                            <div class="text-sm font-bold truncate w-full mb-3 text-zinc-900 dark:text-white" title="${acc.service}">${hlService}</div>
                            <button onclick="openAppleWarning(${acc.id})" class="text-xs bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 px-4 py-2 rounded-lg font-bold shadow-sm hover:opacity-90 transition-opacity">M·ªü kh√≥a n·ªôi dung</button>
                            ${currentUser ? `<button onclick="editAcc(${acc.id})" class="absolute top-2 right-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white bg-zinc-100 dark:bg-zinc-800 w-7 h-7 rounded flex items-center justify-center"><i class="fa-solid fa-pen text-[10px]"></i></button>` : ''}
                        </div>`;
                    }
                    return `
                    <div class="group bg-white dark:bg-saas-dark rounded-xl overflow-hidden border border-zinc-200 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-600 transition-all duration-300 shadow-sm hover:shadow-saas flex flex-col fade-in">
                        <div class="flex items-start p-4 gap-4 border-b border-zinc-100 dark:border-zinc-800/50">
                            <div class="w-14 h-14 shrink-0 rounded-lg bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 relative overflow-hidden group/img">
                                <img src="${displayImg}" class="w-full h-full object-cover">
                                ${currentUser ? `<div class="absolute inset-0 bg-black/60 opacity-0 group-hover/img:opacity-100 transition-opacity flex items-center justify-center cursor-pointer" onclick="editAcc(${acc.id})"><i class="fa-solid fa-pen text-white text-[10px]"></i></div>` : ''}
                            </div>
                            <div class="flex-1 min-w-0 flex flex-col justify-center">
                                <h3 class="text-sm font-bold truncate text-zinc-900 dark:text-white mb-0.5" title="${acc.service}">${hlService}</h3>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] font-bold text-zinc-500 uppercase">${acc.category}</span>
                                    <div class="w-1 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700"></div>
                                    <span class="text-[10px] font-medium text-zinc-400">${updatedTime}</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-zinc-50/50 dark:bg-zinc-900/30 flex-grow flex flex-col gap-2.5">
                            <div class="flex items-center gap-2 bg-white dark:bg-zinc-900 rounded-md border border-zinc-200 dark:border-zinc-800 p-1 pl-2 shadow-sm">
                                <i class="fa-regular fa-user text-zinc-400 text-[10px]"></i>
                                <input type="text" value="${acc.user_name}" readonly class="bg-transparent flex-1 outline-none text-zinc-700 dark:text-zinc-300 font-mono text-xs w-full truncate">
                                <button onclick="copy('${acc.user_name}')" class="w-6 h-6 flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white rounded transition-colors"><i class="fa-regular fa-copy text-[10px]"></i></button>
                            </div>
                            <div class="flex items-center gap-2 bg-white dark:bg-zinc-900 rounded-md border border-zinc-200 dark:border-zinc-800 p-1 pl-2 shadow-sm">
                                <i class="fa-solid fa-key text-zinc-400 text-[10px]"></i>
                                <input type="password" value="${acc.password}" readonly class="bg-transparent flex-1 outline-none text-zinc-700 dark:text-zinc-300 font-mono text-xs w-full truncate" id="pass-c-${acc.id}">
                                <div class="flex shrink-0">
                                    <button onclick="togglePass('c-${acc.id}')" class="w-6 h-6 flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white rounded transition-colors"><i class="fa-regular fa-eye text-[10px]" id="eye-c-${acc.id}"></i></button>
                                    <button onclick="copy('${acc.password}')" class="w-6 h-6 flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white rounded transition-colors"><i class="fa-regular fa-copy text-[10px]"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }

                // ====== GIAO DI·ªÜN GRID (M·∫∑c ƒë·ªãnh) ======
                return `
                <div class="group relative bg-white dark:bg-saas-dark rounded-[20px] overflow-hidden border border-zinc-200 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-600 hover:shadow-saas transition-all duration-300 flex flex-col fade-in" style="animation-delay: ${index * 0.03}s">
                    
                    <div class="relative h-48 shrink-0 overflow-hidden bg-zinc-100 dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 group/img">
                        <img src="${displayImg}" id="img-main-${acc.id}" class="w-full h-full object-cover transition-transform duration-700 ease-out transform group-hover:scale-105">
                        
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-60"></div>

                        ${hasSlideshow ? `
                            <div class="absolute inset-0 flex items-center justify-between px-3 opacity-0 group-hover/img:opacity-100 transition-opacity z-10">
                                <div onclick="prevSlide(${acc.id}, ${images.length}, event)" class="slide-btn"><i class="fa-solid fa-chevron-left text-xs"></i></div>
                                <div onclick="nextSlide(${acc.id}, ${images.length}, event)" class="slide-btn"><i class="fa-solid fa-chevron-right text-xs"></i></div>
                            </div>
                            <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10 bg-black/40 px-2 py-1.5 rounded-full" id="dots-${acc.id}">
                                ${images.map((_, i) => `<div class="w-1.5 h-1.5 rounded-full transition-colors ${i === currentImgIdx ? 'bg-white' : 'bg-white/40'}"></div>`).join('')}
                            </div>
                        ` : ''}

                        <div class="absolute top-4 left-4 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-widest shadow-sm text-zinc-900 dark:text-white z-20 flex items-center gap-1.5">
                            ${isApple ? '<i class="fa-brands fa-apple text-sm"></i>' : ''}${acc.category}
                        </div>
                        
                        ${currentUser ? `
                        <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover/img:opacity-100 transition-opacity z-20">
                            <button onclick="editAcc(${acc.id})" class="bg-white text-zinc-900 w-8 h-8 rounded-md flex items-center justify-center shadow-md hover:bg-zinc-100 border border-zinc-200 transition-colors" title="S·ª≠a"><i class="fa-solid fa-pen text-xs"></i></button>
                            <button onclick="deleteAcc(${acc.id})" class="bg-red-500 text-white w-8 h-8 rounded-md flex items-center justify-center shadow-md hover:bg-red-600 transition-colors" title="X√≥a"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>` : ''}
                    </div>

                    <div class="p-5 md:p-6 flex-grow flex flex-col min-h-0 bg-white dark:bg-saas-dark">
                        <div class="mb-5">
                            <h3 class="text-lg font-extrabold truncate text-zinc-900 dark:text-white mb-1" title="${acc.service}">${hlService}</h3>
                            ${getStatusBadge(acc.admin_status)}
                        </div>

                        <div class="text-sm text-zinc-600 dark:text-zinc-400 font-medium leading-relaxed max-h-24 overflow-y-auto mb-5 scrollbar-hide">
                            ${hlDesc}
                        </div>
                        
                        ${sourceBadge}

                        <div class="mt-auto">
                            ${isLocked ? `
                                <div class="bg-red-50 dark:bg-red-950/30 rounded-xl p-5 border border-red-100 dark:border-red-900/50 text-center flex flex-col items-center">
                                    <i class="fa-solid fa-lock text-red-500 text-2xl mb-2.5"></i>
                                    <p class="text-sm font-bold text-red-700 dark:text-red-400 mb-4">ƒê√£ thi·∫øt l·∫≠p l·ªõp b·∫£o v·ªá</p>
                                    <button onclick="openAppleWarning(${acc.id})" class="w-full py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-lg transition-colors shadow-sm">Cam k·∫øt ƒë·ªÉ m·ªü kh√≥a</button>
                                </div>
                            ` : `
                                <div class="bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-2 space-y-2 relative overflow-hidden">
                                    <div class="flex items-center bg-white dark:bg-saas-dark rounded-md p-1.5 border border-zinc-100 dark:border-zinc-800 shadow-sm">
                                        <div class="w-8 flex justify-center text-zinc-400 shrink-0"><i class="fa-regular fa-user text-xs"></i></div>
                                        <div class="text-sm font-mono font-medium flex-1 truncate select-all mx-1 text-zinc-800 dark:text-zinc-200 pt-0.5">${hlUser}</div>
                                        <button onclick="copy('${acc.user_name}')" class="w-8 h-8 rounded shrink-0 flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i class="fa-regular fa-copy text-sm"></i></button>
                                    </div>
                                    <div class="flex items-center bg-white dark:bg-saas-dark rounded-md p-1.5 border border-zinc-100 dark:border-zinc-800 shadow-sm">
                                        <div class="w-8 flex justify-center text-zinc-400 shrink-0"><i class="fa-solid fa-key text-xs"></i></div>
                                        <input type="password" value="${acc.password}" readonly class="bg-transparent text-sm font-mono font-medium flex-1 w-full outline-none text-zinc-800 dark:text-zinc-200 mx-1 pt-0.5" id="pass-${acc.id}">
                                        <div class="flex shrink-0 gap-1">
                                            <button onclick="togglePass(${acc.id})" class="w-8 h-8 rounded flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i class="fa-regular fa-eye text-sm" id="eye-${acc.id}"></i></button>
                                            <button onclick="copy('${acc.password}')" class="w-8 h-8 rounded flex items-center justify-center text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white transition-colors"><i class="fa-regular fa-copy text-sm"></i></button>
                                        </div>
                                    </div>
                                </div>
                                ${isApple ? `<div class="text-[11px] text-center text-red-500 font-bold mt-3 uppercase tracking-wider"><i class="fa-solid fa-shield-halved mr-1.5"></i>Ch·ªâ ƒëƒÉng nh·∫≠p AppStore</div>` : ''}
                            `}
                        </div>

                        <div class="mt-5 pt-4 border-t border-zinc-100 dark:border-zinc-800">
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider">C·∫≠p nh·∫≠t l√∫c</span>
                                <span class="text-[11px] text-zinc-600 dark:text-zinc-400 font-medium bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded-md border border-zinc-200 dark:border-zinc-700">${updatedTime}</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
    <div class="flex flex-col">
        <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider">C·ªông ƒë·ªìng</span>
        <span class="text-[9px] text-zinc-400 font-medium mt-0.5">C·∫≠p nh·∫≠t: ${updatedTime}</span>
    </div>
    ${getCrowdStatusBadge(workingCount, lockedCount)}
</div>
                            <div class="flex gap-2">
                                <button id="btn-report-working-${acc.id}" onclick="reportStatus(${acc.id}, 'working')" class="flex-1 flex items-center justify-center gap-2 py-2 rounded-lg bg-green-50 dark:bg-green-950/30 text-green-700 dark:text-green-500 text-xs font-bold border border-green-200 dark:border-green-800/50 transition-all shadow-sm ${btnDisabledClass}">
                                    <i class="fa-solid fa-check"></i> <span id="working-count-${acc.id}">${workingCount}</span>
                                </button>
                                <button id="btn-report-locked-${acc.id}" onclick="reportStatus(${acc.id}, 'locked')" class="flex-1 flex items-center justify-center gap-2 py-2 rounded-lg bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-500 text-xs font-bold border border-red-200 dark:border-red-800/50 transition-all shadow-sm ${btnDisabledClass}">
                                    <i class="fa-solid fa-lock"></i> <span id="locked-count-${acc.id}">${lockedCount}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderFilters() {
            // 1. Ch·ªâ l·∫•y c√°c danh m·ª•c ƒëang th·ª±c s·ª± t·ªìn t·∫°i trong database
            const existingCats = accounts
                .map(a => a.category)
                .filter(c => c && c.trim() !== ''); // Lo·∫°i b·ªè c√°c tr∆∞·ªùng r·ªóng ho·∫∑c undefined

            // 2. D√πng Set ƒë·ªÉ l·ªçc c√°c danh m·ª•c tr√πng l·∫∑p v√† th√™m 'T·∫•t c·∫£' v√†o v·ªã tr√≠ ƒë·∫ßu ti√™n
            const uniqueCats = ['T·∫•t c·∫£', ...new Set(existingCats)];

            // 3. Render ra HTML
            document.getElementById('filterContainer').innerHTML = uniqueCats.map(cat => {
                const val = cat === 'T·∫•t c·∫£' ? 'all' : cat;
                const isActive = currentFilter === val;

                let btnClass = isActive
                    ? "bg-white dark:bg-saas-dark text-zinc-900 dark:text-white shadow-sm border border-zinc-200 dark:border-zinc-700 ring-1 ring-zinc-900/5 dark:ring-white/10"
                    : "text-zinc-500 hover:text-zinc-900 dark:hover:text-white border border-transparent";

                // (Tu·ª≥ ch·ªçn) Gi·ªØ l·∫°i hi·ªáu ·ª©ng m√†u ƒë·ªè c·∫£nh b√°o ri√™ng cho 'ID Apple' do t√≠nh ch·∫•t nh·∫°y c·∫£m
                if (cat === 'ID Apple' && !isActive) btnClass += " text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300";
                if (cat === 'ID Apple' && isActive) btnClass += " text-red-600 dark:text-red-400";

                return `<button onclick="setFilter('${val}')" class="whitespace-nowrap px-4 py-1.5 rounded-md text-sm font-semibold transition-all duration-200 ${btnClass}">${cat}</button>`;
            }).join('');
        }

        function setFilter(val) { currentFilter = val; renderFilters(); renderGrid(); }

        function populateCategorySelect(selectedVal = null) {
            const select = document.getElementById('accCategorySelect');
            const existingCats = accounts.map(a => a.category).filter(c => c && c.trim() !== '');

            // V·∫´n gi·ªØ l·∫°i 'Kh√°c' l√†m fallback v√† lo·∫°i b·ªè tr√πng l·∫∑p
            const uniqueCats = [...new Set([...existingCats, 'Kh√°c'])];

            select.innerHTML = uniqueCats.map(c => `<option value="${c}">${c}</option>`).join('') + `<option value="NEW_CAT_OPTION">‚ûï Th√™m danh m·ª•c m·ªõi...</option>`;
            if (selectedVal) select.value = selectedVal;
        }
        function checkNewCat(select) {
            if (select.value === 'NEW_CAT_OPTION') {
                document.getElementById('catSelectWrapper').classList.add('hidden');
                document.getElementById('catInputWrapper').classList.remove('hidden');
                document.getElementById('catInputWrapper').classList.add('flex');
                document.getElementById('accCategoryInput').focus(); document.getElementById('accCategoryInput').value = '';
            }
        }
        function cancelNewCat() {
            document.getElementById('catInputWrapper').classList.add('hidden'); document.getElementById('catInputWrapper').classList.remove('flex');
            document.getElementById('catSelectWrapper').classList.remove('hidden'); document.getElementById('accCategorySelect').value = 'ID Apple';
        }

        function getCrowdStatusBadge(working, locked) {
            const total = working + locked;

            // N·∫øu ch∆∞a c√≥ ai vote
            if (total === 0) {
                return `<span class="text-[11px] text-zinc-500 dark:text-zinc-400 font-medium bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded-md border border-zinc-200 dark:border-zinc-700 flex items-center gap-1.5"><i class="fa-regular fa-circle-question"></i> Ch∆∞a c√≥ ƒë√°nh gi√°</span>`;
            }

            // N·∫øu t·ª∑ l·ªá b√°o c√°o l·ªói r·∫•t cao (G·∫•p ƒë√¥i s·ªë ng∆∞·ªùi b√°o ho·∫°t ƒë·ªông) -> Kh·∫£ nƒÉng cao ƒë√£ ƒë·ªïi pass, kho√° ho·∫∑c ƒë·∫ßy
            if (locked > working * 1.5) {
                return `<span class="text-[11px] text-red-700 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 px-2 py-0.5 rounded-md border border-red-200 dark:border-red-800/50 flex items-center gap-1.5"><i class="fa-solid fa-triangle-exclamation"></i> C√≥ th·ªÉ ƒë√£ kho√°/sai TT (${locked} b√°o l·ªói)</span>`;
            }
            // N·∫øu c√≥ b√°o c√°o l·ªói nh∆∞ng v·∫´n c√≥ nhi·ªÅu ng∆∞·ªùi d√πng ƒë∆∞·ª£c -> Kh·∫£ nƒÉng t√†i kho·∫£n ƒëang ch·∫≠p ch·ªùn ho·∫∑c hay b·ªã ƒë·∫ßy (Full Slot)
            else if (locked > 0 && locked >= working) {
                return `<span class="text-[11px] text-amber-700 dark:text-amber-400 font-medium bg-amber-50 dark:bg-amber-950/30 px-2 py-0.5 rounded-md border border-amber-200 dark:border-amber-800/50 flex items-center gap-1.5"><i class="fa-solid fa-users-slash"></i> Ch·∫≠p ch·ªùn/Hay ƒë·∫ßy (${locked} b√°o l·ªói)</span>`;
            }
            // Tr·∫°ng th√°i t·ªët
            else {
                return `<span class="text-[11px] text-green-700 dark:text-green-500 font-medium bg-green-50 dark:bg-green-950/30 px-2 py-0.5 rounded-md border border-green-200 dark:border-green-800/50 flex items-center gap-1.5"><i class="fa-solid fa-check-circle"></i>Ho·∫°t ƒë·ªông t·ªët</span>`;
            }
        }

        document.getElementById('accForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn'); const originalText = btn.innerHTML; btn.innerHTML = '<span class="loader"></span> ƒêang x·ª≠ l√Ω...'; btn.disabled = true;
            let finalCategory = !document.getElementById('catInputWrapper').classList.contains('hidden') ? document.getElementById('accCategoryInput').value.trim() || 'Kh√°c' : document.getElementById('accCategorySelect').value;
            const id = document.getElementById('accId').value;

            const rawImg = document.getElementById('accImage').value;
            const imgArray = parseImages(rawImg);
            const finalImageStr = JSON.stringify(imgArray);

            const data = {
                service: document.getElementById('accService').value,
                category: finalCategory,
                image: finalImageStr,
                user_name: document.getElementById('accUser').value,
                password: document.getElementById('accPass').value,
                description: document.getElementById('accDesc').value,
                source: document.getElementById('accSource').value,
                admin_status: document.getElementById('accAdminStatus').value,
                updated_at: new Date().toISOString()
            };

            let res;
            if (id) res = await sb.from('accounts').update(data).eq('id', id);
            else res = await sb.from('accounts').insert([data]);

            if (res.error) showToast('L·ªói: ' + res.error.message); else { showToast('Th√†nh c√¥ng'); closeModal('accountModal'); fetchAccounts(); }
            btn.innerHTML = originalText; btn.disabled = false;
        });

        function openModal(id) {
            const m = document.getElementById(id);
            m.classList.remove('pointer-events-none', 'opacity-0');
            m.querySelector('div.relative').classList.remove('scale-95');
            m.querySelector('div.relative').classList.add('scale-100');

            if (id === 'accountModal' && !document.getElementById('accId').value) {
                document.getElementById('accForm').reset();
                document.getElementById('accModalTitle').innerText = 'Th√™m B·∫£n Ghi M·ªõi';
                document.getElementById('duplicateWarning').classList.add('hidden');
                document.getElementById('duplicateWarning').classList.remove('flex');
                document.getElementById('accAdminStatus').value = 'working';
                populateCategorySelect('Gi·∫£i tr√≠');
                cancelNewCat();
            }
            if (id === 'infoModal') switchInfoTab('guide');
        }
        function closeModal(id) {
            const m = document.getElementById(id);
            m.querySelector('div.relative').classList.remove('scale-100');
            m.querySelector('div.relative').classList.add('scale-95');
            setTimeout(() => {
                m.classList.add('pointer-events-none', 'opacity-0');
                if (id === 'accountModal') document.getElementById('accId').value = '';
            }, 200);
        }

        function editAcc(id) {
            const acc = accounts.find(a => a.id === id); if (!acc) return;
            document.getElementById('accId').value = acc.id;
            document.getElementById('accService').value = acc.service;
            const imgs = parseImages(acc.image);
            document.getElementById('accImage').value = imgs.join('\n');
            document.getElementById('accUser').value = acc.user_name;
            document.getElementById('accPass').value = acc.password;
            document.getElementById('accDesc').value = acc.description;
            document.getElementById('accSource').value = acc.source || '';
            document.getElementById('accAdminStatus').value = acc.admin_status || 'working';

            document.getElementById('duplicateWarning').classList.add('hidden');
            document.getElementById('duplicateWarning').classList.remove('flex');

            document.getElementById('accModalTitle').innerText = 'Ch·ªânh S·ª≠a B·∫£n Ghi'; cancelNewCat(); populateCategorySelect(acc.category); openModal('accountModal');
        }

        function requestUnlockAll() {
            pendingUnlockId = 'ALL';
            document.getElementById('btnConfirmUnlock').innerText = 'T√¥i ƒë√£ hi·ªÉu & M·ªü kh√≥a t·∫•t c·∫£';
            openModal('appleWarningModal');
        }

        function openAppleWarning(id) {
            pendingUnlockId = id;
            document.getElementById('btnConfirmUnlock').innerText = 'ƒê·ªìng √Ω & M·ªü kh√≥a n·ªôi dung';
            openModal('appleWarningModal');
        }

        function confirmUnlockApple() {
            if (pendingUnlockId === 'ALL') {
                accounts.forEach(acc => { if (acc.category === 'ID Apple') unlockedCards.add(acc.id); });
                showToast('ƒê√£ c·∫•p quy·ªÅn truy c·∫≠p to√†n b·ªô ID Apple!');
            } else if (pendingUnlockId) {
                unlockedCards.add(pendingUnlockId);
                showToast('M·ªü kh√≥a th√†nh c√¥ng. Vui l√≤ng l√†m ƒë√∫ng h∆∞·ªõng d·∫´n!');
            }
            pendingUnlockId = null; closeModal('appleWarningModal'); renderGrid();
        }

        function copy(text) { navigator.clipboard.writeText(text).then(() => showToast('ƒê√£ l∆∞u v√†o b·ªô nh·ªõ t·∫°m!')); }
        function togglePass(id) { const i = document.getElementById(`pass-${id}`); const c = document.getElementById(`eye-${id}`); i.type = i.type === "password" ? "text" : "password"; c.classList.toggle('fa-eye'); c.classList.toggle('fa-eye-slash'); }
        async function doLogin() { const e = document.getElementById('loginEmail').value; const p = document.getElementById('loginPass').value; const { error } = await sb.auth.signInWithPassword({ email: e, password: p }); if (!error) { showToast('ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã vi√™n th√†nh c√¥ng'); closeModal('loginModal'); } else showToast('Sai th√¥ng tin x√°c th·ª±c'); }
        async function handleLogout() { await sb.auth.signOut(); showToast('ƒê√£ ƒëƒÉng xu·∫•t an to√†n'); }
        async function deleteAcc(id) { if (!confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a b·∫£n ghi n√†y?')) return; const { error } = await sb.from('accounts').delete().eq('id', id); if (!error) { showToast('ƒê√£ x√≥a th√†nh c√¥ng'); fetchAccounts(); } }
        function showToast(msg) { const t = document.getElementById('toast'); document.getElementById('toastMsg').innerText = msg; t.classList.remove('translate-y-20', 'opacity-0'); setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 2500); }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            const themeBtn = document.querySelector('button[onclick="toggleTheme()"]');
            if (document.documentElement.classList.contains('dark')) {
                themeBtn.innerHTML = '<i class="fa-solid fa-sun text-sm"></i>';
            } else {
                themeBtn.innerHTML = '<i class="fa-solid fa-moon text-sm"></i>';
            }
        }

        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        document.getElementById('desktopSearch').addEventListener('input', (e) => { document.getElementById('mobileSearch').value = e.target.value; renderGrid(); });
        document.getElementById('mobileSearch').addEventListener('input', (e) => { document.getElementById('desktopSearch').value = e.target.value; renderGrid(); });

        // Ph√≠m t·∫Øt M·ªü t√¨m ki·∫øm Desktop
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const dSearch = document.getElementById('desktopSearch');
                if (window.innerWidth >= 768) dSearch.focus();
            }
        });

        // Media Modal
        function openMediaModal() {
            openModal('mediaModal');
            switchMediaTab('upload');
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadPreviewContainer').classList.add('hidden');
        }
        function switchMediaTab(tab) {
            const tabUpload = document.getElementById('tabUpload');
            const tabLibrary = document.getElementById('tabLibrary');
            const viewUpload = document.getElementById('viewUpload');
            const viewLibrary = document.getElementById('viewLibrary');
            const activeClass = "border-zinc-900 dark:border-white text-zinc-900 dark:text-white";
            const inactiveClass = "border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300";
            if (tab === 'upload') {
                tabUpload.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${activeClass}`;
                tabLibrary.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${inactiveClass}`;
                viewUpload.classList.remove('hidden'); viewLibrary.classList.add('hidden');
            } else {
                tabLibrary.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${activeClass}`;
                tabUpload.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${inactiveClass}`;
                viewLibrary.classList.remove('hidden'); viewUpload.classList.add('hidden');
                loadLibrary();
            }
        }
        function previewUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('uploadPreviewImg').src = e.target.result;
                    document.getElementById('uploadPreviewContainer').classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        async function doUpload() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;
            const btn = document.getElementById('btnDoUpload');
            btn.innerHTML = '<span class="loader text-white dark:text-zinc-900 w-4 h-4 border-[1.5px] mr-2"></span> ƒêang x·ª≠ l√Ω...'; btn.disabled = true;
            const fileName = Date.now() + '_' + file.name.replace(/\s/g, '_');
            const { data, error } = await sb.storage.from(BUCKET_NAME).upload(fileName, file);
            if (error) { showToast('L·ªói: ' + error.message); } else {
                const { data: { publicUrl } } = sb.storage.from(BUCKET_NAME).getPublicUrl(fileName);
                const el = document.getElementById('accImage');
                el.value = el.value ? el.value + '\n' + publicUrl : publicUrl;
                showToast('ƒê√£ th√™m ·∫£nh v√†o b·ªô nh·ªõ');
                closeModal('mediaModal');
            }
            btn.innerHTML = 'X√°c nh·∫≠n t·∫£i l√™n & S·ª≠ d·ª•ng'; btn.disabled = false;
        }
        async function loadLibrary() {
            const grid = document.getElementById('libGrid');
            const loader = document.getElementById('libLoader');
            grid.innerHTML = ''; loader.classList.remove('hidden');
            const { data, error } = await sb.storage.from(BUCKET_NAME).list('', { limit: 50, sortBy: { column: 'created_at', order: 'desc' } });
            loader.classList.add('hidden');
            if (error) { grid.innerHTML = '<p class="text-zinc-500 col-span-full text-sm font-medium">L·ªói k·∫øt n·ªëi b·ªô nh·ªõ</p>'; return; }
            if (!data || data.length === 0) { grid.innerHTML = '<p class="text-zinc-500 col-span-full text-sm font-medium">Kho ·∫£nh tr·ªëng.</p>'; return; }
            data.forEach(item => {
                if (item.name === '.emptyFolderPlaceholder') return;
                const { data: { publicUrl } } = sb.storage.from(BUCKET_NAME).getPublicUrl(item.name);
                const div = document.createElement('div');
                div.className = "aspect-square rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-700 cursor-pointer hover:border-zinc-400 dark:hover:border-zinc-400 transition-colors shadow-sm relative group";
                div.innerHTML = `<img src="${publicUrl}" class="w-full h-full object-cover">
                                 <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"><i class="fa-solid fa-plus text-white"></i></div>`;
                div.onclick = () => {
                    const el = document.getElementById('accImage');
                    el.value = el.value ? el.value + '\n' + publicUrl : publicUrl;
                    closeModal('mediaModal');
                    showToast('ƒê√£ ch·ªçn URL ·∫£nh');
                };
                grid.appendChild(div);
            });
        }

        async function reportStatus(id, type) {
            const key = `reported_${id}`;
            if (localStorage.getItem(key)) { showToast('B·∫°n ƒë√£ ph·∫£n h·ªìi v·ªÅ b·∫£n ghi n√†y r·ªìi.'); return; }
            const { error } = await sb.rpc('report_account', { row_id: id, status_type: type });
            if (error) { console.error(error); showToast('X·ª≠ l√Ω ph·∫£n h·ªìi th·∫•t b·∫°i'); } else {
                localStorage.setItem(key, 'true'); showToast('H·ªá th·ªëng ƒë√£ ghi nh·∫≠n ph·∫£n h·ªìi!');
                const countElem = document.getElementById(`${type}-count-${id}`);
                if (countElem) {
                    countElem.innerText = parseInt(countElem.innerText) + 1;
                    document.getElementById(`btn-report-working-${id}`).classList.add('opacity-50', 'pointer-events-none');
                    document.getElementById(`btn-report-locked-${id}`).classList.add('opacity-50', 'pointer-events-none');
                }
            }
        }

        function switchInfoTab(tab) {
            const tabGuide = document.getElementById('tabGuide');
            const tabLegal = document.getElementById('tabLegal');
            const viewGuide = document.getElementById('viewGuide');
            const viewLegal = document.getElementById('viewLegal');
            const activeClass = "border-zinc-900 dark:border-white text-zinc-900 dark:text-white";
            const inactiveClass = "border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300";

            if (tab === 'guide') {
                tabGuide.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${activeClass}`;
                tabLegal.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${inactiveClass}`;
                viewGuide.classList.remove('hidden'); viewLegal.classList.add('hidden');
            } else {
                tabLegal.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${activeClass}`;
                tabGuide.className = `pb-3 text-sm font-bold border-b-2 transition-colors ${inactiveClass}`;
                viewLegal.classList.remove('hidden'); viewGuide.classList.add('hidden');
            }
        }
    </script>
</body>

</html>