<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tỷ giá ngoại tệ</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; color: #212529; }
select, button { font-size: 16px; padding: 5px 10px; margin-right: 10px; }
#output { margin-top: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background-color: #e9ecef; }
</style>
</head>
<body>

<h1>Tỷ giá ngoại tệ</h1>

<label for="source">Chọn nguồn:</label>
<select id="source">
  <option value="smiles">Smileswallet</option>
  <option value="sendmoney">SendMoney.co.jp</option>
  <option value="vietcombank">Vietcombank</option>
</select>
<button id="refresh">Lấy tỷ giá</button>

<div id="output">Đang tải...</div>

<script>
const output = document.getElementById('output');
const sourceSelect = document.getElementById('source');
const btn = document.getElementById('refresh');

btn.addEventListener('click', () => {
  const source = sourceSelect.value;
  if (source === 'smiles') fetchSmiles();
  else if (source === 'sendmoney') fetchSendMoney();
  else if (source === 'vietcombank') fetchVietcombank();
});

// ===== Smileswallet =====
async function fetchSmiles() {
  output.textContent = 'Đang tải từ Smileswallet...';
  try {
    const currencies = ['jpy','usd','eur','aud','sgd']; // ví dụ
    let htmlTable = '<table><tr><th>Tiền tệ</th><th>Tỷ giá (VND)</th></tr>';
    for (const from of currencies) {
      const targetUrl = `https://www.smileswallet.com/japan/wp-admin/admin-ajax.php?action=smiles_simulator&security=d4e85f95e8&RemitAmount=0&AmountType=1&RegionCode=jp&FromCurrency=${from}&RemittenceMethod=cash-pickup&DPType=10&BeneficiaryCurrency=vnd&VietNamReceiveIn=VND`;
      const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(targetUrl);
      const resp = await fetch(proxyUrl);
      const data = await resp.json();
      if (data.Rate) htmlTable += `<tr><td>${from.toUpperCase()}</td><td>${Number(data.Rate).toLocaleString('vi-VN')}</td></tr>`;
      else htmlTable += `<tr><td>${from.toUpperCase()}</td><td>Không có dữ liệu</td></tr>`;
    }
    htmlTable += '</table>';
    output.innerHTML = htmlTable;
  } catch (err) {
    output.textContent = 'Lỗi: ' + err.message;
  }
}

// ===== SendMoney.co.jp =====
async function fetchSendMoney() {
  output.textContent = 'Đang tải từ SendMoney.co.jp...';
  try {
    const targetUrl = 'https://sendmoney.co.jp/vi/fx-rate';
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(targetUrl);
    const resp = await fetch(proxyUrl);
    const html = await resp.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const rows = doc.querySelectorAll('table tr');
    let htmlTable = '<table><tr><th>Tiền tệ</th><th>Tỷ giá</th></tr>';
    rows.forEach(row => {
      const cells = row.querySelectorAll('td');
      if (cells.length >= 2) htmlTable += `<tr><td>${cells[0].textContent.trim()}</td><td>${cells[1].textContent.trim()}</td></tr>`;
    });
    htmlTable += '</table>';
    output.innerHTML = htmlTable;
  } catch (err) {
    output.textContent = 'Lỗi: ' + err.message;
  }
}

// ===== Vietcombank (XML) =====
async function fetchVietcombank() {
  output.textContent = 'Đang tải từ Vietcombank...';
  try {
    const targetUrl = 'https://portal.vietcombank.com.vn/Usercontrols/TVPortal.TyGia/pXML.aspx';
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(targetUrl);
    const resp = await fetch(proxyUrl);
    const xmlText = await resp.text();
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
    const exrates = xmlDoc.querySelectorAll('Exrate');
    let htmlTable = '<table><tr><th>Tiền tệ</th><th>Mua</th><th>Bán</th></tr>';
    exrates.forEach(e => {
      const currency = e.getAttribute('CurrencyCode');
      const buy = e.getAttribute('Buy');
      const sell = e.getAttribute('Sell');
      htmlTable += `<tr><td>${currency}</td><td>${buy}</td><td>${sell}</td></tr>`;
    });
    htmlTable += '</table>';
    output.innerHTML = htmlTable;
  } catch (err) {
    output.textContent = 'Lỗi: ' + err.message;
  }
}

// Load mặc định
fetchSmiles();
</script>

</body>
</html>


