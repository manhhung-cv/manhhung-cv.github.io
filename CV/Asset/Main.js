// Äá»‘i tÆ°á»£ng chá»©a cÃ¡c báº£n dá»‹ch
const translations = {
    vi: {
        welcomeText: "Xin chÃ o",
        Fullname: "Äinh Máº¡nh HÃ¹ng",
        Position: "Ká»¹ thuáº­t CÆ¡ Äiá»‡n Tá»­",
        Quote: "Mong muá»‘n phÃ¡t triá»ƒn ká»¹ nÄƒng vÃ  kiáº¿n thá»©c trong ká»¹ thuáº­t cÆ¡ Ä‘iá»‡n tá»­, há»c há»i cÃ´ng nghá»‡ má»›i vÃ  Ä‘Ã³ng gÃ³p vÃ o dá»± Ã¡n thá»±c táº¿ Ä‘á»ƒ trá»Ÿ thÃ nh chuyÃªn gia trong tÆ°Æ¡ng lai.",
        BtnHireMe: "Tuyá»ƒn dá»¥ng",
        BtnDownloadCV: "Táº£i CV",
        Location: "Viá»‡t Nam ğŸ‡»ğŸ‡³",
        

        QualificationsText: "Báº±ng cáº¥p",
        SkillsText: "KÄ© nÄƒng",
        ProjectText: "Dá»± Ã¡n",
        StoreText: "Cá»­a hÃ ng",

        HideInfo: "ThÃ´ng tin bá»‹ áº©n, Chá»‰ hiá»ƒn thá»‹ khi nháº­p mÃ£ tuyá»ƒn dá»¥ng.",

        DevText: "Láº­p trÃ¬nh",

        SkillNote: "*CÃ¡c Ä‘Ã¡nh giÃ¡ nÃ y Ä‘Æ°á»£c dá»±a trÃªn Ä‘Ã¡nh giÃ¡ tá»« nhá»¯ng ngÆ°á»i cÃ³ kinh nghiá»‡m chuyÃªn ngÃ nh.",
        Skill1: "CÆ¡ Ä‘iá»‡n tá»­",
        Skill2: "Láº­p trÃ¬nh PLC",
        Skill3: "Tin há»c vÄƒn phÃ²ng",
        Skill4: "Láº­p trÃ¬nh Web [Front-End]",
        Skill5: "Auto CAD",
        Skill6: "Láº­p trÃ¬nh Arduino, Vi xá»­ lÃ½",

        ExpText: "Kinh nghiá»‡m",
        Exp1: "Tá»‘t nghiá»‡p trung há»c phá»• thÃ´ng",
        Exp2: "Tá»‘t nghiá»‡p Cao Ä‘áº³ng CÆ¡ Äiá»‡n Tá»­ tiÃªu chuáº©n Äá»©c",
        Exp3: "CTY TNHH Ká»¸ THUáº¬T ELECOM VIá»†T NAM",
        Exp3a: "Thá»±c táº­p sinh",
        Exp3b: "Há»c há»i vá» quy trÃ¬nh vÃ  cÃ´ng nghá»‡ cÆ¡ Ä‘iá»‡n tá»­",
        Exp4: "Ká»¹ thuáº­t",
        Exp4a: "Kiá»ƒm tra & sá»­a chá»¯a Motor Ä‘iá»‡n",
        TimeExp5: "1/2025",
        Exp5: "CTY CP THIáº¾T Káº¾ VÃ€ QUáº¢N LÃ Ká»¸ THUáº¬T IMPC",
        Exp5a: "Ká»¹ thuáº­t & GiÃ¡m sÃ¡t",
        Exp5b: `Xá»­ lÃ½ sá»± cá»‘ há»‡ thá»‘ng Ä‘iá»‡n: Kháº¯c phá»¥c cÃ¡c lá»—i nhÆ° máº¥t Ä‘iá»‡n, lá»—i thiáº¿t bá»‹.
        <br>GiÃ¡m sÃ¡t há»‡ thá»‘ng phÃ²ng chÃ¡y chá»¯a chÃ¡y: Kiá»ƒm tra thiáº¿t bá»‹, kiá»ƒm soÃ¡t cÃ¡c nguá»“n chÃ¡y ná»•, Ä‘Ã o táº¡o vá» phÃ²ng chÃ¡y chá»¯a chÃ¡y. 
        <br>GiÃ¡m sÃ¡t an toÃ n lao Ä‘á»™ng: Nháº¯c nhá»Ÿ, phá»• biáº¿n, huáº¥n luyá»‡n an toÃ n cho nhÃ  tháº§u thi cÃ´ng.
        <br>GiÃ¡m sÃ¡t an ninh tráº­t tá»± trong quáº£n lÃ½ dá»± Ã¡n`,

        LanguagesText: "Ngoáº¡i ngá»¯",
        LanEN: "Tiáº¿ng Anh B2",
        LanJA: "Tiáº¿ng Nháº­t N4",

        Cer1: "Cao Ä‘áº³ng CÆ¡ Äiá»‡n Tá»­ - TiÃªu chuáº©n Äá»©c",
        Cer1a: "TrÆ°á»ng Cao Ä‘áº³ng CÃ´ng nghá»‡ Quá»‘c táº¿ LILAMA2",

    },
    en: {
        welcomeText: "Hello",
        Fullname: "Dinh Manh Hung",
        Position: "Mechatronics Engineering",
        Quote: "*Desiring to develop skills and knowledge in mechatronics engineering, learn new technologies, and contribute to real-world projects to become an expert in the future.",
        BtnHireMe: "Hire Me",
        BtnDownloadCV: "Download CV",
        Location: "Viet Nam ğŸ‡»ğŸ‡³",

        QualificationsText: "Qualifications",
        SkillsText: "Skills",
        ProjectText: "Project",
        StoreText: "Store",

        HideInfo: "Information is hidden, Only displayed when entering recruitment code.",

        DevText: "Developer",

        SkillNote: "*These evaluations are based on assessments from experienced professionals in the field.",
        Skill1: "Mechatronics",
        Skill2: "PLC Programming",
        Skill3: "Office Computing",
        Skill4: "Web Programming [Front-End]",
        Skill5: "Auto CAD",
        Skill6: "Arduino Programming, Microcontroller",

        ExpText: "Experience",
        Exp1: "High School Graduate",
        Exp2: "Graduated from German-standard Mechatronics College",
        Exp3: "ELECOM VIETNAM TECHNICAL CO., LTD",
        Exp3a: "Intern",
        Exp3b: "Learning about mechatronics processes and technology",
        Exp4: "Technical",
        Exp4a: "Inspect & repair electric motors",
        TimeExp5: "1/2025",
        Exp5: "IMPC ENGINEERING DESIGN AND MANAGEMENT JSC",
        Exp5a: "Technical & Supervision",
        Exp5b: `Handling electrical system issues: Troubleshooting issues like power outages, equipment failures.
        <br>Supervising fire protection systems: Inspecting equipment, monitoring fire/explosion sources, providing fire protection training.
        <br>Supervising labor safety: Reminding, educating, and training safety practices for contractors.
        <br>Supervising security and order in project management.`,

        LanguagesText: "Languages",
        LanEN: "English B2",
        LanJA: "JLPT N4",

        Cer1: "College of Mechatronics - German Standard",
        Cer1a: "LILAMA2 International Technology College"
    },
    ja: {
        welcomeText: "ã“ã‚“ã«ã¡ã¯",
        Fullname: "ãƒ‡ã‚£ãƒ³ ãƒãƒ³ ãƒ•ãƒ³",
        Position: "ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹å·¥å­¦",
        Quote: "ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹ã®ã‚¹ã‚­ãƒ«ã¨çŸ¥è­˜ã‚’ä¼¸ã°ã—ãŸã„ã§ã™ã€‚ãã—ã¦ã€æ–°ã—ã„æŠ€è¡“ã‚’å­¦ã³ã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‚åŠ ã—ã¦ã€å°†æ¥å°‚é–€å®¶ã«ãªã‚ŠãŸã„ã§ã™.",
        BtnHireMe: "ç§ã‚’é›‡ã£ã¦ãã ã•ã„",
        BtnDownloadCV: "å±¥æ­´æ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
        Location: "ãƒ™ãƒˆãƒŠãƒ  ğŸ‡»ğŸ‡³",

        QualificationsText: "è³‡æ ¼",
        SkillsText: "ã‚¹ã‚­ãƒ«",
        ProjectText: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
        StoreText: "ã‚·ãƒ§ãƒƒãƒ—",

        HideInfo: " æƒ…å ±ã¯éè¡¨ç¤ºã€æ¡ç”¨ã‚³ãƒ¼ãƒ‰å…¥åŠ›æ™‚ã®ã¿è¡¨ç¤º",
        DevText: "é–‹ç™ºè€… ",

        SkillNote: "*ã“ã‚Œã‚‰ã®è©•ä¾¡ã¯ã€å°‚é–€åˆ†é‡ã§çµŒé¨“ã®ã‚ã‚‹äººã®è©•ä¾¡ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚",
        Skill1: "ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹",
        Skill2: "PLCãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°",
        Skill3: "ã‚ªãƒ•ã‚£ã‚¹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°",
        Skill4: "ã‚¦ã‚§ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰]",
        Skill5: "ã‚ªãƒ¼ãƒˆCAD",
        Skill6: "Arduinoãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼",

        ExpText: "çµŒé¨“ (ã‘ã„ã‘ã‚“)",
        Exp1: "é«˜æ ¡å’æ¥­",
        Exp2: "ãƒ‰ã‚¤ãƒ„åŸºæº–ã®ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹å°‚é–€å­¦æ ¡å’æ¥­",
        Exp3: "ELECOM VIETNAM æŠ€è¡“æœ‰é™ä¼šç¤¾",
        Exp3a: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³",
        Exp3b: "ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨æŠ€è¡“ã«ã¤ã„ã¦å­¦ã¶",
        Exp4: "æŠ€è¡“",
        Exp4a: "é›»å‹•ãƒ¢ãƒ¼ã‚¿ãƒ¼ã®æ¤œæŸ»ã¨ä¿®ç†",
        TimeExp5: "1/2025",
        Exp5: "IMPCè¨­è¨ˆã¨æŠ€è¡“ç®¡ç†æ ªå¼ä¼šç¤¾",
        Exp5a: "æŠ€è¡“ã¨ç›£ç£",
        Exp5b: `é›»æ°—ã‚·ã‚¹ãƒ†ãƒ ã®å•é¡Œå¯¾å¿œ: åœé›»ã€è¨­å‚™æ•…éšœãªã©ã®å•é¡Œã‚’è§£æ±ºã€‚
<br>é˜²ç«ã‚·ã‚¹ãƒ†ãƒ ã®ç›£è¦–: æ©Ÿå™¨ã®ç‚¹æ¤œã€ç«ç½ã‚„çˆ†ç™ºæºã®ç®¡ç†ã€é˜²ç«è¨“ç·´ã€‚
<br>åŠ´åƒå®‰å…¨ã®ç›£è¦–: æ–½å·¥æ¥­è€…ã¸ã®æ³¨æ„å–šèµ·ã€æ•™è‚²ã€å®‰å…¨è¨“ç·´ã€‚
<br>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã®æ²»å®‰ã¨ç§©åºã®ç›£è¦–ã€‚`,
        LanguagesText: "è¨€èª (ã’ã‚“ã”)",
        LanEN: "è‹±èª B2",
        LanJA: "JLPT N4",

        Cer1: "ãƒ¡ã‚«ãƒˆãƒ­ãƒ‹ã‚¯ã‚¹å°‚é–€å­¦æ ¡ - ãƒ‰ã‚¤ãƒ„åŸºæº–",
        Cer1a: "LILAMA2å›½éš›æŠ€è¡“å°‚é–€å­¦æ ¡"
    },
    zh: {
        "welcomeText": "ä½ å¥½",
        "Fullname": "ä¸å­Ÿé›„",
        "Position": "æœºç”µå·¥ç¨‹",
        "Quote": "å¸Œæœ›åœ¨æœºç”µå·¥ç¨‹é¢†åŸŸæå‡æŠ€èƒ½å’ŒçŸ¥è¯†ï¼Œå­¦ä¹ æ–°æŠ€æœ¯å¹¶å‚ä¸å®é™…é¡¹ç›®ï¼Œä¸ºæˆä¸ºæœªæ¥çš„ä¸“å®¶è€ŒåŠªåŠ›ã€‚",
        "BtnHireMe": "æ‹›è˜",
        "BtnDownloadCV": "ä¸‹è½½ç®€å†",
        Location: "è¶Šå— ğŸ‡»ğŸ‡³",

        "QualificationsText": "å­¦å†",
        "SkillsText": "æŠ€èƒ½",
        "ProjectText": "é¡¹ç›®",
        "StoreText": "å•†åº—",

        "HideInfo": "ä¿¡æ¯éšè—ï¼Œä»…è¾“å…¥æ‹›è˜ç æ—¶æ˜¾ç¤º",

        "DevText": "ç¼–ç¨‹",

        "SkillNote": "*è¿™äº›è¯„ä¼°åŸºäºæœ‰è¡Œä¸šç»éªŒçš„ä¸“ä¸šäººå£«çš„è¯„ä»·ã€‚",
        "Skill1": "æœºç”µå·¥ç¨‹",
        "Skill2": "PLCç¼–ç¨‹",
        "Skill3": "åŠå…¬è½¯ä»¶",
        "Skill4": "ç½‘é¡µç¼–ç¨‹ [å‰ç«¯]",
        "Skill5": "Auto CAD",
        "Skill6": "Arduinoå’Œå¾®å¤„ç†å™¨ç¼–ç¨‹",

        "ExpText": "ç»éªŒ",
        "Exp1": "é«˜ä¸­æ¯•ä¸š",
        "Exp2": "å¾·å›½æ ‡å‡†æœºç”µå·¥ç¨‹ä¸“ç§‘æ¯•ä¸š",
        "Exp3": "è¶Šå—ELECOMæŠ€æœ¯æœ‰é™å…¬å¸",
        "Exp3a": "å®ä¹ ç”Ÿ",
        "Exp3b": "å­¦ä¹ æœºç”µå·¥ç¨‹çš„æµç¨‹å’ŒæŠ€æœ¯",
        "Exp4": "æŠ€æœ¯",
        "Exp4a": "ç”µåŠ¨æœºçš„æ£€æŸ¥å’Œç»´ä¿®",
        "TimeExp5": "1/2025",
        "Exp5": "IMPCè®¾è®¡ä¸æŠ€æœ¯ç®¡ç†è‚¡ä»½å…¬å¸",
        "Exp5a": "æŠ€æœ¯ä¸ç›‘ç£",
        "Exp5b": "å¤„ç†ç”µåŠ›ç³»ç»Ÿé—®é¢˜ï¼šè§£å†³ç”µåŠ›ä¸­æ–­ã€è®¾å¤‡æ•…éšœç­‰é—®é¢˜ã€‚<br>æ¶ˆé˜²ç³»ç»Ÿç›‘æ§ï¼šæ£€æŸ¥è®¾å¤‡ï¼Œæ§åˆ¶ç«ç¾æºï¼Œè¿›è¡Œæ¶ˆé˜²åŸ¹è®­ã€‚<br>èŒä¸šå®‰å…¨ç›‘ç£ï¼šæé†’ã€å®£ä¼ å’ŒåŸ¹è®­æ–½å·¥æ‰¿åŒ…å•†çš„å®‰å…¨æªæ–½ã€‚<br>é¡¹ç›®ç®¡ç†ä¸­çš„ç§©åºä¸å®‰å…¨ç›‘æ§ã€‚",

        LanguagesText: "èªè¨€",
        LanEN: "è‹±èª B2",
        LanJA: "JLPT N4",

        Cer1: "æœºç”µä¸€ä½“åŒ–å­¦é™¢ - å¾·å›½æ ‡å‡†",
        Cer1a: "LILAMA2å›½é™…æŠ€æœ¯å­¦é™¢",
    }
};


// HÃ m báº­t/táº¯t hiá»ƒn thá»‹ menu ngÃ´n ngá»¯
function toggleDropdown() {
    const dropdown = document.getElementById('languageDropdown');
    dropdown.classList.toggle('show');
}

// HÃ m lÆ°u ngÃ´n ngá»¯ vÃ  cáº­p nháº­t cá»
function setLanguage(language, flagSrc) {
    localStorage.setItem('language', language);
    applyLanguage(language);

    // Cáº­p nháº­t áº£nh lÃ¡ cá» trong Language Active
    document.getElementById('currentFlag').src = flagSrc;

    // áº¨n menu sau khi chá»n ngÃ´n ngá»¯
    document.getElementById('languageDropdown').classList.remove('show');
}

// HÃ m khá»Ÿi táº¡o khi táº£i trang
document.addEventListener('DOMContentLoaded', () => {
    const savedLanguage = localStorage.getItem('language');
    if (savedLanguage) {
        applyLanguage(savedLanguage);
        updateFlag(savedLanguage);
    } else {
        applyLanguage('vi');
    }
});

// HÃ m Ã¡p dá»¥ng ngÃ´n ngá»¯

function applyLanguage(language) {
    var body = document.body.classList;
    body.remove('en', 'vi', 'ja', 'zh');

    // ThÃªm lá»›p ngÃ´n ngá»¯ má»›i
    body.add(language);

    // Láº¥y táº¥t cáº£ pháº§n tá»­ cÃ³ thuá»™c tÃ­nh data-translate vÃ  cáº­p nháº­t ná»™i dung
    document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        el.innerHTML = translations[language][key] || el.innerHTML;
    });
}

// HÃ m cáº­p nháº­t cá» dá»±a trÃªn ngÃ´n ngá»¯ Ä‘Ã£ lÆ°u
function updateFlag(language) {
    const flagMap = {
        'vi': './Asset/icon/flag/Vietnam.png',
        'en': './Asset/icon/flag/US.png',
        'ja': './Asset/icon/flag/Japan.png',
        'zh': './Asset/icon/flag/china.png'
    };
    document.getElementById('currentFlag').src = flagMap[language];
}



//Theme Darkmode - LightMode
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');

// Load the theme from localStorage
const currentTheme = localStorage.getItem('theme') || 'light';
document.body.classList.add(currentTheme + '-theme');
themeIcon.src = currentTheme === 'light' ? './Asset/icon/theme/sun.png' : './Asset/icon/theme/moon.png';

// Toggle theme function
themeToggle.addEventListener('click', () => {
    const newTheme = document.body.classList.contains('light-theme') ? 'dark' : 'light';
    document.body.classList.toggle('light-theme');
    document.body.classList.toggle('dark-theme');
    themeIcon.src = newTheme === 'light' ? './Asset/icon/theme/sun.png' : './Asset/icon/theme/moon.png';

    // Save the new theme to localStorage
    localStorage.setItem('theme', newTheme);
});


// Táº¡o cÃ¡c thanh tiáº¿n trÃ¬nh dá»±a trÃªn data-percentage
document.querySelectorAll('.progress').forEach(function (progress) {
    let percentage = progress.getAttribute('data-percentage');

    // Táº¡o pháº§n tá»­ nhÃ£n, thanh chá»©a vÃ  thanh tiáº¿n trÃ¬nh
    let container = document.createElement('div');
    container.classList.add('progress-container');


    let barWrapper = document.createElement('div');
    barWrapper.classList.add('progress-bar-wrapper');

    let bar = document.createElement('div');
    bar.classList.add('progress-bar');
    bar.style.width = percentage + '%';

    // Gáº¯n cÃ¡c pháº§n tá»­ vÃ o DOM
    barWrapper.appendChild(bar);
    container.appendChild(barWrapper);
    progress.appendChild(container);
});





async function DownloadCV() {
    const { value: password } = await Swal.fire({
        title: "Recruitment Code",
        input: "text",
        inputLabel: "Password",
        inputPlaceholder: "Recruitment Code",
        inputAttributes: {
            maxlength: "10",
            autocapitalize: "off",
            autocorrect: "off"
        }
    });

    // Náº¿u cÃ³ nháº­p máº­t kháº©u
    if (password) {
        try {
            // Giáº£i mÃ£ ná»™i dung `.Contact` báº±ng máº­t kháº©u nháº­p vÃ o
            const decryptedContent = CryptoJS.AES.decrypt(encryptedContactInfo, password).toString(CryptoJS.enc.Utf8);

            // Kiá»ƒm tra náº¿u máº­t kháº©u Ä‘Ãºng (ná»™i dung giáº£i mÃ£ khÃ´ng rá»—ng)
            if (decryptedContent) {
                document.getElementById("Download").innerHTML = decryptedContent;
                document.getElementById("Download").style.display = "block";
                Swal.fire("Access Granted!", "Contact details are now visible", "success");
            } else {
                Swal.fire("Access denied", "Incorrect password", "error");
            }
        } catch (e) {
            Swal.fire("Access Denied", "Incorrect password", "error");
        }
    }
}

// MÃ£ hÃ³a ná»™i dung liÃªn há»‡ Ä‘á»ƒ trÃ¡nh hiá»ƒn thá»‹ trong mÃ£ nguá»“n
const encryptedContactInfo = "U2FsdGVkX18+/WQMYjScy5xZYU82uVGNZIfAnoF79uBZEVY7I2/RZ9UmEw8A6g00XlHVm7ZUBnQx2O1c4l4SQWQ1+brNt7bb/8nOfCs8cGnLWVjlz1MPxkBUZaj0XMTVH+MxcD0ODkb/Ilw0n0NfHOrkIh3n5wodM/q0vM2ebilMADuMC8sEctbMvQkez+K9wGiBvqOCi40z/NWarpV/Mw==";



// WEATHER
const apiKey = 'KZH7P9GUL9SBMVQ5MV4WDF23L'; // Thay tháº¿ báº±ng API Key cá»§a báº¡n

function getWeatherAuto() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                localStorage.setItem('location', `${lat},${lon}`);
                fetchWeather(lat, lon);
            },
            () => {
                // Náº¿u khÃ´ng thá»ƒ láº¥y vá»‹ trÃ­, sá»­ dá»¥ng IP Ä‘á»ƒ láº¥y thá»i tiáº¿t
                getWeatherByIP();
            }
        );
    } else {
        // Náº¿u trÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹, sá»­ dá»¥ng IP Ä‘á»ƒ láº¥y thá»i tiáº¿t
        getWeatherByIP();
    }
}

// Báº£ng Ã¡nh xáº¡ tá»« hÆ°á»›ng giÃ³ quá»‘c táº¿ sang thuáº§n Viá»‡t
const windDirectionMap = {
    'N': 'Báº¯c',
    'NNE': 'Báº¯c ÄÃ´ng Báº¯c',
    'NE': 'ÄÃ´ng Báº¯c',
    'ENE': 'ÄÃ´ng Báº¯c ÄÃ´ng',
    'E': 'ÄÃ´ng',
    'ESE': 'ÄÃ´ng ÄÃ´ng Nam',
    'SE': 'ÄÃ´ng Nam',
    'SSE': 'Nam ÄÃ´ng Nam',
    'S': 'Nam',
    'SSW': 'Nam TÃ¢y Nam',
    'SW': 'TÃ¢y Nam',
    'WSW': 'TÃ¢y TÃ¢y Nam',
    'W': 'TÃ¢y',
    'WNW': 'TÃ¢y Báº¯c TÃ¢y',
    'NW': 'TÃ¢y Báº¯c',
    'NNW': 'Báº¯c TÃ¢y Báº¯c'
};

// Báº£ng Ã¡nh xáº¡ mÃ£ Ä‘iá»u kiá»‡n thá»i tiáº¿t sang mÃ´ táº£ tiáº¿ng Viá»‡t
const weatherConditionMap = {
    'clear-day': 'Trá»i quang Ä‘Ã£ng',
    'clear-night': 'Trá»i quang Ä‘Ã£ng',
    'partly-cloudy-day': 'CÃ³ mÃ¢y',
    'partly-cloudy-night': 'CÃ³ mÃ¢y',
    'cloudy': 'Trá»i nhiá»u mÃ¢y',
    'rain': 'MÆ°a rÃ o',
    'sleet': 'MÆ°a tuyáº¿t',
    'snow': 'Tuyáº¿t rÆ¡i',
    'wind': 'GiÃ³',
    'fog': 'SÆ°Æ¡ng mÃ¹',
    'hail': 'MÆ°a Ä‘Ã¡',
    'thunderstorm': 'BÃ£o tá»‘'
};

async function fetchWeather(latitude, longitude) {
    const response = await fetch(`https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${latitude},${longitude}?unitGroup=metric&key=${apiKey}&contentType=json`);
    const data = await response.json();

    // Xá»­ lÃ½ thÃ´ng tin Ä‘iá»u kiá»‡n thá»i tiáº¿t
    const currentConditions = data.currentConditions;
    const conditionCode = currentConditions.icon;
    const conditionText = weatherConditionMap[conditionCode] || currentConditions.conditions;
    const conditionIcon = `/Asset/Weather/${conditionCode}.svg`;

    // document.getElementById('temperature').innerHTML = `${currentConditions.temp.toFixed(0)}Â°C`;
    // document.getElementById('rain_chance').innerHTML = `<i class="fa-solid fa-cloud-rain"></i> ${currentConditions.precip !== null ? currentConditions.precip.toFixed(1) : 0} mm`;
    // document.getElementById('uv_index').innerHTML = `<i class="fa-solid fa-sun"></i> UV: ${currentConditions.uvindex}`;

    // // Chuyá»ƒn Ä‘á»•i giÃ³ hÆ°á»›ng sang Ä‘á»‹nh dáº¡ng thuáº§n Viá»‡t
    // const windDir = currentConditions.winddir;
    // const windDirection = windDirectionMap[windDir] || windDir;
    // document.getElementById('wind_direction').innerHTML = `<i class="fa-solid fa-wind"></i> ${windDirection} ${currentConditions.windspeed.toFixed(1)} km/h`;

    reverseGeocodeNominatim(latitude, longitude).then(({ address, addressFull }) => {
        // Cáº­p nháº­t ná»™i dung trÃªn giao diá»‡n ngÆ°á»i dÃ¹ng
        document.getElementById('weather').innerHTML = `<p>${address} <i class="fa-solid fa-location-arrow" aria-hidden="true"></i></p>
  <div class="flex">
    <img src="${conditionIcon}" alt="${conditionText}" />
      <h1>${currentConditions.temp.toFixed(0)}Â°C</h1></div>
    </div>
      
      `;
    }).catch(error => {
        console.error('Lá»—i khi láº¥y Ä‘á»‹a Ä‘iá»ƒm:', error);
    });

}

async function reverseGeocodeNominatim(latitude, longitude) {
    try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
        const data = await response.json();
        // Khá»Ÿi táº¡o giÃ¡ trá»‹ máº·c Ä‘á»‹nh cho address vÃ  addressFull
        let address = '';
        let addressFull = '';

        if (data.address) {
            if (data.address.village !== undefined) {
                const originalSuburb = data.address.village || '';  // Äáº£m báº£o cÃ³ giÃ¡ trá»‹ máº·c Ä‘á»‹nh
                const formattedSuburb = originalSuburb.replace(/^XÃ£\s/, 'X.');
                address = formattedSuburb;
            } else if (data.address.quarter !== undefined) {
                address = data.address.quarter;
            } else {
                const originalSuburb = data.address.suburb || '';  // Äáº£m báº£o cÃ³ giÃ¡ trá»‹ máº·c Ä‘á»‹nh
                const formattedSuburb = originalSuburb.replace(/^PhÆ°á»ng\s/, 'P.');
                address = formattedSuburb;
            }
            addressFull = data.display_name;

        } else {
            throw new Error('KhÃ´ng thá»ƒ tÃ¬m tháº¥y Ä‘á»‹a Ä‘iá»ƒm.');
        }

        return {
            address: address.trim(),
            addressFull: addressFull.trim()
        };
    } catch (error) {
        console.error('Lá»—i khi tÃ¬m Ä‘á»‹a Ä‘iá»ƒm:', error);
        throw error;  // NÃ©m lá»—i Ä‘á»ƒ xá»­ lÃ½ á»Ÿ nÆ¡i gá»i hÃ m
    }
}

async function getWeatherByIP() {
    try {
        const ipResponse = await fetch('https://ipinfo.io/json?token=8c35ace05458e6');
        const ipData = await ipResponse.json();

        document.getElementById('ip').innerText = `IP: ${ipData.ip}`;
        document.getElementById('organization').innerText = `NhÃ  máº¡ng: ${ipData.org}`;

        if (ipData.loc) {
            const [latitude, longitude] = ipData.loc.split(',');
            fetchWeather(latitude, longitude);
        } else {
            console.error('KhÃ´ng tÃ¬m tháº¥y thÃ´ng tin tá»a Ä‘á»™ tá»« IP.');
        }
    } catch (error) {
        console.error('Lá»—i khi láº¥y thÃ´ng tin tá»« IP:', error);
    }
}

function getWeatherByGeolocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async position => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            fetchWeather(lat, lon);
        }, error => {
            console.error('Lá»—i khi láº¥y thÃ´ng tin Ä‘á»‹nh vá»‹:', error);
        });
    } else {
        alert('TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹ Ä‘á»‹a lÃ½.');
    }
}

async function geocodeAddress(address) {
    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json&limit=1`);
    const data = await response.json();

    if (data.length > 0) {
        const location = data[0];
        return {
            latitude: location.lat,
            longitude: location.lon
        };

    } else {
        throw new Error('KhÃ´ng tÃ¬m tháº¥y Ä‘á»‹a Ä‘iá»ƒm.');
    }

}

async function getWeatherByManual() {
    const manualLocation = document.getElementById('manualLocation').value;
    if (manualLocation) {
        try {
            const { latitude, longitude } = await geocodeAddress(manualLocation);
            fetchWeather(latitude, longitude);
        } catch (error) {
            alert(error.message);
        }
    } else {
        Info('Vui lÃ²ng nháº­p Ä‘á»‹a Ä‘iá»ƒm.');
    }
}

//Modal thá»i tiáº¿t
document.addEventListener('DOMContentLoaded', () => {
    const weatherPreference = localStorage.getItem('weatherPreference');
    if (weatherPreference === 'none') {
        // Náº¿u ngÆ°á»i dÃ¹ng chá»n "KhÃ´ng", khÃ´ng lÃ m gÃ¬
        return;
    } else if (!weatherPreference) {
        // Hiá»ƒn thá»‹ modal náº¿u chÆ°a lÆ°u lá»±a chá»n
        document.getElementById('weatherModal').style.display = 'flex';
    } else if (weatherPreference === 'geolocation') {
        getWeatherAuto();
    } else if (weatherPreference === 'ip') {
        getWeatherByIP();
    }
});


// Láº¯ng nghe sá»± kiá»‡n click trÃªn pháº§n tá»­ #weather
document.getElementById('weather').addEventListener('click', () => {
    // Hiá»ƒn thá»‹ láº¡i modal Ä‘á»ƒ ngÆ°á»i dÃ¹ng thay Ä‘á»•i quyáº¿t Ä‘á»‹nh
    document.getElementById('weatherModal').style.display = 'flex';
    // XÃ³a tráº¡ng thÃ¡i "khÃ´ng há»i ná»¯a" Ä‘á»ƒ cho phÃ©p chá»n láº¡i
    localStorage.removeItem('weatherPreference');
});


// HÃ m xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng chá»n phÆ°Æ¡ng thá»©c
function handleWeatherChoice(choice) {
    const modal = document.getElementById('weatherModal');

    if (choice === 'geolocation') {
        // LÆ°u lá»±a chá»n Ä‘á»‹nh vá»‹ vÃ  gá»i hÃ m láº¥y thá»i tiáº¿t
        localStorage.setItem('weatherPreference', 'geolocation');
        getWeatherAuto();
    } else if (choice === 'ip') {
        // LÆ°u lá»±a chá»n IP vÃ  gá»i hÃ m láº¥y thá»i tiáº¿t
        localStorage.setItem('weatherPreference', 'ip');
        getWeatherByIP();
    } else if (choice === 'cancel') {
        // LÆ°u lá»±a chá»n "khÃ´ng há»i ná»¯a"
        localStorage.setItem('weatherPreference', 'none');
        // XÃ³a thÃ´ng tin vá»‹ trÃ­ cÅ© náº¿u cÃ³
        localStorage.removeItem('location');
    }

    // áº¨n modal
    modal.style.display = 'none';
}
