<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share&Go</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- B·ªî SUNG: Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- B·ªî SUNG: Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <!-- B·ªî SUNG: Script ch·ªëng FOUC (Flash of Unstyled Content) cho Dark Mode -->
    <script>
        // Th√™m s·ª± ki·ªán n√†y ƒë·ªÉ ƒë·∫£m b·∫£o HTML ƒë√£ t·∫£i xong
        document.addEventListener('DOMContentLoaded', function () {

            // ƒê·∫∑t to√†n b·ªô m√£ c·ªßa b·∫°n v√†o b√™n trong
            (function () {
                const themeToggle = document.getElementById('theme-toggle');

                // Ki·ªÉm tra n·∫øu n√∫t b·∫•m kh√¥ng t·ªìn t·∫°i th√¨ tho√°t
                if (!themeToggle) {
                    console.error('Kh√¥ng t√¨m th·∫•y n√∫t #theme-toggle. H√£y ki·ªÉm tra l·∫°i ID trong HTML.');
                    return;
                }

                const toggleIcon = themeToggle.querySelector('i');

                // ƒê·ªãnh nghƒ©a c√°c ch·∫ø ƒë·ªô
                const themes = [
                    { name: 'system', icon: 'fa-desktop', title: 'Ch·∫ø ƒë·ªô H·ªá th·ªëng' },
                    { name: 'light', icon: 'fa-sun', title: 'Ch·∫ø ƒë·ªô S√°ng' },
                    { name: 'dark', icon: 'fa-moon', title: 'Ch·∫ø ƒë·ªô T·ªëi' }
                ];

                // H√†m c·∫≠p nh·∫≠t icon v√† title
                function updateButton(themeName) {
                    const theme = themes.find(t => t.name === themeName) || themes[0];
                    if (toggleIcon) {
                        toggleIcon.className = `fa-solid ${theme.icon}`;
                    }
                    themeToggle.title = theme.title;
                }

                // H√†m ch√≠nh ƒë·ªÉ ƒë·∫∑t theme
                function setTheme(themeName) {
                    let effectiveTheme = themeName;

                    if (themeName === 'system') {
                        effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    }

                    document.documentElement.setAttribute('data-theme', effectiveTheme);
                    localStorage.setItem('theme', themeName);
                    updateButton(themeName);
                }

                // L·∫•y theme ƒë√£ l∆∞u
                let currentThemeName = localStorage.getItem('theme') || 'system';

                // √Åp d·ª•ng theme khi t·∫£i trang
                setTheme(currentThemeName);

                // X·ª≠ l√Ω s·ª± ki·ªán click
                themeToggle.addEventListener('click', () => {
                    const currentIndex = themes.findIndex(t => t.name === currentThemeName);
                    const nextIndex = (currentIndex + 1) % themes.length;
                    const nextTheme = themes[nextIndex];

                    currentThemeName = nextTheme.name;
                    setTheme(currentThemeName);
                });

                // L·∫Øng nghe thay ƒë·ªïi theme c·ªßa h·ªá th·ªëng
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (localStorage.getItem('theme') === 'system') {
                        const newSystemTheme = event.matches ? 'dark' : 'light';
                        document.documentElement.setAttribute('data-theme', newSystemTheme);
                    }
                });

            })(); // K·∫øt th√∫c (function() { ... })

        }); // K·∫øt th√∫c DOMContentLoaded
        // S·ª≠ d·ª•ng window.onload ƒë·ªÉ ƒë·∫£m b·∫£o m·ªçi th·ª© (CSS, JS, ·∫£nh) ƒë√£ t·∫£i xong

        document.addEventListener('DOMContentLoaded', () => {

            // T√¨m nh√≥m sao v√† input ·∫©n
            const starWrapper = document.querySelector('.star-rating');

            // Ki·ªÉm tra xem starWrapper c√≥ t·ªìn t·∫°i kh√¥ng tr∆∞·ªõc khi ch·∫°y
            if (starWrapper) {
                const stars = starWrapper.querySelectorAll('i');
                const hiddenInput = document.getElementById('location-rating');

                // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t hi·ªÉn th·ªã sao d·ª±a tr√™n gi√° tr·ªã (value)
                function setRatingVisual(value) {
                    stars.forEach((star, index) => {
                        // index l√† 0-4, value l√† 1-5
                        if (index < value) {
                            star.classList.add('active');
                        } else {
                            star.classList.remove('active');
                        }
                    });
                }

                // --- C√ÅC S·ª∞ KI·ªÜN ---

                // 1. ƒê·∫∑t tr·∫°ng th√°i ban ƒë·∫ßu khi t·∫£i trang
                // (l·∫•y gi√° tr·ªã t·ª´ input ·∫©n, ƒëang l√† "5")
                setRatingVisual(hiddenInput.value);

                // 2. Th√™m s·ª± ki·ªán 'click' cho t·ª´ng ng√¥i sao
                stars.forEach(star => {
                    star.addEventListener('click', () => {
                        const value = star.dataset.value;
                        hiddenInput.value = value; // C·∫¨P NH·∫¨T GI√Å TR·ªä C·ª¶A INPUT ·∫®N
                        setRatingVisual(value);    // C·∫≠p nh·∫≠t hi·ªÉn th·ªã sao
                    });

                    // 3. Th√™m s·ª± ki·ªán 'mouseover' (khi di chu·ªôt v√†o)
                    star.addEventListener('mouseover', () => {
                        setRatingVisual(star.dataset.value); // Hi·ªÉn th·ªã t·∫°m th·ªùi
                    });
                });

                // 4. Th√™m s·ª± ki·ªán 'mouseout' (khi di chu·ªôt ra kh·ªèi)
                // Ta g√°n s·ª± ki·ªán n√†y cho c·∫£ nh√≥m sao
                starWrapper.addEventListener('mouseout', () => {
                    // Quay l·∫°i hi·ªÉn th·ªã gi√° tr·ªã ƒê√É CH·ªåN (l∆∞u trong input)
                    setRatingVisual(hiddenInput.value);
                });
            }
        });
    </script>



    <script type="module" src="./app.js"></script>

    <!-- C√°c script th∆∞ vi·ªán b√™n ngo√†i -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>

<body>

    <div id="loading">
        <span>ƒêang t·∫£i...</span>
        <div class="spinner"></div>
    </div>
    <!-- S·ª¨A ƒê·ªîI: Auth Container -->
    <div id="auth-container">
        <!-- C√°c form gi·ªØ nguy√™n nh∆∞ng s·∫Ω ƒë∆∞·ª£c style b·∫±ng CSS m·ªõi -->
        <div id="login-form">
            <h2>ƒêƒÉng nh·∫≠p Share&Go</h2>
            <form>
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">M·∫≠t kh·∫©u:</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit">ƒêƒÉng nh·∫≠p</button>
            </form>
            <p style="margin-top: 16px; text-align: center;">
                <a href="#" id="show-register-link">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</a>
                <br>
                <a href="#" id="show-forgot-pass-link">Qu√™n m·∫≠t kh·∫©u?</a>
            </p>
        </div>

        <div id="register-form" style="display: none;">
            <h2>ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
            <form>
                <div class="form-group">
                    <label for="register-name">T√™n hi·ªÉn th·ªã:</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-facebook">ID Facebook (t√πy ch·ªçn, ƒë·ªÉ hi·ªÉn th·ªã avatar):</label>
                    <input type="text" id="register-facebook">
                </div>
                <div class="form-group">
                    <label for="register-email">Email:</label>
                    <input type="email" id="register-email" placeholder="ch·ªâ nh·∫≠n @gmail, @icloud, @mhung.site"
                        required>
                </div>
                <div class="form-group">
                    <label for="register-password">M·∫≠t kh·∫©u:</label>
                    <input type="password" id="register-password" required>
                </div>
                <div class="form-group form-group-inline">
                    <input type="password" id="register-confirm-password" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required
                        style="margin-bottom: 0;">
                    <button type="button" id="register-toggle-pass" class="secondary"
                        style="width: 50px; padding: 12px 0;">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <button type="submit">ƒêƒÉng k√Ω</button>
            </form>
            <a href="#" id="show-login-link" style="display: block; text-align: center; margin-top: 16px;">ƒê√£ c√≥ t√†i
                kho·∫£n? ƒêƒÉng nh·∫≠p</a>
        </div>

        <div id="forgot-password-form" style="display: none;">
            <h2>Qu√™n m·∫≠t kh·∫©u</h2>
            <form>
                <div class="form-group">
                    <label for="forgot-email">Nh·∫≠p email c·ªßa b·∫°n:</label>
                    <input type="email" id="forgot-email" required>
                </div>
                <button type="submit">G·ª≠i email kh√¥i ph·ª•c</button>
            </form>
            <a href="#" id="back-to-login-link" style="display: block; text-align: center; margin-top: 16px;">Quay l·∫°i
                ƒêƒÉng nh·∫≠p</a>
        </div>
    </div>

    <!-- S·ª¨A ƒê·ªîI: App Container -->
    <div id="app-container" style="display: none;">
        <header>
            <h1>Share&Go</h1>


            <div class="user">
                <div id="user-display"></div>
                <div class="theme-switcher">
                    <button id="theme-toggle" class="icon-btn" title="Ch·∫ø ƒë·ªô H·ªá th·ªëng">
                        <i class="fa-solid fa-desktop"></i>
                    </button>
                </div>

            </div>

        </header>

        <!-- S·ª¨A ƒê·ªîI: C√°c view ch√≠nh s·∫Ω l√† .main-content -->
        <div id="trips-view" class="main-content" style="display: block;">

            <div class="card" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;">
                <form id="join-trip-form" class="form-group-inline" style="margin: 0;">
                    <div style="position: relative; width: 100%;">
                        <input type="text" id="join-code" placeholder="Nh·∫≠p m√£ m·ªùi tham gia..."
                            style="margin: 0; padding-right: 50px;">
                        <button type="submit" class="icon-btn"
                            style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); width: 36px; height: 36px; background: var(--primary-color); color: white;">
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                </form>

                <div
                    style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--glass-border); padding-top: 15px;">
                    <h2 style="margin: 0; font-size: 1.1rem;">Danh s√°ch chuy·∫øn ƒëi</h2>
                    <button type="button" class="small"
                        onclick="document.getElementById('create-trip-modal').style.display='flex'">
                        <i class="fa-solid fa-plus"></i> T·∫°o m·ªõi
                    </button>
                </div>
            </div>

            <div id="trips-list">
                <div style="text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.9rem;">
                    Ch∆∞a c√≥ chuy·∫øn ƒëi n√†o.
                </div>
            </div>

            <div id="create-trip-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">T·∫°o chuy·∫øn ƒëi m·ªõi</h3>
                        <button type="button" class="icon-btn secondary"
                            onclick="document.getElementById('account-modal').style.display='none'">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>

                    <form id="create-trip-form">
                        <div class="form-group">
                            <label for="trip-name">T√™n chuy·∫øn ƒëi</label>
                            <input type="text" id="trip-name" placeholder="Vd: ƒê√† L·∫°t 2025" required>
                        </div>

                        <div class="form-group">
                            <label for="trip-description">M√¥ t·∫£ ng·∫Øn</label>
                            <textarea id="trip-description" rows="2" placeholder="Ghi ch√∫ th√™m..."
                                style="resize: none;"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="trip-max-people">S·ªë ng∆∞·ªùi t·ªëi ƒëa</label>
                            <input type="number" id="trip-max-people" min="1" value="10" required>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="secondary"
                                onclick="document.getElementById('create-trip-modal').style.display='none'">H·ªßy</button>
                            <button type="submit">Ho√†n t·∫•t</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <div id="single-trip-view" class="main-content" style="display: none;">

            <div id="trip-header-container" style="margin-bottom: 15px;">

                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">

                    <button id="back-to-trips" class="secondary small" style="width: auto; padding-right: 15px;">
                        <i class="fa-solid fa-arrow-left"></i> Quay l·∫°i
                    </button>

                    <button id="toggle-info-btn" class="secondary small" style="width: auto; padding-right: 15px;"
                        title="·∫®n/Hi·ªán th√¥ng tin">
                        <i class="fa-solid fa-chevron-up"></i>
                    </button>

                </div>

                <div id="trip-info-content" style="display: none; transition: all 0.3s ease;">

                    <div id="trip-controls" class="card" style="padding: 12px;">
                    </div>

                </div>

            </div>

            <!-- C√°c tab content -->
            <div id="input-tab" class="tab-content">
                <h3>Th√™m ƒë·ªãa ƒëi·ªÉm m·ªõi</h3>
                <form id="add-location-form" class="card">
                    <div class="form-group">
                        <label for="location-name">T√™n ƒë·ªãa ƒëi·ªÉm:</label>
                        <input type="text" id="location-name" required>
                    </div>
                    <div class="form-group">
                        <label for="location-address">ƒê·ªãa ch·ªâ (t·ª± ƒë·ªông t√¨m ki·∫øm):</label>
                        <input type="text" id="location-address" placeholder="VD: Qu·∫≠n 1, TPHCM" autocomplete="off">
                        <input type="hidden" id="location-position">
                    </div>

                    <div id="map-search-results"></div>

                    <div class="form-group">
                        <div class="map-wrapper"
                            style="position: relative; height: 300px; border-radius: 12px; overflow: hidden; border: 1px solid var(--glass-border);">

                            <div id="map-container" style="width: 100%; height: 100%; z-index: 0;"></div>

                            <div class="map-controls-overlay">
                                <div class="map-mode-group">
                                    <button type="button" id="map-mode-default" class="map-btn" title="M·∫∑c ƒë·ªãnh"><i
                                            class="fa-solid fa-map"></i></button>
                                    <button type="button" id="map-mode-satellite" class="map-btn" title="V·ªá tinh"><i
                                            class="fa-solid fa-satellite"></i></button>
                                    <button type="button" id="map-mode-dark" class="map-btn active" title="T·ªëi"><i
                                            class="fa-solid fa-moon"></i></button>
                                </div>
                                <button type="button" id="get-location-button" class="map-btn location-btn"
                                    title="V·ªã tr√≠ c·ªßa t√¥i">
                                    <i class="fa-solid fa-location-crosshairs"></i>
                                </button>
                            </div>

                            <div class="map-watermark">Design by HunqD</div>

                        </div>
                    </div>

                    <div class="form-group">
                        <label for="location-people">S·ªë ng∆∞·ªùi:</label>
                        <div class="form-group-inline">
                            <button type="button" id="people-decrease" class="secondary" style="width: auto;">-</button>
                            <input type="number" id="location-people" value="1" min="1" style="text-align: center;">
                            <button type="button" id="people-increase" class="secondary" style="width: auto;">+</button>
                            <button type="button" id="people-max" class="secondary"
                                style="width: auto; padding: 12px 8px; font-size: 0.9rem;">Max</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="location-cost">T·ªïng ti·ªÅn (VNƒê):</label>
                        <input type="text" id="location-cost" placeholder="100000" inputmode="numeric">
                    </div>

                    <div class="form-group">
                        <label for="location-time">Th·ªùi gian & Ng√†y:</label>
                        <div class="form-group-inline">
                            <button type="button" id="get-current-time-button" class="secondary" style="width: auto;"><i
                                    class="fa-solid fa-clock"></i></button>
                            <input type="text" id="location-time" placeholder="HHMM (19:30)" inputmode="numeric">
                            <input type="text" id="location-date" placeholder="DDMM (25/12)" inputmode="numeric">

                        </div>

                    </div>

                    <div class="form-group">
                        <label>ƒê√°nh gi√°:</label>

                        <div class="star-rating">
                            <i class="fa-solid fa-star" data-value="1"></i>
                            <i class="fa-solid fa-star" data-value="2"></i>
                            <i class="fa-solid fa-star" data-value="3"></i>
                            <i class="fa-solid fa-star" data-value="4"></i>
                            <i class="fa-solid fa-star" data-value="5"></i>
                        </div>

                        <input type="hidden" id="location-rating" name="location-rating" value="5">
                    </div>

                    <div class="form-group">
                        <label for="location-notes">Ghi ch√∫:</label>
                        <textarea id="location-notes" rows="3"></textarea>
                    </div>

                    <button type="submit" class="w-full"><i class="fa-solid fa-check"></i> X√°c nh·∫≠n Th√™m</button>
                </form>
            </div>

            <div id="history-tab" class="tab-content" style="display: none;">
                <h3>L·ªãch s·ª≠ chuy·∫øn ƒëi</h3>
                <div class="card filters" style="padding: 12px; gap: 10px;">

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">

                        <div style="position: relative; flex: 1; min-width: 200px;">
                            <i class="fa-solid fa-magnifying-glass"
                                style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); pointer-events: none;"></i>
                            <input type="text" id="search-history" placeholder="T√¨m theo t√™n, ƒë·ªãa ch·ªâ..."
                                style="margin: 0; padding-left: 36px;">
                        </div>

                        <div style="flex: 1 1 auto;">
                            <select id="sort-history" style="margin: 0; min-width: 140px;">
                                <option value="time">üìÖ M·ªõi nh·∫•t</option>
                                <option value="name">üî§ T√™n (A-Z)</option>
                                <option value="cost">üí∞ Ti·ªÅn (Cao-Th·∫•p)</option>
                            </select>
                        </div>
                    </div>

                    <div class="export-buttons" style="padding-top: 5px; border-top: 1px solid var(--glass-border);">
                        <button id="export-txt" class="secondary small" title="Xu·∫•t file TXT">
                            <i class="fa-solid fa-file-lines"></i> TXT
                        </button>
                        <button id="export-json" class="secondary small" title="Xu·∫•t file JSON">
                            <i class="fa-solid fa-file-code"></i> JSON
                        </button>
                        <button id="export-xlsx" class="secondary small" title="Xu·∫•t file Excel">
                            <i class="fa-solid fa-file-excel"></i> Excel
                        </button>
                        <button id="copy-history" class="secondary small" title="Sao ch√©p to√†n b·ªô">
                            <i class="fa-solid fa-clipboard"></i> Copy
                        </button>
                    </div>
                </div>
                <div id="history-list">
                </div>
            </div>


            <!-- 2. KHUNG CHAT POPUP (·∫®n m·∫∑c ƒë·ªãnh) -->

            <div id="chat-tab" style="
    display: none; 
    position: fixed; 
    bottom: 100px; 
    right: 20px; 
    width: 90%; 
    max-width: 400px; 
    height: 60vh; 
    max-height: 600px; 
    
    /* S·ª¨ D·ª§NG BI·∫æN CSS CHU·∫®N THEME */
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    -webkit-backdrop-filter: blur(var(--blur-strength));
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--glass-shadow);
    
    z-index: 1500; 
    flex-direction: column; 
    overflow: hidden; 
    transform-origin: right bottom; 
    animation: popupScale 0.3s cubic-bezier(0.16, 1, 0.3, 1);
">

                <div style="
        padding: 15px; 
        /* Vi·ªÅn v√† n·ªÅn d√πng bi·∫øn */
        border-bottom: 1px solid var(--glass-border); 
        background: var(--secondary-bg); /* N·ªÅn m·ªù nh·∫π ph√¢n c√°ch */
        display: flex; 
        justify-content: space-between; 
        align-items: center;
    ">
                    <h3 style="margin: 0; font-size: 1.1rem; color: var(--primary-color);">
                        <i class="fa-solid fa-comments" style="margin-right: 8px;"></i>Tr√≤ chuy·ªán nh√≥m
                    </h3>
                    <button onclick="toggleChatPopup()" style="
            background: transparent; 
            border: none; 
            color: var(--text-muted); 
            font-size: 1.2rem; 
            padding: 5px; 
            width: auto; 
            box-shadow: none;
            cursor: pointer;
        ">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <div id="chat-messages" style="
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding-bottom: 80px; 
        scroll-behavior: smooth;
    ">
                    <div class="my-message">
                        <img src="https://graph.facebook.com/100045640179308/picture?width=9999&amp;access_token=6628568379|c1e620fa708a1d5696fb991c1bde5662"
                            class="chat-avatar">
                        <div class="message-content" style="position: relative; min-width: 100px; max-width: 75%;">
                            <strong
                                style="display: block; font-size: 0.7rem; opacity: 0.6; margin-bottom: 4px;">HunqD</strong>
                            <p style="margin: 0; line-height: 1.5;">ch√†o</p>
                            <button type="button" class="icon-btn" id="del-sample"
                                style="width: 20px; height: 20px; font-size: 0.7rem; margin-top: 4px; opacity: 0.3; margin-left: auto; display: block; transition: opacity 0.2s;"
                                onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.3"
                                title="X√≥a tin nh·∫Øn">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <form id="chat-form" style="
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        
        /* Style K√≠nh cho Input Bar */
        background: var(--glass-bg);
        backdrop-filter: blur(var(--blur-strength));
        border: 1px solid var(--glass-border);
        border-radius: 30px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        
        display: flex;
        align-items: center;
        padding: 4px;
        gap: 8px;
    ">
                    <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" style="
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            padding: 0 10px 0 15px;
            height: 40px;
            font-size: 0.95rem;
            color: var(--text-color);
        ">

                    <button type="submit" class="icon-btn" style="
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        ">
                        <i class="fa-solid fa-paper-plane" style="font-size: 0.9rem;"></i>
                    </button>
                </form>
            </div>



            <div id="stats-tab" class="tab-content" style="display: none;">
                <div id="stats-content" class="card">
                    <!-- Th·ªëng k√™ render v√†o ƒë√¢y -->
                </div>
            </div>

            <!-- <div id="cloud-tab" class="tab-content" style="display: none;">
               <h1>Cloud</h1>
            </div> -->


            <!-- S·ª¨A ƒê·ªîI: Nav bar -->
            <nav>
                <button class="tab-button" data-tab="input-tab">
                    <i class="fa-solid fa-map-location-dot"></i>

                </button>
                <button class="tab-button" data-tab="history-tab">
                    <i class="fa-solid fa-list-ul"></i>

                </button>
                <button class="tab-button" data-tab="stats-tab">
                    <i class="fa-solid fa-chart-pie"></i>

                </button>
                <!-- <button class="tab-button" data-tab="cloud-tab">
                    <i class="fa-solid fa-cloud"></i>

                </button> -->
                
                <button class="chat-button" id="chat-trigger-btn" onclick="toggleChatPopup()">
                    <i class="fa-solid fa-comments"></i>

                </button>

            </nav>

        </div>


    </div>

    <!-- S·ª¨A ƒê·ªîI: Modals -->
    <div id="edit-trip-modal" class="modal">
        <div class="modal-content">
            <h3>S·ª≠a th√¥ng tin chuy·∫øn ƒëi</h3>
            <form id="edit-trip-form">
                <div class="form-group">
                    <label for="edit-trip-name">T√™n chuy·∫øn ƒëi:</label>
                    <input type="text" id="edit-trip-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-trip-description">M√¥ t·∫£:</label>
                    <input type="text" id="edit-trip-description">
                </div>
                <div class="form-group">
                    <label for="edit-trip-max-people">S·ªë ng∆∞·ªùi:</label>
                    <input type="number" id="edit-trip-max-people" min="1" required>
                </div>
                <button type="submit">L∆∞u thay ƒë·ªïi</button>
                <button type="button" id="close-edit-trip-modal" class="secondary">ƒê√≥ng</button>
            </form>
        </div>
    </div>

    <div id="edit-location-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">S·ª≠a ƒë·ªãa ƒëi·ªÉm</h3>

                <button type="button" id="close-edit-location-modal" class="icon-btn secondary">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <form id="edit-location-form">
                <div class="form-group">
                    <label for="edit-location-name"><i class="fa-solid fa-signature"></i> T√™n ƒë·ªãa ƒëi·ªÉm</label>
                    <input type="text" id="edit-location-name" required placeholder="Nh·∫≠p t√™n...">
                </div>

                <div class="form-group">
                    <label for="edit-location-position"><i class="fa-solid fa-map-pin"></i> ƒê·ªãa ch·ªâ / T·ªça ƒë·ªô</label>
                    <input type="text" id="edit-location-position" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ...">
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="edit-location-people"><i class="fa-solid fa-users"></i> S·ªë ng∆∞·ªùi</label>
                        <input type="number" id="edit-location-people" value="1" min="1">
                    </div>
                    <div style="flex: 2;">
                        <label for="edit-location-cost"><i class="fa-solid fa-money-bill"></i> T·ªïng ti·ªÅn</label>
                        <input type="text" id="edit-location-cost" inputmode="numeric" data-raw="">
                    </div>
                    <div style="flex: 1;">
                        <label for="edit-location-rating"><i class="fa-solid fa-star"></i> Rating</label>
                        <select id="edit-location-rating">
                            <option value="5">5 ‚≠ê</option>
                            <option value="4">4 ‚≠ê</option>
                            <option value="3">3 ‚≠ê</option>
                            <option value="2">2 ‚≠ê</option>
                            <option value="1">1 ‚≠ê</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="edit-location-time"><i class="fa-solid fa-clock"></i> Gi·ªù</label>
                        <input type="text" id="edit-location-time" placeholder="HH:MM">
                    </div>
                    <div style="flex: 1;">
                        <label for="edit-location-date"><i class="fa-solid fa-calendar"></i> Ng√†y</label>
                        <input type="text" id="edit-location-date" placeholder="DD/MM/YYYY">
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit-location-notes"><i class="fa-solid fa-note-sticky"></i> Ghi ch√∫</label>
                    <textarea id="edit-location-notes" rows="2" style="resize: none;"
                        placeholder="Ghi ch√∫ th√™m..."></textarea>
                </div>

                <div style="margin-top: 10px;">
                    <button type="submit" style="width: 100%;">
                        <i class="fa-solid fa-floppy-disk"></i> L∆∞u thay ƒë·ªïi
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="account-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">Qu·∫£n l√Ω T√†i kho·∫£n</h3>
                <button type="button" class="icon-btn secondary"
                    onclick="document.getElementById('account-modal').style.display='none'">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <form id="update-profile-form">
                <h4 style="font-size: 0.95rem; color: var(--primary-color); margin-bottom: 10px;">Th√¥ng tin c√° nh√¢n</h4>

                <div class="form-group">
                    <label for="account-name">T√™n hi·ªÉn th·ªã:</label>
                    <input type="text" id="account-name" required placeholder="T√™n hi·ªÉn th·ªã c·ªßa b·∫°n">
                </div>

                <div class="form-group">
                    <label for="account-facebook">ID Facebook (Avatar):</label>
                    <input type="text" id="account-facebook" placeholder="Nh·∫≠p ID Facebook ƒë·ªÉ l·∫•y ·∫£nh">
                </div>

                <button type="submit" class="small">L∆∞u th√¥ng tin</button>
            </form>

            <hr style="border: none; border-top: 1px solid var(--glass-border); margin: 20px 0;">

            <form id="update-password-form">
                <h4 style="font-size: 0.95rem; color: var(--primary-color); margin-bottom: 10px;">B·∫£o m·∫≠t</h4>

                <div class="form-group">
                    <label for="account-current-pass">M·∫≠t kh·∫©u hi·ªán t·∫°i:</label>
                    <input type="password" id="account-current-pass" required>
                </div>

                <div class="form-group-inline">
                    <div style="flex: 1;">
                        <label for="account-new-pass">M·∫≠t kh·∫©u m·ªõi:</label>
                        <input type="password" id="account-new-pass" required>
                    </div>
                    <div style="flex: 1;">
                        <label for="account-confirm-pass">X√°c nh·∫≠n:</label>
                        <input type="password" id="account-confirm-pass" required>
                    </div>
                </div>

                <button type="submit" class="secondary small">ƒê·ªïi m·∫≠t kh·∫©u</button>
            </form>

            <hr style="border: none; border-top: 1px solid var(--glass-border); margin: 20px 0;">

            <button class="red" id="logout-button" style="width: 100%;">
                <i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t
            </button>
        </div>
    </div>



</body>

</html>