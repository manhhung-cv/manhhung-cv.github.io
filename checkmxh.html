
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thử nghiệm Trình phát hiện Trình duyệt</title>
    <style>
        /* CSS đơn giản để căn giữa nội dung */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            text-align: center;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 600px;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1877f2; /* Màu xanh Facebook */
            margin-bottom: 15px;
        }
        p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .note {
            font-size: 0.9rem;
            color: #666;
            background-color: #eee;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Trang Thử Nghiệm</h1>
        <p>Đây là trang web để thử nghiệm chức năng phát hiện trình duyệt trong ứng dụng.</p>
        
        <div class="note">
            <strong>Cách kiểm tra:</strong><br>
            Hãy mở liên kết đến trang này từ bên trong một ứng dụng như <strong>Facebook, Instagram, Zalo, hoặc Messenger</strong>. Nếu thành công, bạn sẽ thấy một thanh thông báo xuất hiện ở cuối màn hình.
        </div>
    </div>

    <!-- 
      PHẦN JAVASCRIPT ĐƯỢC NHÚNG TRỰC TIẾP 
      Đây chính là mã từ tệp inAppBrowserDetector.js
    -->
    <script id="in-app-browser-detector-script">
        /**
         * Tệp JavaScript này tự động phát hiện trình duyệt trong ứng dụng (In-App Browser)
         * và hiển thị một thanh thông báo ở cuối trang.
         *
         * Cách hoạt động:
         * 1. Sử dụng một biểu thức tự gọi (IIFE) để không làm ảnh hưởng đến global scope.
         * 2. Đợi sự kiện 'DOMContentLoaded' để đảm bảo DOM đã sẵn sàng.
         * 3. Kiểm tra 'navigator.userAgent' để tìm các chuỗi ký tự (strings) phổ biến
         * của các trình duyệt trong ứng dụng.
         * 4. Nếu phát hiện, một hàm sẽ tự động tạo và chèn các kiểu CSS (styles)
         * và các phần tử HTML (element) cho thanh thông báo.
         * 5. Thanh thông báo có một nút đóng (X) để người dùng có thể ẩn nó đi.
         */

        (function() {
            
            /**
             * Hàm chính để kiểm tra user agent và quyết định có hiển thị thông báo hay không.
             */
            function kiemTraTrinhDuyetTrongUngDung() {
                const ua = navigator.userAgent || navigator.vendor || window.opera;
                let tenUngDung = null;

                // Danh sách các từ khóa để phát hiện trình duyệt trong ứng dụng
                const quyTacPhatHien = {
                    'Facebook': /FBAN|FBAV/i,
                    'Messenger': /Messenger/i,
                    'Instagram': /Instagram/i,
                    'Zalo': /Zalo/i,
                    'Twitter (X)': /Twitter/i,
                    'Viber': /Viber/i,
                    'Line': /Line/i
                };

                // Lặp qua các quy tắc để xem user agent có khớp không
                for (const ungDung in quyTacPhatHien) {
                    if (quyTacPhatHien[ungDung].test(ua)) {
                        tenUngDung = ungDung;
                        break; // Dừng lại khi tìm thấy kết quả đầu tiên
                    }
                }

                // Nếu phát hiện được một ứng dụng, hãy tạo thông báo
                if (tenUngDung) {
                    taoThanhThongBao(tenUngDung);
                } else {
                    // Dùng cho mục đích gỡ lỗi: Hiển thị thông báo nếu không phát hiện
                    console.log("Không phát hiện trình duyệt trong ứng dụng.");
                    // Bạn có thể tạo một thông báo tạm thời ở đây để xác nhận script chạy
                    // taoThanhThongBao("TEST_MODE (Không phải trong ứng dụng)");
                }
            }

            /**
             * Tạo và chèn thanh thông báo vào trang.
             * @param {string} tenUngDung - Tên của ứng dụng được phát hiện (ví dụ: "Facebook").
             */
            function taoThanhThongBao(tenUngDung) {
                // Kiểm tra xem thanh thông báo đã tồn tại chưa
                if (document.getElementById('in-app-browser-alert-bar')) {
                    return;
                }

                // 1. Tạo các kiểu CSS cho thông báo
                const cssStyles = `
                    #in-app-browser-alert-bar {
                        position: fixed;
                        bottom: 0;
                        left: 0;
                        width: 100%;
                        background-color: #222; /* Màu nền tối */
                        color: #fff; /* Chữ trắng */
                        padding: 14px;
                        box-sizing: border-box;
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                        font-size: 15px;
                        line-height: 1.4;
                        z-index: 99998; /* Đảm bảo nó ở trên cùng */
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        box-shadow: 0 -2px 8px rgba(0,0,0,0.3); /* Đổ bóng nhẹ */
                        border-top: 1px solid #444;
                        transform: translateY(0);
                        transition: transform 0.3s ease-out;
                    }
                    #in-app-browser-alert-bar.hidden {
                         transform: translateY(100%);
                    }
                    #in-app-browser-alert-bar p {
                        margin: 0;
                        padding-right: 15px; /* Khoảng cách với nút đóng */
                    }
                    #in-app-browser-alert-bar p strong {
                        color: #ffd700; /* Nhấn mạnh tên ứng dụng */
                    }
                    #in-app-browser-alert-close-btn {
                        background: none;
                        border: none;
                        color: #aaa; /* Màu nút đóng */
                        font-size: 24px;
                        font-weight: bold;
                        cursor: pointer;
                        padding: 0 5px;
                        line-height: 1;
                    }
                    #in-app-browser-alert-close-btn:hover {
                        color: #fff; /* Sáng hơn khi di chuột qua */
                    }
                `;

                // Chèn CSS vào <head>
                const styleElement = document.createElement('style');
                styleElement.type = 'text/css';
                styleElement.appendChild(document.createTextNode(cssStyles));
                document.head.appendChild(styleElement);

                // 2. Tạo phần tử HTML cho thanh thông báo
                const alertBar = document.createElement('div');
                alertBar.id = 'in-app-browser-alert-bar';

                // 3. Tạo nội dung văn bản
                const message = document.createElement('p');
                message.innerHTML = `Bạn đang dùng trình duyệt của <strong>${tenUngDung}</strong>. Vui lòng bấm vào <strong>biểu tượng 3 chấm (⋮)</strong> &gt; <strong>Mở bằng trình duyệt</strong> bên ngoài để có trải nghiệm tốt nhất.`;

                // 4. Tạo nút đóng
                const closeButton = document.createElement('button');
                closeButton.id = 'in-app-browser-alert-close-btn';
                closeButton.innerHTML = '&times;'; // Ký tự 'x'
                closeButton.setAttribute('aria-label', 'Đóng thông báo');

                // 5. Thêm sự kiện click để đóng thông báo
                closeButton.onclick = function() {
                    alertBar.classList.add('hidden');
                    // Xóa hẳn khỏi DOM sau khi transition kết thúc
                    setTimeout(() => {
                        if (alertBar.parentNode) {
                            alertBar.parentNode.removeChild(alertBar);
                        }
                    }, 300); // 300ms khớp với thời gian transition
                };

                // 6. Gắn các phần tử lại với nhau và thêm vào <body>
                alertBar.appendChild(message);
                alertBar.appendChild(closeButton);
                document.body.appendChild(alertBar);
            }

            // 7. Chạy hàm kiểm tra khi DOM đã tải xong
            // Điều này đảm bảo rằng `document.body` đã tồn tại
            if (document.readyState === 'loading') {
                // Vẫn đang tải, đợi sự kiện
                document.addEventListener('DOMContentLoaded', kiemTraTrinhDuyetTrongUngDung);
            } else {
                // Đã tải xong, chạy ngay
                kiemTraTrinhDuyetTrongUngDung();
            }

        })();
    </script>
</body>
</html>

