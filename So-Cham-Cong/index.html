<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sổ Chấm Công</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://kit.fontawesome.com/9392097706.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="logo.png" />
    <link rel="apple-touch-icon" href="logo.png" sizes="150x150" />

    <meta property="og:image" content="/Asset/Banner/Banner.png" />
    <meta property="og:title" content="Sổ chấm công" />
    <meta property="og:description" content="Thiết kế và lập trình Đinh Mạnh Hùng" />

</head>

<body class="platform-mobile">
    <div id="appShell" class="app-shell">
        <nav class="bottom-nav">
            <button class="nav-button active" data-tab="tabLichLamViec" data-title="Lịch Làm Việc"><span class="icon"><i
                        class="fas fa-calendar-alt"></i></span><span class="label">Lịch</span></button>
            <button class="nav-button" data-tab="tabSoChamCong" data-title="Sổ Chấm Công"><span class="icon"><i
                        class="fas fa-clipboard-list"></i></span><span class="label">Sổ Công</span></button>
            <button class="nav-button" data-tab="tabMayTinh" data-title="Máy tính"><span class="icon"><i
                        class="fas fa-calculator"></i></span><span class="label">Máy tính</span></button>
            <button class="nav-button" data-tab="tabThongTin" data-title="Thông tin"><span class="icon"><i
                        class="fas fa-info-circle"></i></span><span class="label">Thông tin</span></button>
            <button class="nav-button" data-tab="tabCaiDat" data-title="Cài Đặt"><span class="icon"><i
                        class="fas fa-cog"></i></span><span class="label">Cài Đặt</span></button>

        </nav>


        <div class="app-content-wrapper">
            <header class="app-header">
                <h1 id="headerTitle">Lịch Làm Việc</h1>
            </header>
            <main class="app-content">
                <h1 id="appTitle">Lịch Làm Việc</h1>
                <div id="tabLichLamViec" class="tab-content active">

                    <div class="card">
                        <div class="flex">

                            <div class="calendar-controls-header">
                                <button id="prevMonthBtn" class="btn-icon" aria-label="Tháng trước"><i
                                        class="fas fa-chevron-left"></i></button>
                                <h2 id="currentMonthYear">...</h2>
                                <button id="nextMonthBtn" class="btn-icon" aria-label="Tháng sau"><i
                                        class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="form-group">
                                <button id="toggleFirstDayBtn" class="btn btn-secondary btn-full-width"><span
                                        id="firstDayLabel">T2</span></button>
                            </div>
                            <div id="editScheduleBtnContainer">
                                <button id="editScheduleBtn" class="btn btn-secondary btn-full-width"><i
                                        class="fas fa-edit"></i></button>
                                <button id="saveScheduleBtn" class="btn btn-primary btn-full-width"
                                    style="display:none;"><i class="fas fa-check"></i></button>
                            </div>
                        </div>

                        <div id="monthYearPickerModal" class="modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3>Chọn Tháng & Năm</h3>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="selectMonth">Tháng:</label>
                                        <select id="selectMonth"></select>
                                    </div>
                                    <div class="form-group">
                                        <label for="selectYear">Năm:</label>
                                        <select id="selectYear"></select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-cancel">Hủy</button>
                                    <button type="button" class="btn btn-confirm-month-year btn-primary">Xác
                                        nhận</button>
                                </div>
                            </div>
                        </div>

                        <div id="quickEditControls" style="display:none;">
                            <div class="card">
                                <h3 class="card-header">Sửa Lịch Nhanh</h3>
                                <div class="form-group">
                                    <label for="quickEditType">Chọn loại ca:</label>
                                    <select id="quickEditType">
                                        <option value="">Xoá lịch</option>
                                        <option value="ca-ngay">Ca sáng</option>
                                        <option value="ca-dem">Ca tối</option>
                                        <option value="nghi">Nghỉ</option>
                                        <option value="ngay-le">Ngày lễ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="quickEditMode">Chế độ chọn:</label>
                                    <select id="quickEditMode">
                                        <option value="range">Chọn khoảng ngày</option>
                                        <option value="drag">Kéo thả trên lịch</option>
                                    </select>
                                </div>
                                <div id="dateRangeInputs">
                                    <div class="form-group">
                                        <label for="quickStartDate">Từ ngày:</label>
                                        <input type="date" id="quickStartDate">
                                    </div>
                                    <div class="form-group">
                                        <label for="quickEndDate">Đến ngày:</label>
                                        <input type="date" id="quickEndDate">
                                    </div>
                                    <button id="applyQuickEditBtn" class="btn btn-primary btn-full-width">
                                        <i class="fas fa-magic"></i> Áp dụng cho khoảng ngày
                                    </button>
                                </div>
                                <div id="dragModeInstructions" style="display:none;">
                                    <p
                                        style="color: var(--text-secondary); font-size: 14px; text-align: center; padding: 12px;">
                                        <i class="fas fa-hand-pointer"></i> Nhấn và kéo trên lịch để chọn nhiều ngày
                                    </p>
                                </div>
                            </div>
                        </div>

                        <table class="calendar-table">
                            <thead>
                                <tr id="calendarHeaderRow"></tr>
                            </thead>
                            <tbody id="calendarDays"></tbody>
                        </table>
                    </div>
                </div>
                <div id="tabSoChamCong" class="tab-content">
                    <div class="card dashboard-header-controls">
                        <button id="prevMonthStatsBtn" class="btn-icon" aria-label="Tháng trước"><i
                                class="fas fa-chevron-left"></i></button>
                        <h2 id="currentMonthStatsYear">Tháng X, Năm Y</h2>
                        <button id="nextMonthStatsBtn" class="btn-icon" aria-label="Tháng sau"><i
                                class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="card" id="statsCard">
                        <h3 class="card-header">Thống Kê Kỳ</h3> <div class="stats-grid">
                            <div class="stat-item"><span class="stat-label">Lịch làm:</span><span class="stat-value"
                                    id="statsTotalWorkDays">...</span></div>
                            <div class="stat-item"><span class="stat-label">Đã làm:</span><span class="stat-value"
                                    id="statsActualWorkDays">...</span></div>
                            <div class="stat-item"><span class="stat-label">Ngày nghỉ:</span><span class="stat-value"
                                    id="statsLeaveDays">...</span></div>
                            <div class="stat-item"><span class="stat-label">Giờ làm:</span><span class="stat-value"
                                    id="statsTotalHours">...</span></div>
                            <div class="stat-item"><span class="stat-label">Tăng ca:</span><span class="stat-value"
                                    id="statsOvertimeHours">...</span></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">Bộ lọc</div>
                        <div class="filter-group">
                            <div class="form-group"><label for="logFilterType">Lọc theo:</label>
                                <select id="logFilterType">
                                    <option value="all">Tất cả (trong kỳ)</option>
                                    <option value="range">Khoảng ngày</option>
                                    <option value="all_time">Toàn bộ lịch sử</option>
                                </select>
                            </div>
                            <div class="form-group" id="logDateRangePicker" style="display:none;"><label
                                    for="logStartDate">Từ ngày:</label><input type="date" id="logStartDate"><label
                                    for="logEndDate" style="margin-top: 10px;">Đến ngày:</label><input type="date"
                                    id="logEndDate"></div>
                            </div>
                        <div class="button-group">
                            <button id="applyLogFilterBtn" class="btn btn-secondary"><i class="fas fa-filter"></i> Áp
                                dụng</button>
                            <button id="exportLogCsvBtn" class="btn btn-primary"><i class="fas fa-file-csv"></i> Tải
                                CSV</button>
                        </div>
                    </div>
                    <div class="card">
                        <table class="timesheet-log-table">
                            <tbody id="timesheetLogBody"></tbody>
                        </table>
                        <p id="noTimesheetDataMsg" class="no-timesheet-data" style="display:none;">Chưa có dữ liệu.</p>
                    </div>
                </div>

                <div id="tabMayTinh" class="tab-content">
    <div class="card dashboard-header-controls">
        <button id="prevMonthCalcBtn" class="btn-icon"><i class="fas fa-chevron-left"></i></button>
        <h2 id="currentMonthCalcYear">Tháng X, Năm Y</h2>
        <button id="nextMonthCalcBtn" class="btn-icon"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="dashboard-grid-calc">
        <div class="calc-column">
            <div class="card card-input">
                <h3 class="card-header"><i class="fas fa-cog"></i> Cấu Hình Lương</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Lương/Giờ (Cơ bản):</label>
                        <input type="number" id="luongGio" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Lương/Giờ (Tăng ca):</label>
                        <input type="number" id="luongGioTangCa" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Lương/Giờ (Ngày lễ):</label>
                        <input type="number" id="luongGioNgayLe" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Phụ phí (Trợ cấp)/Ngày:</label>
                        <input type="number" id="troCapNgay" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Phụ phí (Trợ cấp)/Tháng:</label>
                        <input type="number" id="troCapThang" class="form-control" placeholder="0">
                    </div>
                </div>
            </div>

            <div class="card card-input">
                <div class="card-header-flex">
                    <h3><i class="fas fa-shield-alt"></i> Bảo Hiểm & Thuế</h3>
                    <button class="btn-small" onclick="addDynamicItem('insurance')"><i class="fas fa-plus"></i> Thêm</button>
                </div>
                <div id="insurance-list" class="dynamic-list">
                    </div>
                <div class="sub-total">Tổng khấu trừ: <span id="total-insurance">0</span></div>
            </div>

            <div class="card card-input">
                <div class="card-header-flex">
                    <h3><i class="fas fa-wallet"></i> Chi Phí Cá Nhân</h3>
                    <button class="btn-small" onclick="addDynamicItem('expense')"><i class="fas fa-plus"></i> Thêm</button>
                </div>
                <div id="expense-list" class="dynamic-list">
                    </div>
                <div class="sub-total">Tổng chi: <span id="total-expense">0</span></div>
            </div>
        </div>

        <div class="calc-column">
            <div class="card card-summary">
                <h3 class="card-header"><i class="fas fa-calculator"></i> Bảng Lương Chi Tiết</h3>
                
                <div class="summary-section">
                    <h4>Thu Nhập</h4>
                    <div class="stat-item"><span>Lương cơ bản:</span><span id="out-basic-salary">0</span></div>
                    <div class="stat-item"><span>Lương tăng ca:</span><span id="out-ot-salary">0</span></div>
                    <div class="stat-item"><span>Lương ngày lễ:</span><span id="out-holiday-salary">0</span></div>
                    <div class="stat-item"><span>Tổng trợ cấp:</span><span id="out-allowance">0</span></div>
                    <div class="stat-item highlight"><span>TỔNG THU NHẬP:</span><span id="out-gross-income" class="text-green">0</span></div>
                </div>

                <div class="summary-section">
                    <h4>Tổng Kết</h4>
                    <div class="stat-item"><span>(-) Bảo hiểm & Thuế:</span><span id="out-total-deduct" class="text-red">0</span></div>
                    <div class="stat-item"><span>Thực nhận (Về túi):</span><span id="out-net-salary" class="text-blue bold">0</span></div>
                    <div class="stat-item"><span>(-) Chi phí sinh hoạt:</span><span id="out-total-expense" class="text-orange">0</span></div>
                    <div class="stat-item highlight-big"><span>DƯ CÒN LẠI:</span><span id="out-final-balance">0</span></div>
                </div>
                
                <button id="saveHistoryBtn" class="btn btn-primary btn-full-width"><i class="fas fa-save"></i> Lưu Vào Lịch Sử</button>
            </div>

            <div class="card card-history">
                <h3 class="card-header"><i class="fas fa-history"></i> Lịch Sử Đã Lưu</h3>
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Tháng</th>
                                <th>Thu Nhập</th>
                                <th>Dư</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="salary-history-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
                <div id="tabThongTin" class="tab-content">
                    <div class="card">
                        <h3 class="card-header">Chào mừng đến với Sổ Chấm Công!</h3>
                        <p>Ứng dụng này giúp bạn quản lý lịch làm việc và chấm công cá nhân một cách dễ dàng và trực
                            quan.</p>
                    </div>

                    </div>

                <div id="tabCaiDat" class="tab-content">
                    <div class="card">
                        <h3 class="card-header">Giao diện</h3>
                        <div class="form-group"><label for="themeSelector">Chọn chủ đề:</label><select
                                id="themeSelector">
                                <option value="default">Sáng</option>
                                <option value="dark">Tối</option>
                                <option value="cute">Dễ Thương</option>
                                <option value="doraemon">Doraemon</option>

                            </select></div>
                    </div>

                    <div class="card">
                        <h3 class="card-header">Ngày bắt đầu công</h3>
                        <div class="form-group">
                            <label for="startWorkDayInput">Ngày bắt đầu tính công hàng tháng:</label>
                            <input type="number" id="startWorkDayInput" min="1" max="31" value="1">
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Chế độ hiển thị lịch</h3>
                        <div class="form-group">
                            <label for="displayModeSelect">Chọn chế độ:</label>
                            <select id="displayModeSelect">
                                <option value="fullMonth">Hiển thị toàn bộ tháng</option>
                                <option value="workPeriod">Hiển thị theo chu kỳ công</option>
                            </select>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Tiền tệ</h3>
                        <div class="form-group">
                            <label for="currencySelector">Chọn loại tiền:</label>
                            <select id="currencySelector">
                                <option value="VND">VND đ</option>
                                <option value="JPY">JPY ¥</option>
                                <option value="USD">USD $</option>
                                <option value="EUR">EUR €</option>
                            </select>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Dữ liệu cơ bản</h3>
                        <div class="form-group">
                            <label for="baseHoursInput">Số giờ làm cơ bản / ngày</label>
                            <input type="number" id="baseHoursInput" min="1" max="24" value="8">
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Sao Lưu & Khôi Phục (Firebase)</h3>

                        <div id="authSection">
                            <div id="userInfo" style="display: none; align-items: center; justify-content: center; margin-bottom: 15px; gap: 10px;">
                                <img id="userPhoto" src="" alt="Ảnh đại diện" style="width: 30px; height: 30px; border-radius: 50%;">
                                <span id="userStatus" style="color: var(--text-secondary);"></span>
                            </div>
                            <p id="notLoggedInStatus" style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">Đang kiểm tra trạng thái đăng nhập...</p>
                            <div class="button-group">
                                 <button id="loginBtn" class="btn btn-primary" style="display: none;"><i class="fab fa-google"></i> Đăng nhập bằng Google</button>
                                 <button id="logoutBtn" class="btn btn-secondary" style="display: none;"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                            </div>
                        </div>

                        <div id="backupRestoreSection" style="display: none; margin-top: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <label for="autoBackupSwitch" style="margin-bottom: 0;">Tự động sao lưu:</label>
                                <label class="switch">
                                    <input type="checkbox" id="autoBackupSwitch">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="button-group">
                                <button id="manualBackupBtn" class="btn btn-secondary"><i class="fas fa-cloud-upload-alt"></i> Sao lưu thủ công</button>
                            </div>

                            <h4 style="margin-top: 20px; margin-bottom: 10px; font-weight: 600;">Các bản sao lưu:</h4>
                            <ul id="backupList" style="list-style: none; padding: 0; max-height: 200px; overflow-y: auto; border: 1px solid var(--separator-color); border-radius: var(--radius-m);">
                                <li id="noBackups" style="padding: 15px; text-align: center; color: var(--text-secondary);">Chưa có bản sao lưu nào.</li>
                                </ul>
                            <p style="font-size:13px; color:var(--text-secondary); margin-top:10px;">Nhấn vào bản sao lưu để khôi phục hoặc xoá.</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Chế độ Offline</h3>
                        <p style="font-size:14px; color:var(--text-secondary); margin-bottom:15px;">
                            Ứng dụng lưu trữ dữ liệu offline để chạy nhanh hơn và không cần mạng. Bạn có thể xóa dữ liệu này hoặc tắt hoàn toàn chế độ offline.
                        </p>
                        <div class="button-group">
                            <button id="clearOfflineCacheBtn" class="btn btn-secondary">
                                <i class="fas fa-broom"></i> Xóa Cache Offline
                            </button>
                            <button id="unregisterSwBtn" class="btn btn-danger">
                                <i class="fas fa-power-off"></i> Tắt Offline
                            </button>
                        </div>
                         <p style="font-size:13px; color:var(--text-secondary); margin-top:10px;">Lưu ý: Tắt offline có thể yêu cầu tải lại trang.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-header">Xuất dữ liệu</h3>
                        <div class="form-group"><label for="exportDataType">Loại dữ liệu xuất:</label><select
                                id="exportDataType">
                                <option value="all">Toàn bộ</option>
                                <option value="schedule">Chỉ Lịch</option>
                                <option value="timesheet">Chỉ Chấm Công</option>
                            </select></div>
                        <div class="button-group"><button id="exportDataBtn" class="btn btn-secondary"><i
                                    class="fas fa-file-export"></i> Xuất File JSON</button></div>
                    </div>
                    <div class="card">
                        <h3 class="card-header">Nhập dữ liệu</h3>
                        <div class="form-group"><label for="importFile">Nhập từ file JSON:</label><input type="file"
                                id="importFile" accept=".json"
                                style="padding: 10px; border: 1px solid var(--separator-color); border-radius: var(--radius-m); background: var(--input-bg);">
                        </div>
                        <div class="button-group"><button id="importDataBtn" class="btn btn-primary"><i
                                    class="fas fa-file-import"></i> Nhập Dữ Liệu</button></div>
                        <p style="font-size:13px; color:var(--text-secondary); margin-top:16px;">Lưu ý: Dữ liệu nhập
                            sẽ
                            ghi đè.</p>
                    </div>

                    <div class="">
                        <p>Design by HunqD with Love ❤️</p>
                        <p>Phiên bản: 1.2.0</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="timesheetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Chấm công</h3>
            </div>
            <div class="modal-body">
                <form id="timesheetForm">
                    <input type="hidden" id="timesheetDate">
                    <div class="form-group">
                        <label for="entryType">Loại ngày công</label>
                        <select id="entryType">
                            <option value="work">Ngày làm</option>
                            <option value="holiday_work">Nghỉ (làm thêm giờ)</option>
                            <option value="paid_leave">Nghỉ phép</option>
                            <option value="unpaid_leave">Nghỉ không lương</option>
                            <option value="company_holiday">Công ty cho nghỉ</option>
                        </select>
                    </div>
                    <div id="overtimeFields" style="display: none;">
                        <div class="form-group"><label for="overtimeHours">Giờ tăng ca:</label><input type="number"
                                id="overtimeHours" min="0" max="23" placeholder="0"></div>
                        <div class="form-group"><label for="overtimeMinutes">Phút tăng ca:</label><input type="number"
                                id="overtimeMinutes" min="0" max="59" placeholder="0"></div>
                    </div>
                    <div class="form-group"><label for="notes">Ghi chú:</label><textarea id="notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel">Hủy</button>
                <button type="button" class="btn btn-confirm btn-primary">Xác nhận</button>
            </div>
        </div>
    </div>
    <div id="actionConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="actionConfirmModalTitle">Hành động</h3>
            </div>
            <div class="modal-body">
                <p>Bạn muốn làm gì với mục chấm công này?</p>
                <input type="hidden" id="actionConfirmDate">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-edit-timesheet"><i class="fas fa-pencil-alt"></i> Sửa</button>
                <button type="button" class="btn btn-danger btn-delete-timesheet"><i class="fas fa-trash-alt"></i>
                    Xoá</button>
            </div>
        </div>
    </div>

    <div id="backupNameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3>Đặt tên bản sao lưu</h3></div>
            <div class="modal-body">
                <p>Nhập tên gợi nhớ cho bản sao lưu này:</p>
                <input type="text" id="backupNameInput" placeholder="Ví dụ: Trước khi đổi lịch tháng 11" style="margin-top: 10px;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel">Hủy</button>
                <button type="button" id="confirmBackupNameBtn" class="btn btn-primary">Xác nhận</button>
            </div>
        </div>
    </div>

    <div id="confirmActionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="confirmActionTitle">Xác nhận</h3></div>
            <div class="modal-body">
                <p id="confirmActionMessage">Bạn có chắc chắn muốn thực hiện hành động này?</p>
                <input type="hidden" id="confirmActionBackupId">
                 <input type="hidden" id="confirmActionType"> </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel">Hủy</button>
                <button type="button" id="confirmActionButton" class="btn btn-danger">Xác nhận</button> </div>
        </div>
    </div>

</body>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBqvMFGgyuhN3P0W0vRHQub4IW0MNkSsO8",
  authDomain: "so-cham-cong-hunq.firebaseapp.com",
  projectId: "so-cham-cong-hunq",
  storageBucket: "so-cham-cong-hunq.firebasestorage.app",
  messagingSenderId: "984864583115",
  appId: "1:984864583115:web:d1ea07e5f75e2681cfda4e",
  measurementId: "G-9F4XKR5TS4"
};

      try {
          // Dòng này (khoảng dòng 561) cần đối tượng 'firebase' tồn tại
          firebase.initializeApp(firebaseConfig);
          window.auth = firebase.auth();
          window.db = firebase.firestore();
          window.provider = new firebase.auth.GoogleAuthProvider();
          console.log("Firebase initialized successfully.");
          window.dispatchEvent(new Event('firebaseReady'));
      } catch (e) {
          console.error("Firebase initialization failed:", e);
          window.dispatchEvent(new CustomEvent('firebaseInitFailed', { detail: e }));
          // ... xử lý lỗi hiển thị ...
      }
    </script>

    <script src="./script.js"></script>
    <script src="./calc.js"></script>
    <script src="./firebase-logic.js"></script>

    </body>
</html>