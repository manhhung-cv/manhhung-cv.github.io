<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Pro - Full System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                        slate: { 850: '#172033' }
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(59, 130, 246, 0.5)',
                        'card': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'float': '0 10px 30px -5px rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .glass-dark {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .card-icon-bg {
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 5rem;
            opacity: 0.08;
            transform: rotate(-15deg);
            transition: all 0.3s;
        }

        .product-card:hover .card-icon-bg {
            transform: rotate(0deg) scale(1.1);
            opacity: 0.12;
        }

        #resize-handle {
            transition: background-color 0.2s;
        }

        #resize-handle:hover,
        #resize-handle.resizing {
            background-color: #3b82f6;
            cursor: col-resize;
        }
    </style>
</head>

<body class="bg-[#f3f4f6] text-slate-800 h-screen overflow-hidden flex flex-col">

    <!-- HEADER (z-40) -->
    <header
        class="glass-dark text-slate-300 h-16 flex items-center justify-between px-6 shadow-lg z-40 shrink-0 border-b border-slate-700/50">
        <div class="flex items-center gap-3 mr-8 shrink-0">

            <div
                class="bg-gradient-to-br from-blue-500 to-blue-700 text-white w-9 h-9 rounded-xl flex items-center justify-center shadow-glow">
                <i class="fa-solid fa-layer-group text-lg"></i>
            </div>
            <span class="font-bold text-white text-lg tracking-tight hidden md:block">POS<span
                    class="font-light text-blue-400">Pro</span></span>
        </div>


        <nav class="flex-1 flex items-center gap-2 overflow-x-auto no-scrollbar h-full px-2">
            <a href="#" onclick="switchView('pos')" id="menu-pos"
                class="nav-item active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-cash-register"></i> <span class="hidden md:inline">Bán hàng</span>
            </a>
            <a href="#" onclick="switchView('history')" id="menu-history"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-clock-rotate-left"></i> <span class="hidden md:inline">Lịch sử</span>
            </a>
            <a href="#" onclick="switchView('inventory')" id="menu-inventory"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-boxes-stacked"></i> <span class="hidden md:inline">Kho hàng</span>
            </a>
            <a href="#" onclick="switchView('customers')" id="menu-customers"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-users"></i> <span class="hidden md:inline">Khách hàng</span>
            </a>
            <a href="#" onclick="switchView('reports')" id="menu-reports"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-chart-pie"></i> <span class="hidden md:inline">Thống kê</span>
            </a>
            <a href="#" onclick="switchView('promos')" id="menu-promos"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap">
                <i class="fa-solid fa-ticket"></i> <span class="hidden md:inline">Ưu đãi</span>
            </a>
            <a href="#" onclick="switchView('print-settings')" id="menu-print-settings"
                class="nav-item px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:bg-white/10 flex items-center gap-2 whitespace-nowrap hidden">
                <i class="fa-solid fa-print"></i> <span class="hidden md:inline">Cấu hình in</span>
            </a>

        </nav>

        <div class="ml-6 hidden md:flex items-center gap-2 bg-slate-700/50 rounded-lg p-1 border border-slate-600">
            <select id="global-branch-select" onchange="switchBranch(this.value)"
                class="bg-transparent text-white text-sm font-bold outline-none cursor-pointer min-w-[120px]">
                <option value="" class="text-slate-800">Đang tải...</option>
            </select>
            <button id="btn-manage-branches" onclick="toggleBranchModal()"
                class="w-7 h-7 hidden rounded bg-slate-600 hover:bg-blue-600 text-white flex items-center justify-center transition ml-1"
                title="Quản lý chi nhánh">
                <i class="fa-solid fa-gear text-xs"></i>
            </button>
        </div>

        <div class="flex items-center gap-4 ml-4 shrink-0">
            <button onclick="handleLogout()"
                class="hidden md:flex ml-3 items-center gap-2 text-xs font-bold text-slate-400 hover:text-red-500 bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded-full border border-slate-700 transition">
                <i class="fa-solid fa-power-off"></i> <span id="user-role-display">Logout</span>
            </button>
        </div>
    </header>
    <style>
        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
        }
    </style>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex overflow-hidden relative">

        <!-- 1. VIEW: POS -->
        <main id="view-pos" class="flex-1 flex flex-col h-full bg-[#f8fafc] relative z-0 min-w-0">
            <div
                class="px-6 py-4 flex items-center justify-between shrink-0 sticky top-0 z-20 bg-white/80 backdrop-blur-md border-b border-slate-200/60">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-md group">
                        <i
                            class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition"></i>
                        <input type="text" id="pos-search-input" placeholder="Tìm kiếm món..."
                            class="w-full pl-11 pr-4 py-3 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none shadow-sm transition-all">
                    </div>
                </div>
                <button onclick="toggleAddProductModal()"
                    class="ml-4 bg-white hover:bg-blue-50 text-blue-600 border border-blue-100 hover:border-blue-200 px-4 py-2.5 rounded-xl text-sm font-bold shadow-sm transition flex items-center gap-2">
                    <i class="fa-solid fa-plus-circle text-lg"></i> <span class="hidden sm:inline">Thêm dịch vụ</span>
                </button>
            </div>
            <div class="px-6 pt-2 pb-2 shrink-0 bg-[#f8fafc]">
                <div id="pos-categories" class="flex gap-3 overflow-x-auto no-scrollbar py-2"></div>
            </div>
            <style>
                .cat-btn.active {
                    background: #1e293b;
                    color: white;
                    box-shadow: 0 4px 12px rgba(30, 41, 59, 0.3);
                    transform: translateY(-1px);
                }
            </style>
            <div id="products-grid"
                class="flex-1 p-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 overflow-y-auto content-start pb-24">
            </div>
        </main>

        <!-- 2. VIEW: INVENTORY -->
        <main id="view-inventory" class="hidden flex-1 flex flex-col h-full bg-[#f8fafc] p-6 overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Kho hàng & Sản phẩm</h2>
                    <p class="text-sm text-slate-500">Quản lý danh mục và tồn kho</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="openCategoryModal()"
                        class="px-5 py-2.5 bg-white border border-slate-200 rounded-xl font-bold text-slate-700 shadow-sm hover:bg-slate-50 flex items-center gap-2"><i
                            class="fa-solid fa-layer-group text-blue-500"></i> Danh mục</button>

                    <button onclick="exportProductsToCSV()"
                        class="px-5 py-2.5 bg-green-600/10 border border-green-200 rounded-xl font-bold text-green-700 shadow-sm hover:bg-green-100 flex items-center gap-2 transition">
                        <i class="fa-solid fa-file-csv"></i> Xuất CSV
                    </button>

                    <button onclick="document.getElementById('csv-input').click()"
                        class="px-5 py-2.5 bg-orange-600/10 border border-orange-200 rounded-xl font-bold text-orange-700 shadow-sm hover:bg-orange-100 flex items-center gap-2 transition">
                        <i class="fa-solid fa-file-import"></i> Nhập CSV
                    </button>
                    <input type="file" id="csv-input" accept=".csv" onchange="importProductsFromCSV(event)"
                        class="hidden">

                    <button onclick="deleteAllInventory()"
                        class="px-5 py-2.5 bg-red-600 text-white rounded-xl font-bold shadow-lg hover:bg-red-700 flex items-center gap-2 transition">
                        <i class="fa-solid fa-fire"></i> Xóa toàn bộ
                    </button>

                    <button onclick="openProductModal()"
                        class="px-5 py-2.5 bg-blue-600 text-white rounded-xl font-bold shadow-lg hover:bg-blue-700 flex items-center gap-2"><i
                            class="fa-solid fa-plus"></i> Thêm sản phẩm</button>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex-1 overflow-hidden flex flex-col">
                <div class="p-4 border-b border-slate-100"><input type="text" id="inv-search"
                        oninput="renderInventoryTable()" placeholder="Tìm tên sản phẩm..."
                        class="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-2 text-sm outline-none focus:border-blue-500">
                </div>
                <div class="overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Tên sản phẩm</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Danh mục</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Giá bán</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Tồn kho (CN hiện tại)</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-list" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 3. VIEW: HISTORY -->
        <main id="view-history" class="hidden flex-1 flex flex-col h-full bg-[#f8fafc] p-6 overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Lịch sử giao dịch</h2>
                    <p class="text-sm text-slate-500">Quản lý hóa đơn, xóa đơn và xuất báo cáo</p>
                </div>
                <div class="flex gap-2">
                    <button id="btn-reset-counter" onclick="resetOrderCounter()"
                        class="hidden bg-purple-100 hover:bg-purple-200 text-purple-600 border border-purple-200 px-4 py-2 rounded-xl font-bold text-sm shadow-sm flex items-center gap-2 transition">
                        <i class="fa-solid fa-rotate-right"></i> Reset Mã
                    </button>

                    <button id="btn-delete-all-history" onclick="deleteAllHistory()"
                        class="hidden bg-red-100 hover:bg-red-200 text-red-600 border border-red-200 px-4 py-2 rounded-xl font-bold text-sm shadow-sm flex items-center gap-2 transition">
                        <i class="fa-solid fa-trash-can"></i> Xóa toàn bộ
                    </button>

                    <button onclick="exportHistoryToExcel()"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-lg flex items-center gap-2 transition">
                        <i class="fa-solid fa-file-excel"></i> Xuất Excel
                    </button>
                </div>
            </div>

            <div
                class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 mb-4 flex flex-col md:flex-row gap-4 items-end md:items-center">
                <div class="flex-1 w-full">
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Tìm kiếm</label>
                    <div class="flex items-center border border-slate-200 rounded-lg px-3 py-2 bg-slate-50">
                        <i class="fa-solid fa-search text-slate-400 mr-2"></i>
                        <input type="text" id="history-search" oninput="renderHistoryTable()" placeholder="Mã đơn..."
                            class="bg-transparent outline-none text-sm w-full">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Từ ngày</label>
                    <input type="date" id="filter-date-start" onchange="renderHistoryTable()"
                        class="border border-slate-200 rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Đến ngày</label>
                    <input type="date" id="filter-date-end" onchange="renderHistoryTable()"
                        class="border border-slate-200 rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Chi nhánh</label>
                    <select id="filter-branch-history" onchange="renderHistoryTable()"
                        class="border border-slate-200 rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none focus:border-blue-500 min-w-[120px]">
                        <option value="all">Tất cả</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Thu ngân</label>
                    <select id="filter-cashier" onchange="renderHistoryTable()"
                        class="border border-slate-200 rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none focus:border-blue-500 min-w-[100px]">
                        <option value="all">Tất cả</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Trạng thái</label>
                    <select id="filter-status" onchange="renderHistoryTable()"
                        class="border border-slate-200 rounded-lg px-3 py-2 text-sm bg-slate-50 outline-none focus:border-blue-500">
                        <option value="active">Hiệu lực</option>
                        <option value="deleted">Đã xóa</option>
                    </select>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex-1 overflow-hidden flex flex-col">
                <div class="overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Mã đơn</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Thời gian</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Khách hàng</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Chi nhánh</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Thu ngân</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Tổng tiền</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="history-list" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 4. VIEW: CUSTOMERS -->
        <main id="view-customers" class="hidden flex-1 flex flex-col h-full bg-[#f8fafc] p-6 overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Khách hàng thân thiết</h2>
                    <p class="text-sm text-slate-500">Quản lý thông tin và điểm tích lũy</p>
                </div>
                <button onclick="toggleCustomerModal()"
                    class="px-5 py-2.5 bg-blue-600 text-white rounded-xl font-bold shadow-lg hover:bg-blue-700 flex items-center gap-2"><i
                        class="fa-solid fa-user-plus"></i> Thêm khách</button>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex-1 overflow-hidden flex flex-col">
                <div class="overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase">Khách hàng</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase">Liên hệ</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase">Hạng & Điểm</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase">Tổng chi</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase">Thời gian</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase w-48">Ghi chú</th>
                                    <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Hành động</th>
                                </tr>
                            </thead>
                        </thead>
                        <tbody id="customer-list" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 5. VIEW: REPORTS -->
        <main id="view-reports" class="hidden flex-1 flex-col h-full bg-[#f8fafc] p-6 overflow-y-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Báo cáo doanh thu</h2>
                    <p class="text-sm text-slate-500">Tổng quan tình hình kinh doanh</p>
                </div>

                <div
                    class="bg-white p-2 rounded-xl shadow-sm border border-slate-200 flex flex-wrap items-center gap-2">
                    <div class="flex bg-slate-100 p-1 rounded-lg">
                        <button onclick="setReportDate('today')"
                            class="report-filter-btn active px-3 py-1.5 text-xs font-bold rounded-md transition text-slate-600 hover:bg-white hover:shadow-sm">Hôm
                            nay</button>
                        <button onclick="setReportDate('yesterday')"
                            class="report-filter-btn px-3 py-1.5 text-xs font-bold rounded-md transition text-slate-600 hover:bg-white hover:shadow-sm">Hôm
                            qua</button>
                        <button onclick="setReportDate('this_month')"
                            class="report-filter-btn px-3 py-1.5 text-xs font-bold rounded-md transition text-slate-600 hover:bg-white hover:shadow-sm">Tháng
                            này</button>
                    </div>

                    <div class="h-6 w-px bg-slate-200 mx-1"></div>

                    <div class="flex items-center gap-2">
                        <input type="date" id="report-date-start"
                            class="bg-slate-50 border border-slate-200 text-xs rounded-lg px-2 py-1.5 outline-none font-medium">
                        <span class="text-slate-400 text-xs">-</span>
                        <input type="date" id="report-date-end"
                            class="bg-slate-50 border border-slate-200 text-xs rounded-lg px-2 py-1.5 outline-none font-medium">
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-slate-500 text-xs font-bold">CN:</label>
                        <select id="report-branch-select"
                            class="bg-slate-50 border border-slate-200 text-xs rounded-lg px-2 py-1.5 outline-none font-medium min-w-[100px]"
                            onchange="renderStats()">
                            <option value="all">Tất cả</option>
                        </select>
                    </div>

                    <button onclick="renderStats()"
                        class="bg-blue-600 hover:bg-blue-700 text-white w-8 h-8 rounded-lg flex items-center justify-center transition shadow-sm"
                        title="Áp dụng lọc">
                        <i class="fa-solid fa-filter text-xs"></i>
                    </button>
                </div>
            </div>

            <style>
                .report-filter-btn.active {
                    background: white;
                    color: #2563eb;
                    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
                }
            </style>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition duration-500">
                        <i class="fa-solid fa-sack-dollar text-6xl text-blue-500"></i>
                    </div>
                    <div class="text-slate-500 text-xs font-bold uppercase mb-1">Doanh thu thuần</div>
                    <div class="text-3xl font-black text-slate-800 tracking-tight" id="kpi-revenue">0 ₫</div>
                    <div class="text-xs text-emerald-500 font-bold mt-1 flex items-center gap-1">
                        <i class="fa-solid fa-circle-check"></i> Đã trừ các đơn hủy
                    </div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition duration-500">
                        <i class="fa-solid fa-receipt text-6xl text-purple-500"></i>
                    </div>
                    <div class="text-slate-500 text-xs font-bold uppercase mb-1">Tổng đơn hàng</div>
                    <div class="text-3xl font-black text-slate-800 tracking-tight" id="kpi-orders">0</div>
                    <div class="text-xs text-slate-400 font-bold mt-1">Đơn thành công</div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition duration-500">
                        <i class="fa-solid fa-chart-line text-6xl text-orange-500"></i>
                    </div>
                    <div class="text-slate-500 text-xs font-bold uppercase mb-1">Giá trị TB / Đơn</div>
                    <div class="text-3xl font-black text-slate-800 tracking-tight" id="kpi-aov">0 ₫</div>
                    <div class="text-xs text-orange-500 font-bold mt-1">AOV Metric</div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition duration-500">
                        <i class="fa-solid fa-ban text-6xl text-red-500"></i>
                    </div>
                    <div class="text-slate-500 text-xs font-bold uppercase mb-1">Đơn đã hủy</div>
                    <div class="text-3xl font-black text-slate-800 tracking-tight" id="kpi-canceled">0</div>
                    <div class="text-xs text-red-500 font-bold mt-1" id="kpi-cancel-rate">0% tổng đơn</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-column text-blue-500"></i> Biểu đồ doanh thu
                    </h3>
                    <div class="h-[300px] w-full">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-wallet text-orange-500"></i> Kênh thanh toán
                    </h3>
                    <div class="h-[200px] w-full flex items-center justify-center relative">
                        <canvas id="paymentChart"></canvas>
                    </div>
                    <div id="payment-legend" class="mt-4 space-y-2 flex-1 overflow-y-auto custom-scrollbar">
                    </div>
                </div>
            </div>

            <div
                class="bg-white rounded-2xl shadow-sm border border-slate-100 flex-1 overflow-hidden flex flex-col min-h-[300px]">
                <div class="p-5 border-b border-slate-100 flex justify-between items-center">
                    <h3 class="font-bold text-slate-700 flex items-center gap-2">
                        <i class="fa-solid fa-ranking-star text-yellow-500"></i> Top sản phẩm bán chạy
                    </h3>
                </div>
                <div class="overflow-y-auto flex-1 p-0">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 sticky top-0 z-10">
                            <tr>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase w-16">Top</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Tên sản phẩm</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Số lượng</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Doanh thu</th>
                            </tr>
                        </thead>
                        <tbody id="top-products-list" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 6. VIEW: PROMOS -->
        <main id="view-promos" class="hidden flex-1 flex flex-col h-full bg-[#f8fafc] p-6 overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Ưu đãi & Thẻ quà tặng</h2>
                    <p class="text-sm text-slate-500">Quản lý mã giảm giá và thẻ trả trước</p>
                </div>
                <button onclick="togglePromoModal()"
                    class="px-5 py-2.5 bg-orange-500 text-white rounded-xl font-bold shadow-lg hover:bg-orange-600 flex items-center gap-2"><i
                        class="fa-solid fa-plus"></i> Tạo thẻ mới</button>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex-1 overflow-hidden flex flex-col">
                <div class="overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Mã thẻ</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Loại & Giá trị</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Trạng thái</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase">Lịch sử sử dụng</th>
                                <th class="p-4 text-xs font-bold text-slate-500 uppercase text-right">Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="promo-list" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 7.VIEW: PRINT -->
        <main id="view-print-settings" class="hidden flex-1 flex flex-col h-full bg-[#f8fafc] p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-6 shrink-0">
                <div>
                    <h2 class="text-2xl font-black text-slate-800">Cấu hình mẫu in</h2>
                    <p class="text-sm text-slate-500">Tùy chỉnh hóa đơn & Xem trước trực tiếp</p>
                </div>
                <button onclick="savePrintSettings()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                    <i class="fa-solid fa-floppy-disk"></i> Lưu cấu hình
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 pb-10">

                <div class="flex flex-col gap-4">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Chọn mẫu & Công cụ</label>
                        <div class="flex gap-2">
                            <select id="print-template-select" onchange="loadTemplate(this.value)"
                                class="flex-1 p-2.5 bg-slate-50 border border-slate-200 rounded-xl font-medium outline-none focus:border-blue-500">
                                <option value="k80">Mẫu chuẩn 80mm (K80)</option>
                                <option value="k58">Mẫu nhỏ 58mm (K58)</option>
                                <option value="custom">Tự viết code (Custom HTML)</option>
                            </select>
                            <button onclick="resetTemplate()"
                                class="px-4 py-2 bg-slate-100 text-slate-600 rounded-xl font-bold hover:bg-slate-200 transition"
                                title="Khôi phục mặc định"><i class="fa-solid fa-rotate-left"></i></button>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                        <div class="bg-slate-50 p-3 border-b border-slate-100">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-xs font-bold text-slate-500 uppercase"><i
                                        class="fa-solid fa-code mr-1"></i> Mã nguồn</span>
                                <span class="text-[10px] text-slate-400 italic">Click vào thẻ để copy biến</span>
                            </div>

                            <div class="flex flex-wrap gap-2 max-h-[120px] overflow-y-auto pr-1 custom-scrollbar">
                                <span onclick="copyVar(this)" class="var-tag bg-blue-100 text-blue-700"
                                    title="Tên cửa hàng">{{shopName}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-blue-100 text-blue-700"
                                    title="Mã đơn hàng">{{orderId}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-blue-100 text-blue-700"
                                    title="Ngày">{{date}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-blue-100 text-blue-700"
                                    title="Giờ">{{time}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-blue-100 text-blue-700"
                                    title="Thu ngân">{{cashier}}</span>

                                <span onclick="copyVar(this)" class="var-tag bg-purple-100 text-purple-700"
                                    title="Tên khách">{{customer}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-purple-100 text-purple-700"
                                    title="SĐT">{{customerPhone}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-purple-100 text-purple-700"
                                    title="Điểm hiện có">{{currentPoints}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-purple-100 text-purple-700"
                                    title="Điểm tích">{{pointsEarned}}</span>

                                <span onclick="copyVar(this)" class="var-tag bg-emerald-100 text-emerald-700"
                                    title="HTML danh sách món">{{items}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-emerald-100 text-emerald-700"
                                    title="Tạm tính">{{subtotal}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-emerald-100 text-emerald-700"
                                    title="Giảm giá">{{discount}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-emerald-100 text-emerald-700"
                                    title="Tổng tiền">{{total}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-emerald-100 text-emerald-700"
                                    title="Tổng thô (cho QR)">{{rawTotal}}</span>

                                <span onclick="copyVar(this)" class="var-tag bg-orange-100 text-orange-700"
                                    title="Khách đưa">{{given}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-orange-100 text-orange-700"
                                    title="Tiền thừa">{{change}}</span>
                                <span onclick="copyVar(this)" class="var-tag bg-orange-100 text-orange-700"
                                    title="Phương thức">{{paymentMethod}}</span>
                            </div>
                        </div>

                        <textarea id="print-code-editor"
                            class="w-full min-h-[600px] p-4 font-mono text-sm bg-[#1e293b] text-emerald-400 outline-none leading-relaxed"
                            spellcheck="false" placeholder=""></textarea>
                    </div>
                </div>

                <div
                    class="h-full bg-slate-200 rounded-2xl border border-slate-300 shadow-inner flex flex-col relative overflow-hidden min-h-[750px]">
                    <div
                        class="absolute top-4 right-4 bg-black/10 px-3 py-1 rounded-full text-xs font-bold text-slate-500 uppercase z-10 pointer-events-none">
                        Live Preview
                    </div>
                    <div class="flex-1 overflow-y-auto flex justify-center p-8 custom-scrollbar">
                        <div id="print-preview-container"
                            class="bg-white shadow-2xl h-fit transition-all duration-300 origin-top">
                            <iframe id="preview-frame" class="w-full h-full border-0 bg-white min-h-[600px]"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .var-tag {
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 10px;
                    padding: 3px 8px;
                    border-radius: 6px;
                    cursor: copy;
                    transition: all 0.2s;
                    user-select: none;
                    font-weight: 700;
                    border: 1px solid transparent;
                }

                .var-tag:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
                    filter: brightness(0.95);
                    border-color: rgba(0, 0, 0, 0.1);
                }

                .var-tag:active {
                    transform: translateY(0);
                }

                /* Custom Scrollbar cho vùng Editor */
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                    height: 6px;
                }

                .custom-scrollbar::-webkit-scrollbar-track {
                    background: transparent;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #cbd5e1;
                    border-radius: 10px;
                }

                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #94a3b8;
                }
            </style>
        </main>

        <!-- SIDEBAR CART (z-30) -->
        <aside id="sidebar-cart" style="width: 420px;"
            class="bg-white shadow-2xl z-30 flex flex-col h-full border-l border-slate-100 relative shrink-0">
            <div id="resize-handle"
                class="absolute top-0 bottom-0 left-0 w-1.5 cursor-col-resize z-50 hover:bg-blue-400 opacity-0 hover:opacity-100 transition-opacity active:opacity-100 active:bg-blue-600">
            </div>

            <div
                class="bg-blue-50 p-2 flex items-center justify-between text-xs text-blue-800 border-b border-blue-100">
                <div class="flex items-center gap-2 cursor-pointer hover:underline" onclick="selectCustomerForOrder()">
                    <i class="fa-solid fa-user"></i> <span id="current-customer-name" class="font-bold">Khách lẻ</span>
                </div>
                <i class="fa-solid fa-chevron-right text-[10px]"></i>
            </div>

            <div
                class="shrink-0 bg-white border-b border-slate-100 p-2 flex items-center gap-2 overflow-x-auto no-scrollbar">
                <div id="order-tabs-container" class="flex gap-2"></div>
                <button onclick="createNewOrder()"
                    class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 flex items-center justify-center transition ml-1"><i
                        class="fa-solid fa-plus"></i></button>
            </div>

            <div
                class="p-4 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100 flex justify-between items-center">
                <div onclick="renameCurrentOrder()" class="cursor-pointer group">
                    <h3 id="current-order-name"
                        class="font-black text-lg text-slate-800 tracking-tight group-hover:text-blue-600 transition">
                        Đơn #1</h3>
                    <div class="text-xs text-slate-400 font-medium flex items-center gap-1"><i
                            class="fa-regular fa-clock"></i> <span id="current-order-time">--:--</span></div>
                </div>
                <button onclick="deleteCurrentOrder()" class="text-slate-300 hover:text-red-500 transition p-2"><i
                        class="fa-solid fa-trash-can"></i></button>
            </div>

            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 bg-white"></div>

            <div class="shrink-0 bg-white border-t border-slate-100 p-5 shadow-[0_-5px_20px_rgba(0,0,0,0.03)] z-20">
                <div class="flex flex-col gap-2 mb-4 bg-slate-50 p-3 rounded-xl border border-slate-100">
                    <div class="flex items-center justify-between cursor-pointer" onclick="toggleDiscountPanel()">
                        <div class="flex items-center gap-2 text-sm font-semibold text-slate-600">
                            <div
                                class="w-6 h-6 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-xs">
                                <i class="fa-solid fa-tags"></i>
                            </div>
                            <span>Ưu đãi & Giảm giá</span>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 text-xs transition-transform duration-200"
                            id="disc-arrow"></i>
                    </div>

                    <div id="discount-panel" class="hidden mt-2 border-t border-slate-200 pt-3 space-y-3">

                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Mã Voucher</label>
                            <div class="flex gap-1">
                                <input type="text" id="disc-coupon-input"
                                    class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1.5 text-xs outline-none uppercase font-bold focus:border-blue-500"
                                    placeholder="NHẬP MÃ...">
                                <button onclick="applyCoupon()"
                                    class="bg-slate-200 hover:bg-blue-100 text-slate-600 hover:text-blue-600 px-3 py-1.5 rounded-lg text-xs font-bold transition">Áp
                                    dụng</button>
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Chiết khấu thủ
                                công</label>
                            <div class="flex gap-1">
                                <input type="text" id="disc-manual-input" oninput="formatInput(this)"
                                    class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1.5 text-xs outline-none font-bold text-right focus:border-blue-500"
                                    placeholder="Số tiền...">
                                <select id="disc-manual-type"
                                    class="bg-white border border-slate-200 rounded-lg px-1 py-1.5 text-xs outline-none font-bold">
                                    <option value="amount">VNĐ</option>
                                    <option value="percent">%</option>
                                </select>
                                <button onclick="applyManualDisc()"
                                    class="bg-slate-200 hover:bg-blue-100 text-slate-600 hover:text-blue-600 px-3 py-1.5 rounded-lg text-xs font-bold transition">OK</button>
                            </div>
                        </div>

                        <div id="point-usage-section" class="opacity-50 pointer-events-none transition-opacity">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Dùng điểm</label>
                                <span class="text-[10px] text-blue-600 font-bold" id="cust-max-points">Có 0 điểm</span>
                            </div>

                            <div class="flex gap-1 mb-1">
                                <input type="text" id="disc-point-input" oninput="formatInput(this)"
                                    class="flex-1 bg-white border border-slate-200 rounded-lg px-2 py-1.5 text-xs outline-none font-bold text-right text-orange-600 focus:border-orange-500"
                                    placeholder="Nhập điểm...">
                                <button onclick="applyPoints()"
                                    class="bg-orange-100 hover:bg-orange-200 text-orange-600 px-3 py-1.5 rounded-lg text-xs font-bold transition">Dùng</button>
                            </div>

                            <div class="flex gap-1">
                                <button onclick="setQuickPoints(20)"
                                    class="flex-1 py-1 rounded border border-orange-100 bg-orange-50 text-orange-600 hover:bg-orange-100 text-[10px] font-bold transition">20%</button>
                                <button onclick="setQuickPoints(50)"
                                    class="flex-1 py-1 rounded border border-orange-100 bg-orange-50 text-orange-600 hover:bg-orange-100 text-[10px] font-bold transition">50%</button>
                                <button onclick="setQuickPoints(80)"
                                    class="flex-1 py-1 rounded border border-orange-100 bg-orange-50 text-orange-600 hover:bg-orange-100 text-[10px] font-bold transition">80%</button>
                            </div>

                            <div class="text-[9px] text-slate-400 mt-1 italic text-center">*Tối đa 80% quỹ điểm (1 điểm
                                = 1 VNĐ)</div>
                        </div>

                        <button onclick="clearAllDiscounts()"
                            class="w-full py-1.5 text-xs text-red-500 hover:bg-red-50 rounded-lg font-bold transition mt-2 border border-dashed border-red-200">
                            <i class="fa-solid fa-xmark mr-1"></i> Bỏ tất cả ưu đãi
                        </button>
                    </div>


                </div>
                <div class="mb-4 bg-white p-3 rounded-xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-2 mb-2 text-sm font-semibold text-slate-600">
                        <i class="fa-regular fa-pen-to-square text-blue-500"></i> Ghi chú đơn hàng
                    </div>
                    <textarea id="pos-order-note" oninput="updateOrderNote(this.value)" rows="2"
                        class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2 text-xs outline-none focus:border-blue-500 resize-none"
                        placeholder="VD: Hẹ hẹ..."></textarea>
                </div>
                <div class="space-y-2 mb-5">
                    <div class="flex justify-between text-sm text-slate-500"><span>Tạm tính</span><span
                            id="cart-subtotal" class="font-medium text-slate-700">0 ₫</span></div>
                    <div id="row-discount" class="flex justify-between text-sm text-orange-600 hidden"><span><i
                                class="fa-solid fa-ticket mr-1"></i>Giảm giá <span id="discount-label"
                                class="bg-orange-100 px-1.5 rounded text-[10px] font-bold ml-1 text-orange-700"></span></span><span
                            id="cart-discount" class="font-bold">-0 ₫</span></div>
                    <div class="flex justify-between items-end pt-2 border-t border-dashed border-slate-200"><span
                            class="text-base font-bold text-slate-700">Khách phải trả</span><span id="cart-total"
                            class="text-3xl font-black text-blue-600 leading-none tracking-tight">0 ₫</span></div>
                </div>
                <button onclick="openCheckoutModal()" id="btn-checkout"
                    class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-blue-500/30 transition-all active:scale-[0.98] flex items-center justify-center gap-3"><span>Thanh
                        toán</span><i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </aside>
    </div>

    <!-- MODALS SECTION (z-50) -->

    <!-- 1. ADD PRODUCT MODAL -->
    <div id="add-product-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onclick="toggleAddProductModal()"></div>
        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl relative z-10 overflow-hidden animate-fade-in flex flex-col max-h-[90vh]">
            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 id="modal-prod-title" class="text-lg font-bold text-slate-800">📦 Thông tin sản phẩm</h3><button
                    onclick="toggleAddProductModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-5">
                <input type="hidden" id="prod-id">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Tên sản
                            phẩm</label>
                        <input type="text" id="prod-name" onkeydown="handleEnter(event, 'btn-save-prod')"
                            class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:bg-white focus:border-blue-500 outline-none transition"
                            placeholder="Ví dụ: Cắt tóc">
                    </div>
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Danh
                            mục</label>
                        <select id="prod-cat"
                            class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:bg-white focus:border-blue-500 outline-none appearance-none"></select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Giá
                            bán</label>
                        <div class="relative">
                            <input type="text" inputmode="numeric" oninput="formatInput(this)"
                                onkeydown="handleEnter(event, 'btn-save-prod')" id="prod-price"
                                class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:bg-white focus:border-blue-500 outline-none text-right pr-12"
                                placeholder="0">
                            <span
                                class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs font-bold">VNĐ</span>
                        </div>
                    </div>
                </div>

                <div class="border-t border-slate-100 pt-4">
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Quản lý tồn kho
                        (Chi nhánh hiện tại)</label>
                    <div class="flex gap-4 mb-3">
                        <label
                            class="flex items-center gap-2 cursor-pointer bg-slate-50 px-4 py-2 rounded-lg border border-slate-200 hover:border-blue-300 transition">
                            <input type="radio" name="stock-type" value="infinite" checked onclick="toggleStockInput()"
                                class="text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-semibold text-slate-700">Vô hạn</span>
                        </label>
                        <label
                            class="flex items-center gap-2 cursor-pointer bg-slate-50 px-4 py-2 rounded-lg border border-slate-200 hover:border-blue-300 transition">
                            <input type="radio" name="stock-type" value="limited" onclick="toggleStockInput()"
                                class="text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-semibold text-slate-700">Giới hạn</span>
                        </label>
                    </div>
                    <div id="stock-input-container" class="hidden">
                        <input type="text" inputmode="numeric" oninput="formatInput(this)"
                            onkeydown="handleEnter(event, 'btn-save-prod')" id="prod-stock"
                            class="w-full p-3.5 bg-white border border-slate-300 rounded-xl font-medium focus:ring-2 focus:ring-blue-500 outline-none"
                            placeholder="Nhập số lượng...">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Mô tả</label>
                    <textarea id="prod-desc" rows="2"
                        class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:bg-white focus:border-blue-500 outline-none transition text-sm"></textarea>
                </div>
            </div>
            <div class="p-6 pt-0 border-t border-slate-100 bg-slate-50 mt-auto flex justify-between gap-3 pt-4"><button
                    onclick="deleteProduct()" id="btn-delete-prod"
                    class="hidden px-5 py-3 text-red-600 font-bold hover:bg-red-50 border border-red-200 rounded-xl transition flex items-center gap-2"><i
                        class="fa-solid fa-trash-can"></i> Xóa</button>
                <div class="flex gap-3 ml-auto"><button onclick="toggleAddProductModal()"
                        class="px-6 py-3 text-slate-600 font-bold hover:bg-slate-200 rounded-xl transition">Hủy</button><button
                        id="btn-save-prod" onclick="saveProduct()"
                        class="px-8 py-3 bg-slate-800 hover:bg-black text-white rounded-xl font-bold shadow-lg transition active:scale-[0.98]">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. ADD CUSTOMER MODAL -->
    <div id="customer-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onclick="toggleCustomerModal()">
        </div>

        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in flex flex-col max-h-[90vh]">

            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center shrink-0">
                <h3 class="text-lg font-bold text-slate-800">👤 Thông tin khách hàng</h3>
                <button onclick="toggleCustomerModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="p-6 space-y-4 overflow-y-auto">
                <input type="hidden" id="cust-id">

                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Họ tên *</label>
                        <input type="text" id="cust-name"
                            class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 font-bold text-slate-700">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Số điện thoại *</label>
                        <input type="tel" id="cust-phone"
                            class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Hạng (Rank)</label>
                        <select id="cust-rank"
                            class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 disabled:opacity-50 disabled:bg-slate-100">
                            <option value="member">Thành viên (1%)</option>
                            <option value="regular">Khách quen (3%)</option>
                            <option value="vip">VIP (5%)</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Mạng xã hội (Link)</label>
                    <input type="text" id="cust-social" placeholder="Link Facebook / Zalo / Instagram..."
                        class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-sm">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label>
                        <input type="email" id="cust-email"
                            class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Ngày sinh</label>
                        <input type="date" id="cust-dob"
                            class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-slate-500 text-sm">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Ghi chú</label>
                    <textarea id="cust-notes" rows="2"
                        class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 text-sm"
                        placeholder="Sở thích, lưu ý..."></textarea>
                </div>

                <div class="pt-4 border-t border-slate-100 mt-2">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex justify-between items-center">
                        Lịch sử điểm (30 gần nhất)
                        <button onclick="refreshPointHistory()" class="text-blue-500 hover:underline text-[10px]"><i
                                class="fa-solid fa-rotate"></i> Tải lại</button>
                    </h4>
                    <div
                        class="bg-slate-50 rounded-xl border border-slate-200 overflow-hidden h-[150px] overflow-y-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-100 text-slate-500 font-bold text-[10px] uppercase sticky top-0">
                                <tr>
                                    <th class="p-2 w-24">Thời gian</th>
                                    <th class="p-2">Hành động</th>
                                    <th class="p-2 text-right">Biến động</th>
                                </tr>
                            </thead>
                            <tbody id="cust-point-history-list" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="p-6 pt-4 border-t border-slate-100 shrink-0 bg-white">
                <button id="btn-save-cust" onclick="saveCustomer()"
                    class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition active:scale-[0.98]">
                    Lưu thông tin
                </button>
            </div>

        </div>
    </div>

    <div id="customer-select-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onclick="toggleCustomerSelectModal()"></div>
        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden animate-fade-in flex flex-col h-[70vh]">
            <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center shrink-0">
                <h3 class="text-lg font-bold text-slate-800">🔍 Chọn khách hàng</h3>
                <button onclick="toggleCustomerSelectModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-4 border-b border-slate-100 bg-white shrink-0">
                <div class="relative">
                    <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="cust-search-input" oninput="renderCustomerSelectItems()"
                        class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500 transition font-medium"
                        placeholder="Tìm tên hoặc số điện thoại..." autofocus>
                </div>
            </div>
            <div id="customer-select-list" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-50">
            </div>
            <div class="p-4 border-t border-slate-100 bg-white shrink-0">
                <button onclick="toggleCustomerSelectModal(); toggleCustomerModal();"
                    class="w-full py-3 bg-blue-50 text-blue-600 rounded-xl font-bold hover:bg-blue-100 transition border border-blue-200 dashed"><i
                        class="fa-solid fa-user-plus mr-2"></i>Tạo khách hàng mới</button>
            </div>
        </div>
    </div>

    <!-- 3. GIFT CARD MODAL -->
    <div id="promo-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="togglePromoModal()">
        </div>
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in">
            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-slate-800">🎁 Thẻ quà tặng mới</h3><button
                    onclick="togglePromoModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <input type="text" id="promo-code" onkeydown="handleEnter(event, 'btn-save-card')"
                    class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-orange-500 font-bold uppercase tracking-widest text-center text-lg"
                    placeholder="MÃ THẺ (VD: SUMMER2025)">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Loại ưu đãi</label>
                        <select id="promo-type"
                            class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-orange-500 font-medium">
                            <option value="fixed">Tiền mặt (VNĐ)</option>
                            <option value="percent">Phần trăm (%)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Giá trị</label>
                        <input type="text" inputmode="numeric" oninput="formatInput(this)"
                            onkeydown="handleEnter(event, 'btn-save-card')" id="promo-value"
                            class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-orange-500 text-right font-bold"
                            placeholder="0">
                    </div>
                </div>

                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 text-xs text-orange-800">
                    <i class="fa-solid fa-circle-info mr-1"></i> Thẻ chỉ sử dụng được <b>1 lần duy nhất</b>.
                </div>
            </div>
            <div class="p-6 pt-0"><button id="btn-save-card" onclick="saveGiftCard()"
                    class="w-full py-3 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 shadow-lg">Tạo
                    thẻ</button></div>
        </div>
    </div>

    <!-- 4. CATEGORY MODAL -->
    <div id="category-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onclick="toggleCategoryModal()"></div>
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in">
            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-slate-800">📂 Quản lý danh mục</h3><button
                    onclick="toggleCategoryModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6">
                <div class="flex gap-2 mb-4"><input type="text" id="new-cat-name"
                        onkeydown="handleEnter(event, 'btn-add-cat')"
                        class="flex-1 p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:border-blue-500 outline-none"
                        placeholder="Tên danh mục mới..."><button id="btn-add-cat" onclick="addCategory()"
                        class="bg-blue-600 text-white px-4 rounded-xl font-bold hover:bg-blue-700 transition">Thêm</button>
                </div>
                <div class="max-h-[300px] overflow-y-auto space-y-2" id="category-list"></div>
            </div>
        </div>
    </div>

    <!-- 5. CHECKOUT MODAL -->
    <div id="checkout-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity"
            onclick="closeCheckoutModal()"></div>
        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl relative z-10 overflow-hidden flex flex-col md:flex-row h-[90vh] md:h-auto animate-fade-in">
            <div class="w-full md:w-1/3 bg-slate-50 border-r border-slate-200 p-6 flex flex-col gap-4">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Hình thức thanh toán</h3>
                <button onclick="setPaymentMethod('cash')" id="pm-cash"
                    class="pm-btn active w-full p-4 rounded-2xl border text-left flex items-center gap-4 transition-all hover:shadow-md group">
                    <div
                        class="w-12 h-12 rounded-xl bg-green-100 text-green-600 flex items-center justify-center text-xl group-[.active]:bg-blue-600 group-[.active]:text-white transition-colors">
                        <i class="fa-solid fa-money-bill-wave"></i>
                    </div>
                    <div>
                        <div class="font-bold text-slate-800 group-[.active]:text-blue-700">Tiền mặt</div>
                        <div class="text-xs text-slate-500">Tiền lẻ trả lại</div>
                    </div>
                </button>
                <button onclick="setPaymentMethod('transfer')" id="pm-transfer"
                    class="pm-btn w-full p-4 rounded-2xl border text-left flex items-center gap-4 transition-all hover:shadow-md group">
                    <div
                        class="w-12 h-12 rounded-xl bg-purple-100 text-purple-600 flex items-center justify-center text-xl group-[.active]:bg-blue-600 group-[.active]:text-white transition-colors">
                        <i class="fa-solid fa-qrcode"></i>
                    </div>
                    <div>
                        <div class="font-bold text-slate-800 group-[.active]:text-blue-700">Chuyển khoản</div>
                        <div class="text-xs text-slate-500">VietQR tự động</div>
                    </div>
                </button>
                <!-- <button onclick="setPaymentMethod('gift')" id="pm-gift"
                    class="pm-btn w-full p-4 rounded-2xl border text-left flex items-center gap-4 transition-all hover:shadow-md group">
                    <div
                        class="w-12 h-12 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center text-xl group-[.active]:bg-blue-600 group-[.active]:text-white transition-colors">
                        <i class="fa-solid fa-gift"></i>
                    </div>
                    <div>
                        <div class="font-bold text-slate-800 group-[.active]:text-blue-700">Thẻ quà tặng</div>
                        <div class="text-xs text-slate-500">Voucher / Giftcode</div>
                    </div>
                </button> -->
            </div>
            <style>
                .pm-btn.active {
                    border-color: #3b82f6;
                    background: #eff6ff;
                }

                .pm-btn:not(.active) {
                    border-color: transparent;
                    background: white;
                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
                }
            </style>
            <div class="flex-1 p-8 flex flex-col relative bg-white">
                <button onclick="closeCheckoutModal()"
                    class="absolute top-6 right-6 w-10 h-10 rounded-full bg-slate-50 hover:bg-slate-100 flex items-center justify-center text-slate-400 transition"><i
                        class="fa-solid fa-xmark text-lg"></i></button>
                <div class="text-center mb-6">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Tổng tiền thanh toán</p>
                    <h2 id="modal-total-amount" class="text-5xl font-black text-slate-800 tracking-tighter">0</h2>
                </div>
                <div id="pay-cash-ui" class="flex-1 flex flex-col justify-start animate-fade-in">
                    <div class="mb-4 relative"><label
                            class="block text-xs font-bold text-slate-500 uppercase mb-2 ml-1">Khách đưa</label><input
                            type="text" inputmode="numeric" oninput="formatInput(this); calculateChange();"
                            id="cash-given"
                            class="w-full text-3xl font-bold p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-500 focus:bg-white outline-none transition text-center text-blue-600"
                            placeholder="0"></div>
                    <div class="flex gap-2 mb-6 overflow-x-auto no-scrollbar pb-2"><button onclick="setQuickCash(50000)"
                            class="flex-1 min-w-[70px] py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold shadow-sm hover:border-blue-500 hover:text-blue-600 transition">50k</button><button
                            onclick="setQuickCash(100000)"
                            class="flex-1 min-w-[70px] py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold shadow-sm hover:border-blue-500 hover:text-blue-600 transition">100k</button><button
                            onclick="setQuickCash(200000)"
                            class="flex-1 min-w-[70px] py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold shadow-sm hover:border-blue-500 hover:text-blue-600 transition">200k</button>
                        <button onclick="setQuickCash(500000)"
                            class="flex-1 min-w-[70px] py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold shadow-sm hover:border-blue-500 hover:text-blue-600 transition">500k</button>
                        <button onclick="setQuickCash(1000000)"
                            class="flex-1 min-w-[70px] py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold shadow-sm hover:border-blue-500 hover:text-blue-600 transition">1
                            triệu</button>
                    </div>
                    <div
                        class="bg-emerald-50 border border-emerald-100 p-4 rounded-2xl flex justify-between items-center">
                        <span class="font-bold text-emerald-800">Tiền thừa trả lại</span><span id="cash-change"
                            class="text-2xl font-black text-emerald-600">0 ₫</span>
                    </div>
                </div>
                <div id="pay-transfer-ui"
                    class="hidden flex-1 flex flex-col items-center justify-center animate-fade-in text-center">
                    <div class="p-4 bg-white border-2 border-dashed border-slate-300 rounded-2xl mb-4"><img
                            src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=DemoPOS"
                            class="w-40 h-40 opacity-80 mix-blend-multiply"></div>
                    <p class="font-bold text-slate-700">Quét mã để chuyển khoản</p>
                    <p class="text-sm text-slate-400">Hệ thống sẽ tự động xác nhận...</p>
                </div>
                <div id="pay-gift-ui" class="hidden flex-1 flex flex-col justify-start animate-fade-in">
                    <div class="bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-4 text-center"><i
                            class="fa-solid fa-gift text-4xl text-orange-400 mb-3"></i>
                        <h4 class="font-bold text-orange-800 mb-1">Thanh toán bằng Thẻ quà tặng</h4>
                        <p class="text-xs text-orange-600">Nhập mã in trên thẻ vật lý hoặc mã điện tử</p>
                    </div>
                    <div class="relative"><input type="text" id="gift-code-input"
                            class="w-full text-lg font-bold p-4 bg-white border-2 border-slate-200 rounded-2xl focus:border-orange-500 outline-none transition uppercase tracking-widest text-center"
                            placeholder="NHẬP MÃ THẺ"><button onclick="checkGiftCard()"
                            class="absolute right-2 top-2 bottom-2 px-4 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 transition">Kiểm
                            tra</button></div>
                    <div id="gift-status" class="mt-4 text-center text-sm font-medium text-slate-400">Chưa nhập mã</div>
                </div>
                <div class="flex gap-4 mt-auto pt-6 border-t border-slate-100"><button onclick="processPayment(false)"
                        class="flex-1 py-4 bg-white border-2 border-slate-200 text-slate-700 font-bold rounded-2xl hover:bg-slate-50 transition"><i
                            class="fa-regular fa-floppy-disk mr-2"></i>Chỉ Lưu</button><button
                        onclick="processPayment(true)"
                        class="flex-[2] py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-xl shadow-blue-200 transition active:scale-[0.98] flex items-center justify-center gap-2"><i
                            class="fa-solid fa-print"></i> Lưu & In Hóa Đơn</button></div>
            </div>
        </div>
    </div>

    <!-- 5. CN MODAL -->
    <div id="branch-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="toggleBranchModal()">
        </div>
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in">
            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-slate-800">🏢 Quản lý Chi nhánh</h3>
                <button onclick="toggleBranchModal()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center transition"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6">
                <div class="flex gap-2 mb-4">
                    <input type="text" id="new-branch-name"
                        class="flex-1 p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:border-blue-500 outline-none"
                        placeholder="Tên chi nhánh mới...">
                    <button onclick="addNewBranch()"
                        class="bg-blue-600 text-white px-4 rounded-xl font-bold hover:bg-blue-700 transition">Thêm</button>
                </div>
                <div class="max-h-[300px] overflow-y-auto space-y-2" id="branch-list-container">
                </div>
                <div class="mt-6 pt-4 border-t border-slate-100">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-3">Công cụ kho hàng</h4>
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <p class="text-xs text-blue-800 mb-3 font-medium">Sao chép số lượng tồn kho từ chi nhánh này
                            sang chi nhánh khác (Dữ liệu đích sẽ bị ghi đè).</p>
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold text-slate-500 w-12">Từ:</span>
                                <select id="copy-from-branch"
                                    class="flex-1 text-sm p-2 rounded border border-slate-200 outline-none"></select>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold text-slate-500 w-12">Đến:</span>
                                <select id="copy-to-branch"
                                    class="flex-1 text-sm p-2 rounded border border-slate-200 outline-none"></select>
                            </div>
                            <button onclick="executeCopyStock()"
                                class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-bold shadow-sm transition">Thực
                                hiện Sao chép</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="customer-search-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
            onclick="closeCustomerSearch()"></div>
        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden animate-fade-in flex flex-col max-h-[80vh]">
            <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-slate-800">🔍 Chọn khách hàng</h3>
                <button onclick="closeCustomerSearch()"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-slate-800 flex items-center justify-center"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-4 bg-white">
                <div class="relative">
                    <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="cust-search-input" oninput="renderCustomerSuggestions()"
                        class="w-full pl-10 p-3 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:border-blue-500 outline-none"
                        placeholder="Nhập tên hoặc SĐT...">
                </div>
            </div>
            <div id="cust-search-results" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-50">
            </div>
            <div class="p-4 border-t border-slate-100 bg-white">
                <button onclick="closeCustomerSearch(); toggleCustomerModal()"
                    class="w-full py-3 bg-blue-100 text-blue-700 rounded-xl font-bold hover:bg-blue-200 transition"><i
                        class="fa-solid fa-plus mr-2"></i>Tạo khách mới</button>
            </div>
        </div>
    </div>

    <!-- Login -->
    <div id="login-modal" class="fixed inset-0 z-[200] flex items-center justify-center px-4 bg-slate-900">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm p-8 text-center animate-fade-in">
            <div
                class="w-16 h-16 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-3xl mx-auto mb-6 shadow-glow">
                <i class="fa-solid fa-shield-cat"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 mb-2">Đăng nhập hệ thống</h2>
            <p class="text-slate-500 mb-6 text-sm">Vui lòng đăng nhập để bắt đầu ca làm việc</p>

            <div class="space-y-4 mb-6">
                <input type="email" id="login-email"
                    class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:border-blue-500 outline-none transition"
                    placeholder="Email nhân viên">
                <input type="password" id="login-pass" onkeydown="handleEnter(event, 'btn-login')"
                    class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:border-blue-500 outline-none transition"
                    placeholder="Mật khẩu">
            </div>

            <button id="btn-login" onclick="handleLogin()"
                class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition active:scale-[0.98] flex items-center justify-center gap-2">
                <span>Truy cập</span> <i class="fa-solid fa-arrow-right"></i>
            </button>
            <p id="login-error" class="text-red-500 text-sm font-bold mt-4 hidden"></p>
        </div>
    </div>

    <!-- DIALOG (z-100) -->
    <div id="global-dialog" class="fixed inset-0 z-[100] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
        <div
            class="bg-white rounded-2xl shadow-2xl w-full max-w-sm relative z-10 p-6 animate-fade-in flex flex-col items-center text-center">
            <div id="dialog-icon" class="mb-4 text-4xl text-blue-500"><i class="fa-solid fa-circle-info"></i></div>
            <h3 id="dialog-title" class="text-xl font-bold text-slate-800 mb-2">Thông báo</h3>
            <p id="dialog-msg" class="text-slate-500 mb-6 w-full break-words">Nội dung thông báo</p>
            <div id="dialog-input-container" class="w-full mb-6 hidden"><input type="text" id="dialog-input"
                    class="w-full p-3 border border-slate-200 rounded-xl focus:border-blue-500 outline-none text-center font-bold text-slate-700"
                    placeholder="Nhập giá trị..."></div>
            <div class="flex gap-3 w-full"><button id="dialog-cancel-btn"
                    class="flex-1 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition hidden">Hủy</button><button
                    id="dialog-confirm-btn"
                    class="flex-1 py-2.5 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition">Đồng
                    ý</button></div>
        </div>
    </div>

    <!-- TOAST (z-100) -->
    <div id="toast"
        class="fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-4 rounded-2xl shadow-2xl transform translate-y-32 opacity-0 transition-all duration-500 flex items-center gap-4 z-[100] border border-slate-700/50">
        <div
            class="w-10 h-10 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center flex-shrink-0 text-xl">
            <i class="fa-solid fa-check"></i>
        </div>
        <div>
            <h4 class="font-bold text-sm">Thông báo</h4>
            <p id="toast-msg" class="text-sm text-slate-400">Nội dung thông báo</p>
        </div>
    </div>

    <iframe id="print-frame" class="hidden w-0 h-0 border-0"></iframe>

    <!-- SCRIPT -->
    <script type="module" src="./app.js"></script>
</body>

</html>