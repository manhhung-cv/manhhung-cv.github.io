<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolbox Đa Năng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f5; /* iOS-like light gray background */
        }
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        /* Modal transitions */
        .modal-transition {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .modal-hidden {
            opacity: 0;
            transform: scale(0.95) translateY(10px);
            pointer-events: none;
        }
        .modal-visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }
        /* Bottom Nav styling */
        .nav-btn {
            transition: all 0.2s ease-in-out;
        }
        .nav-btn.active-nav svg {
            color: #2563eb; /* blue-600 */
        }
        .nav-btn.active-nav .nav-label {
            color: #1f2937; /* gray-800 */
            font-weight: 500;
        }
        .card-item {
            transition: all 0.3s ease-in-out;
        }
        .ios-card {
            background-color: #ffffff;
            border-radius: 1.25rem; /* 20px */
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /* --- Open Graph Generator Styles --- */
        .preview-card {
            max-width: 500px;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            overflow: hidden;
            background-color: #F9FAFB;
            transition: all 0.3s ease-in-out;
        }
        .preview-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .preview-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background-color: #E5E7EB;
        }
        .preview-content {
            padding: 1rem;
        }
        .preview-url {
            color: #6B7280;
            font-size: 0.875rem;
            text-transform: uppercase;
        }
        .preview-title {
            font-weight: 600;
            font-size: 1.125rem;
            color: #111827;
        }
        .preview-description {
            color: #4B5563;
            font-size: 1rem;
        }
        .code-block {
            background-color: #1F2937;
            color: #D1D5DB;
            border-radius: 0.5rem;
            padding: 1rem;
            position: relative;
        }
        .code-block pre {
            white-space: pre-wrap;
            word-break: break-all;
        }
        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #4B5563;
            color: #F9FAFB;
            border: none;
            border-radius: 0.375rem;
            padding: 0.25rem 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #6B7280;
        }
        #check-url-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Main Container with padding for bottom nav -->
    <div class="container mx-auto p-4 md:p-8 pb-32">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-slate-900">Toolbox</h1>
            <p class="text-slate-600 mt-2">Bộ sưu tập các công cụ hữu ích</p>
        </header>

        <!-- Tab Content Area -->
        <main>
            <!-- Tab 1: Gmail Dot Trick -->
            <div id="gmail-trick" class="tab-content">
                <div class="ios-card p-4 sm:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                        <div>
                            <h2 class="text-2xl font-semibold text-slate-900">Gmail Dot Trick</h2>
                            <p class="text-slate-500 mt-1">Tạo các biến thể email bằng cách thêm dấu chấm (.).</p>
                        </div>
                        <button id="openModalBtn" class="bg-blue-600 text-white font-semibold px-5 py-2.5 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200 mt-4 sm:mt-0 whitespace-nowrap">
                            + Tạo Mới
                        </button>
                    </div>
                </div>
                <div id="cards-container" class="mt-6 space-y-4">
                    <!-- Generated cards will be inserted here -->
                </div>
            </div>

            <!-- Tab 2: Open Graph Generator -->
            <div id="open-graph-tool" class="tab-content hidden">
                <!-- Content from OG Generator will be injected here -->
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Kiểm tra URL hiện có</h2>
                    <p class="text-gray-600 mb-4">Nhập một URL để tự động tìm và điền các thẻ Open Graph hiện có.</p>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="url-to-check" class="flex-grow block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="example.com">
                        <button id="check-url-button" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition">
                            <i class="fas fa-search mr-2"></i>Kiểm tra
                        </button>
                    </div>
                    <div id="status-message" class="mt-4 text-sm"></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-semibold mb-4 text-gray-800">Nhập thông tin</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="og-title" class="block text-sm font-medium text-gray-700">Tiêu đề (og:title)</label>
                                <input type="text" id="og-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ví dụ: Công ty ABC - Giải pháp sáng tạo">
                            </div>
                            <div>
                                <label for="og-description" class="block text-sm font-medium text-gray-700">Mô tả (og:description)</label>
                                <textarea id="og-description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Mô tả ngắn gọn về nội dung của bạn"></textarea>
                            </div>
                            <div>
                                <label for="og-image" class="block text-sm font-medium text-gray-700">URL Hình ảnh (og:image)</label>
                                <input type="text" id="og-image" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="https://example.com/image.jpg">
                            </div>
                            <div>
                                <label for="og-url" class="block text-sm font-medium text-gray-700">URL trang web (og:url)</label>
                                <input type="text" id="og-url" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="example.com/page.html">
                            </div>
                            <div>
                                <label for="og-site-name" class="block text-sm font-medium text-gray-700">Tên trang web (og:site_name)</label>
                                <input type="text" id="og-site-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ví dụ: Công ty ABC">
                            </div>
                            <div>
                                <label for="og-type" class="block text-sm font-medium text-gray-700">Loại (og:type)</label>
                                <select id="og-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                    <option>website</option>
                                    <option>article</option>
                                    <option>book</option>
                                    <option>profile</option>
                                    <option>video.movie</option>
                                    <option>music.song</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-8">
                        <div>
                            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Xem trước</h2>
                            <div class="preview-card mx-auto">
                                <img id="preview-image" src="https://placehold.co/500x261/E5E7EB/B0B0B0?text=Hình+ảnh+của+bạn" alt="Xem trước hình ảnh Open Graph" class="preview-image">
                                <div class="preview-content">
                                    <p id="preview-url" class="preview-url mb-1">example.com</p>
                                    <h3 id="preview-title" class="preview-title mb-2">Tiêu đề của bạn</h3>
                                    <p id="preview-description" class="preview-description">Mô tả của bạn sẽ ở đây.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Mã được tạo</h2>
                            <div class="code-block">
                                <button id="og-copy-button" class="copy-button">
                                    <i class="far fa-copy mr-1"></i> Sao chép
                                </button>
                                <pre><code id="generated-code" class="language-html"><!-- Các thẻ meta của bạn sẽ được tạo ở đây --></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Placeholder -->
            <div id="tool3" class="tab-content hidden">
                <div class="ios-card p-6 text-center">
                    <h2 class="text-2xl font-semibold text-slate-900">Công cụ #3</h2>
                    <p class="text-slate-500 mt-2">Tính năng này đang được phát triển. Vui lòng quay lại sau!</p>
                </div>
            </div>
        </main>
    </div>

    <!-- iOS-style Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 h-24 bg-transparent flex justify-center">
        <div class="flex items-center justify-center gap-4 sm:gap-6 bg-white/80 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-lg px-4 sm:px-6 h-20 self-end mb-4">
            <button class="nav-btn active-nav flex flex-col items-center justify-center w-16 h-16" data-tab="gmail-trick">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                <span class="nav-label text-xs text-gray-500 mt-1">Gmail Trick</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center w-16 h-16" data-tab="open-graph-tool">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                <span class="nav-label text-xs text-gray-500 mt-1">Open Graph</span>
            </button>
            <button class="nav-btn flex flex-col items-center justify-center w-16 h-16" data-tab="tool3">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                <span class="nav-label text-xs text-gray-500 mt-1">Công cụ #3</span>
            </button>
        </div>
    </nav>

    <!-- Modal for Email Input -->
    <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 modal-transition modal-hidden z-50">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-md p-6 md:p-8">
            <h3 class="text-2xl font-bold text-center text-slate-900">Nhập Gmail của bạn</h3>
            <p class="text-slate-500 text-center mt-2">Chúng tôi sẽ tạo các biến thể từ email này.</p>
            <div class="mt-6">
                <input type="text" id="emailInput" placeholder="vidu hoặc vidu@gmail.com" class="w-full px-4 py-3 bg-white/70 border border-slate-300/70 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                <p id="error-message" class="text-red-500 text-sm mt-2 h-5"></p>
            </div>
            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button id="closeModalBtn" class="w-full bg-gray-200 text-gray-800 font-semibold py-3 rounded-xl hover:bg-gray-300 transition-colors">Hủy</button>
                <button id="generateBtn" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl hover:bg-blue-700 transition-colors">Tạo</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 modal-transition modal-hidden z-50">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-xl font-bold text-slate-900 text-center">Xác nhận xóa</h3>
            <p class="text-slate-600 mt-2 text-center">Bạn có chắc chắn muốn xóa thẻ này không? Thao tác này không thể hoàn tác.</p>
            <div class="mt-6 grid grid-cols-2 gap-3">
                <button id="cancelDeleteBtn" class="px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors">Hủy</button>
                <button id="confirmDeleteBtn" class="px-4 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition-colors">Xóa</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-md text-white px-5 py-3 rounded-full shadow-lg opacity-0 -translate-y-3 transition-all duration-300 z-50">
        Đã sao chép!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // =================================================================
            // --- CÁC HÀM TIỆN ÍCH CHUNG (UTILITY FUNCTIONS) ---
            // =================================================================
            const toast = document.getElementById('toast');
            let toastTimer;

            function showToast(message) {
                toast.textContent = message;
                clearTimeout(toastTimer);
                toast.classList.remove('opacity-0', '-translate-y-3');
                toastTimer = setTimeout(() => {
                    toast.classList.add('opacity-0', '-translate-y-3');
                }, 2000);
            }

            function copyToClipboard(text, successMessage = 'Đã sao chép thành công!') {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast(successMessage);
                } catch (err) {
                    showToast('Lỗi! Không thể sao chép.');
                }
                document.body.removeChild(textarea);
            }

            // =================================================================
            // --- LOGIC CHUYỂN TAB (TAB SWITCHING LOGIC) ---
            // =================================================================
            const navButtons = document.querySelectorAll('.nav-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active-nav'));
                    tabContents.forEach(c => c.classList.add('hidden'));
                    button.classList.add('active-nav');
                    const targetContent = document.getElementById(button.dataset.tab);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });

            // =================================================================
            // --- KHỞI TẠO CÁC CÔNG CỤ (TOOL INITIALIZERS) ---
            // =================================================================
            
            /**
             * Khởi tạo công cụ Gmail Dot Trick
             */
            function initGmailTrick() {
                const container = document.getElementById('gmail-trick');
                if (!container) return;

                const emailModal = document.getElementById('emailModal');
                const openModalBtn = document.getElementById('openModalBtn');
                const closeModalBtn = document.getElementById('closeModalBtn');
                const generateBtn = document.getElementById('generateBtn');
                const emailInput = document.getElementById('emailInput');
                const errorMessage = document.getElementById('error-message');
                const deleteConfirmModal = document.getElementById('deleteConfirmModal');
                const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
                const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                const cardsContainer = document.getElementById('cards-container');
                const STORAGE_KEY = 'gmailTrickCardsData';
                let cardToDelete = null;

                function getCardsFromStorage() {
                    const data = localStorage.getItem(STORAGE_KEY);
                    try { return data ? JSON.parse(data) : []; } catch (e) { return []; }
                }

                function saveCardsToStorage(cardsData) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(cardsData));
                }

                function renderAllCards() {
                    cardsContainer.innerHTML = '';
                    const cardsData = getCardsFromStorage();
                    cardsData.forEach(cardData => {
                        const username = cardData.email.split('@')[0];
                        const reversedUsername = username.split('').reverse().join('');
                        const reversedVariations = generateAllDotTricks(reversedUsername);
                        const finalVariations = reversedVariations.map(v => v.split('').reverse().join(''));
                        const variationsForCard = finalVariations.filter(v => v !== username);
                        createResultCard(cardData.id, cardData.email, variationsForCard);
                    });
                }

                function closeModal(modal) {
                    modal.classList.add('modal-hidden');
                    modal.classList.remove('modal-visible');
                }

                function handleGeneration() {
                    let email = emailInput.value.trim().toLowerCase();
                    if (email && !email.includes('@')) email += '@gmail.com';
                    if (!email || !email.endsWith('@gmail.com')) {
                        errorMessage.textContent = 'Vui lòng nhập một địa chỉ Gmail hợp lệ.';
                        return;
                    }
                    const username = email.split('@')[0];
                    if (username.length === 0) {
                        errorMessage.textContent = 'Tên người dùng không thể để trống.';
                        return;
                    }
                    if (username.length > 15) {
                        errorMessage.textContent = 'Tên người dùng quá dài để tránh treo trình duyệt.';
                        return;
                    }
                    errorMessage.textContent = '';
                    const cardsData = getCardsFromStorage();
                    const newCard = { id: Date.now(), email: email };
                    cardsData.unshift(newCard);
                    saveCardsToStorage(cardsData);
                    renderAllCards();
                    closeModal(emailModal);
                }

                function generateAllDotTricks(username) {
                    const results = new Set();
                    const n = username.length;
                    if (n === 0) return [];
                    const limit = 1 << (n - 1);
                    for (let i = 0; i < limit; i++) {
                        let newUsername = username[0];
                        for (let j = 0; j < n - 1; j++) {
                            if ((i >> j) & 1) newUsername += '.';
                            newUsername += username[j + 1];
                        }
                        results.add(newUsername);
                    }
                    return Array.from(results);
                }

                function createResultCard(id, originalEmail, variations) {
                    const card = document.createElement('div');
                    card.className = 'card-item ios-card p-4 sm:p-5 transition-all duration-500 transform';
                    card.dataset.id = id;
                    const listItems = variations.map(variation => `
                        <div class="flex justify-between items-center bg-slate-100 p-2.5 rounded-xl group">
                            <span class="text-slate-800 select-all break-all pr-2 text-sm sm:text-base">${variation}@gmail.com</span>
                            <button class="copy-btn text-slate-500 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity" data-clipboard-text="${variation}@gmail.com">
                               <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            </button>
                        </div>`).join('');
                    const allEmailsText = variations.map(v => `${v}@gmail.com`).join('\n');
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-slate-500">Email gốc</p>
                                <h3 class="text-lg sm:text-xl font-semibold text-blue-600 break-all">${originalEmail}</h3>
                                <p class="text-sm font-medium text-slate-700 mt-1">Đã tạo <span class="text-green-600 font-bold">${variations.length}</span> biến thể.</p>
                            </div>
                            <button class="delete-btn text-gray-400 hover:text-red-500 transition-colors w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                        <div class="max-h-64 overflow-y-auto pr-2 custom-scrollbar space-y-2">${listItems}</div>
                        <div class="mt-4 pt-4 border-t border-slate-200/80">
                            <button class="copy-btn w-full bg-green-500 text-white font-semibold py-3 rounded-xl hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all" data-clipboard-text="${allEmailsText}">
                                Sao chép tất cả (${variations.length})
                            </button>
                        </div>`;
                    cardsContainer.appendChild(card);
                }

                openModalBtn.addEventListener('click', () => {
                    emailModal.classList.remove('modal-hidden');
                    emailModal.classList.add('modal-visible');
                    emailInput.focus();
                    emailInput.value = '';
                    errorMessage.textContent = '';
                });

                closeModalBtn.addEventListener('click', () => closeModal(emailModal));
                generateBtn.addEventListener('click', handleGeneration);
                emailInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') handleGeneration(); });

                cardsContainer.addEventListener('click', function(e) {
                    const copyBtn = e.target.closest('.copy-btn');
                    if (copyBtn) {
                        copyToClipboard(copyBtn.dataset.clipboardText);
                        return;
                    }
                    const deleteBtn = e.target.closest('.delete-btn');
                    if (deleteBtn) {
                        cardToDelete = deleteBtn.closest('.card-item');
                        deleteConfirmModal.classList.remove('modal-hidden');
                        deleteConfirmModal.classList.add('modal-visible');
                    }
                });

                cancelDeleteBtn.addEventListener('click', () => closeModal(deleteConfirmModal));
                confirmDeleteBtn.addEventListener('click', () => {
                    if (cardToDelete) {
                        const cardId = cardToDelete.dataset.id;
                        let cardsData = getCardsFromStorage();
                        cardsData = cardsData.filter(card => card.id.toString() !== cardId);
                        saveCardsToStorage(cardsData);
                        cardToDelete.remove();
                        cardToDelete = null;
                    }
                    closeModal(deleteConfirmModal);
                });

                renderAllCards();
            }

            /**
             * Khởi tạo công cụ Open Graph Generator
             */
            function initOpenGraphGenerator() {
                const container = document.getElementById('open-graph-tool');
                if (!container) return;

                const elements = {
                    inputs: {
                        title: document.getElementById('og-title'),
                        description: document.getElementById('og-description'),
                        image: document.getElementById('og-image'),
                        url: document.getElementById('og-url'),
                        siteName: document.getElementById('og-site-name'),
                        type: document.getElementById('og-type')
                    },
                    preview: {
                        image: document.getElementById('preview-image'),
                        url: document.getElementById('preview-url'),
                        title: document.getElementById('preview-title'),
                        description: document.getElementById('preview-description')
                    },
                    urlToCheckInput: document.getElementById('url-to-check'),
                    checkUrlButton: document.getElementById('check-url-button'),
                    statusMessage: document.getElementById('status-message'),
                    generatedCodeEl: document.getElementById('generated-code'),
                    copyButton: document.getElementById('og-copy-button')
                };

                function ensureProtocol(url) {
                    const trimmedUrl = url.trim();
                    if (!trimmedUrl) return '';
                    if (trimmedUrl.startsWith('http://') || trimmedUrl.startsWith('https://')) return trimmedUrl;
                    if (trimmedUrl.startsWith('/') || trimmedUrl.startsWith('#') || trimmedUrl.startsWith('mailto:')) return trimmedUrl;
                    if (trimmedUrl.includes('.') && !trimmedUrl.includes(' ')) return `https://` + trimmedUrl;
                    return trimmedUrl;
                }

                function updateAll() {
                    const values = {
                        title: elements.inputs.title.value || 'Tiêu đề của bạn',
                        description: elements.inputs.description.value || 'Mô tả của bạn sẽ ở đây.',
                        image: elements.inputs.image.value,
                        url: elements.inputs.url.value,
                        siteName: elements.inputs.siteName.value,
                        type: elements.inputs.type.value
                    };
                    const baseUrl = ensureProtocol(values.url);
                    elements.preview.title.textContent = values.title;
                    elements.preview.description.textContent = values.description;
                    let absoluteImageUrl = values.image;
                    if (values.image && baseUrl && !values.image.startsWith('http')) {
                        try { absoluteImageUrl = new URL(values.image, baseUrl).href; } catch (e) { absoluteImageUrl = values.image; }
                    }
                    elements.preview.image.src = absoluteImageUrl || 'https://placehold.co/500x261/E5E7EB/B0B0B0?text=Hình+ảnh+của+bạn';
                    elements.preview.image.onerror = () => { elements.preview.image.src = 'https://placehold.co/500x261/f03a3a/ffffff?text=Lỗi+tải+ảnh'; };
                    if (baseUrl) {
                        try { elements.preview.url.textContent = new URL(baseUrl).hostname; } catch (e) { elements.preview.url.textContent = 'URL không hợp lệ'; }
                    } else {
                        elements.preview.url.textContent = 'example.com';
                    }
                    let htmlCode = '';
                    const escapeHtml = (unsafe) => unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
                    if (values.title) htmlCode += `&lt;meta property="og:title" content="${escapeHtml(values.title)}"&gt;\n`;
                    if (values.description) htmlCode += `&lt;meta property="og:description" content="${escapeHtml(values.description)}"&gt;\n`;
                    if (absoluteImageUrl) htmlCode += `&lt;meta property="og:image" content="${escapeHtml(absoluteImageUrl)}"&gt;\n`;
                    if (baseUrl) htmlCode += `&lt;meta property="og:url" content="${escapeHtml(baseUrl)}"&gt;\n`;
                    if (values.siteName) htmlCode += `&lt;meta property="og:site_name" content="${escapeHtml(values.siteName)}"&gt;\n`;
                    if (values.type) htmlCode += `&lt;meta property="og:type" content="${escapeHtml(values.type)}"&gt;\n`;
                    if (htmlCode) {
                        htmlCode += `\n&lt;!-- Twitter Card Meta Tags --&gt;\n`;
                        htmlCode += `&lt;meta name="twitter:card" content="summary_large_image"&gt;\n`;
                        if (baseUrl) {
                            try {
                                const urlObject = new URL(baseUrl);
                                htmlCode += `&lt;meta property="twitter:domain" content="${escapeHtml(urlObject.hostname)}"&gt;\n`;
                                htmlCode += `&lt;meta property="twitter:url" content="${escapeHtml(baseUrl)}"&gt;\n`;
                            } catch (e) {}
                        }
                        if (values.title) htmlCode += `&lt;meta name="twitter:title" content="${escapeHtml(values.title)}"&gt;\n`;
                        if (values.description) htmlCode += `&lt;meta name="twitter:description" content="${escapeHtml(values.description)}"&gt;\n`;
                        if (absoluteImageUrl) htmlCode += `&lt;meta name="twitter:image" content="${escapeHtml(absoluteImageUrl)}"&gt;\n`;
                    }
                    elements.generatedCodeEl.innerHTML = htmlCode || '<!-- Các thẻ meta của bạn sẽ được tạo ở đây -->';
                }

                Object.values(elements.inputs).forEach(input => {
                    if (input) input.addEventListener('input', updateAll);
                });

                function autoCorrectUrl(event) {
                    const inputElement = event.target;
                    const correctedUrl = ensureProtocol(inputElement.value);
                    if (inputElement.value !== correctedUrl) {
                        inputElement.value = correctedUrl;
                        inputElement.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                }
                elements.urlToCheckInput.addEventListener('blur', autoCorrectUrl);
                elements.inputs.url.addEventListener('blur', autoCorrectUrl);

                elements.copyButton.addEventListener('click', () => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = elements.generatedCodeEl.innerHTML.replace(/<!--(.*?)-->/g, '');
                    const codeToCopy = tempDiv.textContent || tempDiv.innerText || "";
                    if (!codeToCopy.trim()) return;
                    const button = elements.copyButton;
                    const originalText = button.innerHTML;
                    copyToClipboard(codeToCopy);
                    button.innerHTML = '<i class="fas fa-check mr-1"></i> Đã chép!';
                    setTimeout(() => { button.innerHTML = originalText; }, 2000);
                });

                elements.checkUrlButton.addEventListener('click', async () => {
                    const url = ensureProtocol(elements.urlToCheckInput.value);
                    elements.urlToCheckInput.value = url;
                    if (!url) {
                        elements.statusMessage.textContent = 'Vui lòng nhập một URL.';
                        elements.statusMessage.className = 'mt-4 text-sm text-red-600';
                        return;
                    }
                    elements.checkUrlButton.disabled = true;
                    elements.checkUrlButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Đang kiểm tra...';
                    elements.statusMessage.textContent = 'Đang tìm nạp và phân tích cú pháp URL...';
                    elements.statusMessage.className = 'mt-4 text-sm text-blue-600';
                    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                    try {
                        const response = await fetch(proxyUrl);
                        if (!response.ok) throw new Error(`Lỗi mạng: ${response.statusText}`);
                        const data = await response.json();
                        if (!data.contents) throw new Error('Không thể lấy nội dung HTML từ URL.');
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(data.contents, 'text/html');
                        const getMetaContent = (prop) => {
                            const el = doc.querySelector(`meta[property="${prop}"], meta[name="${prop}"]`);
                            return el ? el.getAttribute('content') : '';
                        };
                        let imageUrl = getMetaContent('og:image');
                        if (imageUrl && !imageUrl.startsWith('http')) {
                            try { imageUrl = new URL(imageUrl, url).href; } catch (e) {}
                        }
                        const ogData = {
                            title: getMetaContent('og:title') || doc.querySelector('title')?.textContent || '',
                            description: getMetaContent('og:description') || getMetaContent('description'),
                            image: imageUrl,
                            url: getMetaContent('og:url') || url,
                            siteName: getMetaContent('og:site_name'),
                            type: getMetaContent('og:type') || 'website'
                        };
                        let foundTags = false;
                        Object.keys(ogData).forEach(key => {
                            if (elements.inputs[key] && ogData[key]) {
                                elements.inputs[key].value = ogData[key];
                                foundTags = true;
                            }
                        });
                        if (foundTags) {
                            elements.statusMessage.textContent = 'Đã tìm thấy và điền các thẻ meta!';
                            elements.statusMessage.className = 'mt-4 text-sm text-green-600';
                        } else {
                            elements.statusMessage.textContent = 'Không tìm thấy thẻ Open Graph nào.';
                            elements.statusMessage.className = 'mt-4 text-sm text-yellow-600';
                        }
                        updateAll();
                    } catch (error) {
                        elements.statusMessage.textContent = `Lỗi: ${error.message}.`;
                        elements.statusMessage.className = 'mt-4 text-sm text-red-600';
                    } finally {
                        elements.checkUrlButton.disabled = false;
                        elements.checkUrlButton.innerHTML = '<i class="fas fa-search mr-2"></i>Kiểm tra';
                    }
                });
                
                updateAll();
            }

            // Chạy các hàm khởi tạo
            initGmailTrick();
            initOpenGraphGenerator();
        });
    </script>
</body>
</html>
